<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>LandR Manual</title>
  <meta name="description" content="A manual for the LandR ecosystem of SpaDES modules" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="LandR Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/figures/LandRHex.png" />
  <meta property="og:description" content="A manual for the LandR ecosystem of SpaDES modules" />
  <meta name="github-repo" content="<a href="https://github.com/CeresBarros/LandR-Manual" class="uri">https://github.com/CeresBarros/LandR-Manual</a>" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="LandR Manual" />
  
  <meta name="twitter:description" content="A manual for the LandR ecosystem of SpaDES modules" />
  <meta name="twitter:image" content="/figures/LandRHex.png" />

<meta name="author" content="Edited by: Ceres Barros, Alex M. Chubaty, Ian M. S. Eddy, Eliot J. B. McIntire" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">LandR Manual</h1>
<h2 class="subtitle"><em>v. 0.0.9000</em></h2>
<p class="author"><em>Edited by: Ceres Barros, Alex M. Chubaty, Ian M. S. Eddy, Eliot J. B. McIntire</em></p>
<p class="date"><em>Last updated: 2022-03-15</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#landr-biomass_core-module">LandR <em>Biomass_core</em> Module</a>
<ul>
<li><a href="#module-overview">Module Overview</a>
<ul>
<li><a href="#module-summary">Module summary</a></li>
<li><a href="#module-inputs-and-parameters">Module inputs and parameters</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#module-outputs">Module outputs</a></li>
<li><a href="#links-to-other-modules">Links to other modules</a></li>
<li><a href="#getting-help">Getting help</a></li>
</ul></li>
<li><a href="#module-manual">Module manual</a>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#differences-between-biomass_core-and-lbse">Differences between <em>Biomass_core</em> and LBSE</a></li>
<li><a href="#initialization-inputs-and-parameters">Initialization, inputs and parameters</a></li>
<li><a href="#simulation-flow">Simulation flow</a></li>
</ul></li>
<li><a href="#usage-example">Usage example</a>
<ul>
<li><a href="#load-spades">Load <code>SpaDES</code></a></li>
<li><a href="#get-the-module">Get the module</a></li>
<li><a href="#setup-simulation">Setup simulation</a></li>
<li><a href="#run-simulation">Run simulation</a></li>
</ul></li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#tables">Tables</a></li>
<li><a href="#figures">Figures</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul></li>
<li><a href="#landr-data-modules">LandR Data Modules</a></li>
<li><a href="#landr-biomass_speciesdata-module">LandR <em>Biomass_speciesData</em> Module</a>
<ul>
<li><a href="#module-overview-1">Module Overview</a>
<ul>
<li><a href="#module-summary-1">Module summary</a></li>
<li><a href="#module-inputs-and-parameters-at-a-glance">Module inputs and parameters at a glance</a></li>
<li><a href="#events-1">Events</a></li>
<li><a href="#module-outputs-1">Module outputs</a></li>
<li><a href="#links-to-other-modules-1">Links to other modules</a></li>
<li><a href="#getting-help-1">Getting help</a></li>
</ul></li>
<li><a href="#module-manual-1">Module manual</a>
<ul>
<li><a href="#detailed-description">Detailed description</a></li>
<li><a href="#initialization-inputs-and-parameters-1">Initialization, inputs and parameters</a></li>
<li><a href="#simulation-flow-1">Simulation flow</a></li>
</ul></li>
<li><a href="#usage-example-1">Usage example</a>
<ul>
<li><a href="#load-spades-and-other-packages.">Load <code>SpaDES</code> and other packages.</a></li>
<li><a href="#get-module-necessary-packages-and-set-up-folder-directories">Get module, necessary packages and set up folder directories</a></li>
<li><a href="#setup-simulation-1">Setup simulation</a></li>
<li><a href="#run-module">Run module</a></li>
</ul></li>
<li><a href="#references-1">References</a></li>
</ul></li>
<li><a href="#landr-validation-modules">LandR Validation Modules</a></li>
<li><a href="#landr-biomass_validationknn-module">LandR <em>Biomass_validationKNN</em> Module</a>
<ul>
<li><a href="#module-overview-2">Module Overview</a>
<ul>
<li><a href="#module-summary-2">Module summary</a></li>
<li><a href="#module-inputs-and-parameters-at-a-glance-1">Module inputs and parameters at a glance</a></li>
<li><a href="#events-2">Events</a></li>
<li><a href="#module-outputs-2">Module outputs</a></li>
<li><a href="#links-to-other-modules-2">Links to other modules</a></li>
<li><a href="#getting-help-2">Getting help</a></li>
</ul></li>
<li><a href="#module-manual-2">Module manual</a>
<ul>
<li><a href="#detailed-description-1">Detailed description</a></li>
<li><a href="#validation-approaches">Validation approaches</a></li>
<li><a href="#initialization-inputs-and-parameters-2">Initialization, inputs and parameters</a></li>
<li><a href="#simulation-flow-2">Simulation flow</a></li>
</ul></li>
<li><a href="#usage-example-2">Usage example</a>
<ul>
<li><a href="#load-spades-and-other-packages.-1">Load <code>SpaDES</code> and other packages.</a></li>
<li><a href="#get-the-modules">Get the modules</a></li>
<li><a href="#setup-simulation-2">Setup simulation</a></li>
<li><a href="#run-simulation-1">Run simulation</a></li>
<li><a href="#validate-simulation-outputs-with-biomass_validationknn">Validate simulation outputs with <em>Biomass_validationKNN</em></a></li>
</ul></li>
<li><a href="#references-2">References</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">LandR Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<!-- manual version TODO: link to date and commit of manual/project repo -->
<div id="preface" class="section level1">
<h1>Preface</h1>
<p><img src="figures/LandRHex.png" width="365" style="display: block; margin: auto;" /></p>
<p>LandR is a collection of <code>SpaDES</code> modules <span class="citation">(see <a href="#ref-ChubatyMcIntire2019" role="doc-biblioref">Chubaty &amp; McIntire 2019</a>)</span> which are aimed at simulating forest dynamics across large spatial scales, while taking into account various disturbances that affected them (e.g., wildfire and climate change), as well as their interactions with other components of forest systems, such as bird communities and ungulates (via changes in the habitat of these species) or carbon cycling.</p>
<p>The present manual is a “live” document, in that will grow and change according to the existing number of LandR modules, as well as their development. In addition, sub-manuals may be produced describing smaller collections of LandR modules – e.g., the LandR Biomass manual describes only the LandR modules that are essential for the simulation of the vegetation components of forest succession, hence excluding fire disturbance modules.</p>
<!--chapter:end:index.Rmd-->
</div>
<div id="landr-biomass_core-module" class="section level1">
<h1>LandR <em>Biomass_core</em> Module</h1>
<!-- the following are text references used in captions for LaTeX compatibility -->
<p>(ref:Biomass-core) <em>Biomass_core</em></p>
<p><a href="http://commonmark.org"><img src="https://img.shields.io/badge/Made%20with-Markdown-1f425f.png" alt="made-with-Markdown" /></a> <a href="https://github.com/PredictiveEcology/Biomass_core/issues"><img src="https://img.shields.io/badge/Get%20help-Report%20issues-%3CCOLOR%3E.png" alt="Generic badge" /></a></p>
<!-- if knitting to pdf remember to add the pandoc_args: ["--extract-media", "."] option to yml in order to get the badge images -->
<p><strong>This documentation is work in progress. Potential discrepancies and omissions may exist for the time being. If you find any, do contact us using the link above^^</strong></p>
<div id="authors" class="section level4">
<h4>Authors:</h4>
<p>Yong Luo <a href="mailto:yluo1@lakeheadu.ca" class="email">yluo1@lakeheadu.ca</a> [aut], Eliot J B McIntire <a href="mailto:eliot.mcintire@canada.ca" class="email">eliot.mcintire@canada.ca</a> [aut, cre], Jean Marchal <a href="mailto:jean.d.marchal@gmail.com" class="email">jean.d.marchal@gmail.com</a> [ctb], Alex M. Chubaty <a href="mailto:achubaty@for-cast.ca" class="email">achubaty@for-cast.ca</a> [ctb], Ceres Barros <a href="mailto:cbarros@mail.ubc.ca" class="email">cbarros@mail.ubc.ca</a> [ctb] <!-- ideally separate authors with new lines, '\n' not working --></p>
</div>
<div id="module-overview" class="section level2">
<h2>Module Overview</h2>
<div id="module-summary" class="section level3">
<h3>Module summary</h3>
<p>LandR <em>Biomass_core</em> (hereafter <em>Biomass_core</em>) is the core forest succession simulation module of the LandR ecosystem of <code>SpaDES</code> modules <span class="citation">(see <a href="#ref-ChubatyMcIntire2019" role="doc-biblioref">Chubaty &amp; McIntire 2019</a>)</span>. It simulates tree cohort ageing, growth, mortality and competition for light resources, as well as seed dispersal (Fig. @ref(fig:fig-Biomass-core)), in a spatially explicit manner and using a yearly time steps. The model is based on the LANDIS-II Biomass Succession Extension v.3.2.1 [LBSE; <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span>], with a few changes (see <a href="#differences-between-biomass_core-and-lbse">Differences between <em>Biomass_core</em> and LBSE</a>). Nonetheless, the essential functioning of the succession model still largely follows its LANDIS-II counterpart, and we refer the reader to the corresponding LANDIS-II BSE manual <span class="citation">(<a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span> for a detailed reading of the mechanisms implemented in the model.</p>
<div class="figure" style="text-align: center">
<img src="figures/Biomass_coreSchematic.png" alt="(ref:Biomass-core) simulates tree cohort growth, mortality, recruitment and dispersal dynamics, as a function of  cohort ageing and competition for light (shading) and space, as well as disturbances like fire (simulated using other modules)." width="60%" />
<p class="caption">
(#fig:fig-Biomass-core)(ref:Biomass-core) simulates tree cohort growth, mortality, recruitment and dispersal dynamics, as a function of cohort ageing and competition for light (shading) and space, as well as disturbances like fire (simulated using other modules).
</p>
</div>
</div>
<div id="module-inputs-and-parameters" class="section level3">
<h3>Module inputs and parameters</h3>
<p><em>Biomass_core</em> is capable of running on dummy datasets from which it estimates parameters linked to vegetation growth and seed germination (such as the maximum biomass per species, per pixel, and the probability of seed germination – <em>i.e.</em>, species establishment probability not due to resprouting), but also builds and initializes forest communities (based on biomass, age, species composition, land cover and ecological zones like ecodistricts.</p>
<p>Ideally, however, the user should supply realistic versions of these data and the essential initialization objects that <em>Biomass_core</em> requires to run.</p>
<p>Table @ref(tab:moduleInputs-Biomass-core) shows a full list of input objects that <em>Biomass_core</em> expects. Of these, the only input that <strong>must</strong> be provided (<em>i.e.</em>, <em>Biomass_core</em> does not have a default for) is <code>studyArea</code>. All other input objects and parameters have internal defaults (see Tables @ref(tab:moduleInputs2-Biomass-core) and @ref(tab:moduleParams2-Biomass-core).</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleInputs-Biomass-core)List of (ref:Biomass-core) input objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
desc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
biomassMap
</td>
<td style="text-align:left;">
total biomass raster layer in study area (in g/m^2), filtered for pixels covered by cohortData. Only used if <code>P(sim)$initialBiomassSource == 'biomassMap'</code>, which is currently deactivated.
</td>
</tr>
<tr>
<td style="text-align:left;">
cceArgs
</td>
<td style="text-align:left;">
a list of quoted objects used by the <code>growthAndMortalityDriver</code> <code>calculateClimateEffect</code> function
</td>
</tr>
<tr>
<td style="text-align:left;">
cohortData
</td>
<td style="text-align:left;">
<code>data.table</code> with cohort-level information on age and biomass, by pixelGroup and ecolocation (i.e., <code>ecoregionGroup</code>). If supplied, it must have the following columns: <code>pixelGroup</code> (integer), <code>ecoregionGroup</code> (factor), <code>speciesCode</code> (factor), <code>B</code> (integer in g/m^2), <code>age</code> (integer in years)
</td>
</tr>
<tr>
<td style="text-align:left;">
ecoregion
</td>
<td style="text-align:left;">
ecoregion look up table
</td>
</tr>
<tr>
<td style="text-align:left;">
ecoregionMap
</td>
<td style="text-align:left;">
ecoregion map that has mapcodes match ecoregion table and <code>speciesEcoregion</code> table. Defaults to a dummy map matching <code>rasterToMatch</code> with two regions
</td>
</tr>
<tr>
<td style="text-align:left;">
lastReg
</td>
<td style="text-align:left;">
an internal counter keeping track of when the last regeneration event occurred
</td>
</tr>
<tr>
<td style="text-align:left;">
minRelativeB
</td>
<td style="text-align:left;">
table defining the relative biomass cut points to classify stand shadeness
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupMap
</td>
<td style="text-align:left;">
initial community map that has mapcodes match initial community table
</td>
</tr>
<tr>
<td style="text-align:left;">
rasterToMatch
</td>
<td style="text-align:left;">
a raster of the <code>studyArea</code> in the same resolution and projection as <code>biomassMap</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
a table that has species traits such as longevity, shade tolerance, etc. Default is partially based on Dominic Cyr and Yan Boulanger’s project
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesEcoregion
</td>
<td style="text-align:left;">
table defining the maxANPP, maxB and SEP, which can change with both ecoregion and simulation time. Defaults to a dummy table based on dummy data os biomass, age, ecoregion and land cover class
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesLayers
</td>
<td style="text-align:left;">
percent cover raster layers of tree species in Canada. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2001 using a cover threshold of 10 - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata
</td>
</tr>
<tr>
<td style="text-align:left;">
sppColorVect
</td>
<td style="text-align:left;">
A named vector of colors to use for plotting. The names must be in <code>sim$sppEquiv[[sim$sppEquivCol]]</code>, and should also contain a color for ‘Mixed’
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquiv
</td>
<td style="text-align:left;">
table of species equivalencies. See <code>LandR::sppEquivalencies_CA</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
studyArea
</td>
<td style="text-align:left;">
Polygon to use as the study area. Must be provided by the user
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaReporting
</td>
<td style="text-align:left;">
multipolygon (typically smaller/unbuffered than studyArea) to use for plotting/reporting. Defaults to <code>studyArea</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
sufficientLight
</td>
<td style="text-align:left;">
table defining how the species with different shade tolerance respond to stand shade. Default is based on LANDIS-II Biomass Succession v6.2 parameters
</td>
</tr>
<tr>
<td style="text-align:left;">
treedFirePixelTableSinceLastDisp
</td>
<td style="text-align:left;">
3 columns: <code>pixelIndex</code>, <code>pixelGroup</code>, and <code>burnTime</code>. Each row represents a forested pixel that was burned up to and including this year, since last dispersal event, with its corresponding pixelGroup and time it occurred
</td>
</tr>
</tbody>
</table>
<p>Of the above, we draw particular attention to the the following inputs, which are crucial to run <em>Biomass_core</em> on a realistic setting (see <a href="#input-objects-2">Input objects</a> section of the manual for further detail):</p>
<ul>
<li><p>Spatial layers: <code>ecoregionMap</code>, <code>studyArea</code></p></li>
<li><p>Trait and parameter tables: <code>ecoregion</code>, <code>minRelativeB</code>, <code>species</code>, <code>speciesEcoregion</code>, <code>sufficientLight</code>, <code>sppEquiv</code>, <code>sppColorVect</code></p></li>
<li><p>Cohort-simulation related: <code>cohortData</code>, <code>pixelGroupMap</code></p></li>
</ul>
<p>For the beginner user, we suggest running <em>Biomass_core</em> without supplying any inputs and inspecting the above mentioned objects to understand their structure and format. The user can later either feed these objects via <code>simInit</code>, or make a module that makes them and provides necessary inputs to <em>Biomass_core</em> (see e.g. <a href="https://github.com/PredictiveEcology/Biomass_borealDataPrep"><em>Biomass_borealDataPrep</em></a>)</p>
<p>Besides the above mentioned inputs, <em>Biomass_core</em> uses several other parameters, which can be changed by the user if need be (Table @ref(tab:moduleParams-Biomass-core)). Please see the <a href="#parameters-2">Parameters</a> section of the manual for a list of the most useful parameters.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleParams-Biomass-core)List of (ref:Biomass-core) parameters and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
calcSummaryBGM
</td>
<td style="text-align:left;">
A character vector describing when to calculate the summary of biomass, growth and mortality Currently any combination of 5 options is possible: ‘start’- as before vegetation succession events, i.e. before dispersal, ‘postDisp’ - after dispersal, ‘postRegen’ - after post-disturbance regeneration (currently the same as ‘start’), ‘postGM’ - after growth and mortality, ‘postAging’ - after aging, ‘end’ - at the end of vegetation succesion events, before plotting and saving. The ‘end’ option is always active, being also the default option.
</td>
</tr>
<tr>
<td style="text-align:left;">
calibrate
</td>
<td style="text-align:left;">
Do calibration? Defaults to <code>FALSE</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
cohortDefinitionCols
</td>
<td style="text-align:left;">
<code>cohortData</code> columns that determine what constitutes a cohort This parameter should only be modified if additional modules are adding columns to cohortData
</td>
</tr>
<tr>
<td style="text-align:left;">
cutpoint
</td>
<td style="text-align:left;">
A numeric scalar indicating how large each chunk of an internal data.table is, when processing by chunks
</td>
</tr>
<tr>
<td style="text-align:left;">
gmcsGrowthLimits
</td>
<td style="text-align:left;">
if using <code>LandR.CS</code> for climate-sensitive growth and mortality, a percentile is used to estimate the effect of climate on growth/mortality (currentClimate/referenceClimate). Upper and lower limits are suggested to circumvent problems caused by very small denominators as well as predictions outside the data range used to generate the model
</td>
</tr>
<tr>
<td style="text-align:left;">
gmcsMortLimits
</td>
<td style="text-align:left;">
if using <code>LandR.CS</code> for climate-sensitive growth and mortality, a percentile is used to estimate the effect of climate on growth/mortality (currentClimate/referenceClimate). Upper and lower limits are suggested to circumvent problems caused by very small denominators as well as predictions outside the data range used to generate the model
</td>
</tr>
<tr>
<td style="text-align:left;">
gmcsMinAge
</td>
<td style="text-align:left;">
if using <code>LandR.CS</code> for climate-sensitive growth and mortality, the minimum age for which to predict climate-sensitive growth and mortality. Young stands (&lt; 30) are poorly represented by the PSP data used to parameterize the model.
</td>
</tr>
<tr>
<td style="text-align:left;">
growthAndMortalityDrivers
</td>
<td style="text-align:left;">
package name where the following functions can be found: <code>calculateClimateEffect</code>, <code>assignClimateEffect</code> (see <code>LandR.CS</code> for climate sensitivity equivalent functions, or leave default if this is not desired)
</td>
</tr>
<tr>
<td style="text-align:left;">
growthInitialTime
</td>
<td style="text-align:left;">
Initial time for the growth event to occur
</td>
</tr>
<tr>
<td style="text-align:left;">
initialBiomassSource
</td>
<td style="text-align:left;">
Currently, there are three options: ‘spinUp’, ‘cohortData’, ‘biomassMap’. If ‘spinUp’, it will derive biomass by running spinup derived from Landis-II. If ‘cohortData’, it will be taken from the <code>cohortData</code> object, i.e., it is already correct, by cohort. If ‘biomassMap’, it will be taken from <code>sim$biomassMap</code>, divided across species using <code>sim$speciesLayers</code> percent cover values ‘spinUp’ uses <code>sim$standAgeMap</code> as the driver, so biomass is an output . That means it will be unlikely to match any input information about biomass, unless this is set to ‘biomassMap’, and a <code>sim$biomassMap</code> is supplied. Only the ‘cohortData’ option is currently active.
</td>
</tr>
<tr>
<td style="text-align:left;">
keepClimateCols
</td>
<td style="text-align:left;">
include growth and mortality predictions in <code>cohortData</code>?
</td>
</tr>
<tr>
<td style="text-align:left;">
minCohortBiomass
</td>
<td style="text-align:left;">
cohorts with biomass below this threshold (g/m^2) are removed. Not a LANDIS-II BSE parameter.
</td>
</tr>
<tr>
<td style="text-align:left;">
mixedType
</td>
<td style="text-align:left;">
How to define mixed stands: 1 for any species admixture; 2 for deciduous &gt; conifer. See <code>?LandR::vegTypeMapGenerator</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
plotOverstory
</td>
<td style="text-align:left;">
swap max age plot with overstory biomass
</td>
</tr>
<tr>
<td style="text-align:left;">
seedingAlgorithm
</td>
<td style="text-align:left;">
choose which seeding algorithm will be used among ‘noDispersal’, ‘universalDispersal’, and ‘wardDispersal’ (default). See Scheller &amp; Miranda (2015) - Biomass Succession extension, v3.2.1 User Guide
</td>
</tr>
<tr>
<td style="text-align:left;">
spinupMortalityfraction
</td>
<td style="text-align:left;">
defines the mortality loss fraction in spin up-stage simulation. Only used if <code>P(sim)$initialBiomassSource == 'biomassMap'</code>, which is currently deactivated.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to use as a naming convention
</td>
</tr>
<tr>
<td style="text-align:left;">
successionTimestep
</td>
<td style="text-align:left;">
defines the simulation time step, default is 10 years. Note that growth and mortality always happen on a yearly basis.
</td>
</tr>
<tr>
<td style="text-align:left;">
vegLeadingProportion
</td>
<td style="text-align:left;">
a number that defines whether a species is leading for a given pixel
</td>
</tr>
<tr>
<td style="text-align:left;">
.maxMemory
</td>
<td style="text-align:left;">
maximum amount of memory (in GB) to use for dispersal calculations.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
Vector of length = 1, describing the simulation time at which the first plot event should occur. To plotting off completely use <code>P(sim)$.plots</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInterval
</td>
<td style="text-align:left;">
defines the plotting time step. If <code>NA</code>, the default, .plotInterval is set to successionTimestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plots
</td>
<td style="text-align:left;">
Passed to <code>types</code> in <code>Plots</code> (see <code>?Plots</code>). There are a few plots that are made within this module, if set. Note that plots (or their data) saving will ONLY occur at <code>end(sim)</code>. If <code>NA</code> plotting is off completely (this includes plot saving).
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotMaps
</td>
<td style="text-align:left;">
Controls whether maps should be plotted or not. Set to <code>FALSE</code> if <code>P(sim)$.plots == NA</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
Vector of length = 1, describing the simulation time at which the first save event should occur. Set to <code>NA</code> if no saving is desired. If not <code>NA</code>, then saving will occur at <code>P(sim)$.saveInitialTime</code> with a frequency equal to <code>P(sim)$.saveInterval</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
defines the saving time step. If <code>NA</code>, the default, .saveInterval is set to <code>P(sim)$successionTimestep</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
.studyAreaName
</td>
<td style="text-align:left;">
Human-readable name for the study area used. If <code>NA</code>, a hash of <code>studyArea</code> will be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
Internal. Can be names of events or the whole module name; these will be cached by <code>SpaDES</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
.useParallel
</td>
<td style="text-align:left;">
Used only in seed dispersal. If numeric, it will be passed to <code>data.table::setDTthreads</code> and should be &lt;= 2; If <code>TRUE</code>, it will be passed to <code>parallel::makeCluster</code>; and if a cluster object, it will be passed to <code>parallel::parClusterApplyB</code>.
</td>
</tr>
</tbody>
</table>
</div>
<div id="events" class="section level3">
<h3>Events</h3>
<p>Events are scheduled as follows:</p>
<ul>
<li>Module initiation (<code>init</code> event)</li>
<li>Seed dispersal (every <code>successionTimestep</code>; <code>Dispersal</code> event)</li>
<li>Mortality and growth (<code>mortalityAndGrowth</code> event)</li>
<li>Reclassification of age cohorts (every <code>successionTimestep</code>; <code>cohortAgeReclassification</code> event)</li>
<li>Summary tables of regeneration (<code>summaryRegen</code> event), biomass, age, growth and mortality (<code>summaryBGM\*</code> event)</li>
<li>Plots of maps (<code>plotMaps</code> event) and averages (<code>plotAvgs</code> and <code>plotSummaryBySpecies</code> events)</li>
<li>Save (<code>save</code>)</li>
</ul>
</div>
<div id="module-outputs" class="section level3">
<h3>Module outputs</h3>
<p>The module produces the following outputs types. – Plotting – live and/or saved plot objects/images (depending on <code>.plots</code>)</p>
<p>– Saved biomass, mortality, leading vegetation raster layers – Whatever objects supplied to <code>outputs</code> argument in <code>simInit</code>, that are within the <code>simList</code> object.</p>
<p>All <code>simList</code> objects that are changed by <em>Biomass_core</em> (<em>i.e.</em>, the definition of a module output) are listed in Table @ref(tab:moduleOutputs-Biomass-core).</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleOutputs-Biomass-core)List of (ref:Biomass-core) output objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
desc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
activePixelIndex
</td>
<td style="text-align:left;">
internal use. Keeps track of which pixels are active
</td>
</tr>
<tr>
<td style="text-align:left;">
activePixelIndexReporting
</td>
<td style="text-align:left;">
internal use. Keeps track of which pixels are active in the reporting study area
</td>
</tr>
<tr>
<td style="text-align:left;">
ANPPMap
</td>
<td style="text-align:left;">
ANPP map at each succession time step
</td>
</tr>
<tr>
<td style="text-align:left;">
cohortData
</td>
<td style="text-align:left;">
<code>data.table</code> with cohort-level information on age, biomass, aboveground primary productivity (year’s biomass gain) and mortality (year’s biomass loss), by pixelGroup and ecolocation (i.e., <code>ecoregionGroup</code>). Contains at least the following columns: <code>pixelGroup</code> (integer), <code>ecoregionGroup</code> (factor), <code>speciesCode</code> (factor), <code>B</code> (integer in g/m^2), <code>age</code> (integer in years), <code>mortality</code> (integer in g/m^2), <code>aNPPAct</code> (integer in g/m^2). May have other columns depending on additional simulated processes (i.e., cliamte sensitivity; see, e.g., <code>P(sim)$keepClimateCols</code>).
</td>
</tr>
<tr>
<td style="text-align:left;">
ecoregionMap
</td>
<td style="text-align:left;">
ecoregion map that has mapcodes match <code>ecoregion</code> table and <code>speciesEcoregion</code> table. Defaults to a dummy map matching rasterToMatch with two regions
</td>
</tr>
<tr>
<td style="text-align:left;">
inactivePixelIndex
</td>
<td style="text-align:left;">
internal use. Keeps track of which pixels are inactive
</td>
</tr>
<tr>
<td style="text-align:left;">
inactivePixelIndexReporting
</td>
<td style="text-align:left;">
internal use. Keeps track of which pixels are inactive in the reporting study area
</td>
</tr>
<tr>
<td style="text-align:left;">
lastFireYear
</td>
<td style="text-align:left;">
Year of the most recent fire year
</td>
</tr>
<tr>
<td style="text-align:left;">
lastReg
</td>
<td style="text-align:left;">
an internal counter keeping track of when the last regeneration event occurred
</td>
</tr>
<tr>
<td style="text-align:left;">
minRelativeB
</td>
<td style="text-align:left;">
define the cut points to classify stand shade
</td>
</tr>
<tr>
<td style="text-align:left;">
mortalityMap
</td>
<td style="text-align:left;">
Mortality map at each succession time step
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupMap
</td>
<td style="text-align:left;">
updated community map at each succession time step
</td>
</tr>
<tr>
<td style="text-align:left;">
regenerationOutput
</td>
<td style="text-align:left;">
If <code>P(sim)$calibrate == TRUE</code>, an summary of seed dispersal and germination success (i.e., number of pixels where seeds successfully germinated) per species and year.
</td>
</tr>
<tr>
<td style="text-align:left;">
reproductionMap
</td>
<td style="text-align:left;">
Regeneration map at each succession time step
</td>
</tr>
<tr>
<td style="text-align:left;">
simulatedBiomassMap
</td>
<td style="text-align:left;">
Biomass map at each succession time step (in g/m^2)
</td>
</tr>
<tr>
<td style="text-align:left;">
simulationOutput
</td>
<td style="text-align:left;">
contains simulation results by ecoregion (main output)
</td>
</tr>
<tr>
<td style="text-align:left;">
simulationTreeOutput
</td>
<td style="text-align:left;">
Summary of several characteristics about the stands, derived from <code>cohortData</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
a table that has species traits such as longevity, shade tolerance, etc. Currently obtained from LANDIS-II Biomass Succession v.6.0-2.0 inputs
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesEcoregion
</td>
<td style="text-align:left;">
define the maxANPP, maxB and SEP change with both ecoregion and simulation time
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesLayers
</td>
<td style="text-align:left;">
biomass percentage raster layers by species in Canada species map
</td>
</tr>
<tr>
<td style="text-align:left;">
spinupOutput
</td>
<td style="text-align:left;">
Spin-up output
</td>
</tr>
<tr>
<td style="text-align:left;">
summaryBySpecies
</td>
<td style="text-align:left;">
The total species biomass (in g/m^2 as in <code>cohortData</code>), average age and aNPP (in g/m^2 as in <code>cohortData</code>), across the landscape (used for plotting and reporting).
</td>
</tr>
<tr>
<td style="text-align:left;">
summaryBySpecies1
</td>
<td style="text-align:left;">
No. pixels of each leading vegetation type (used for plotting and reporting).
</td>
</tr>
<tr>
<td style="text-align:left;">
summaryLandscape
</td>
<td style="text-align:left;">
The averages of total biomass (in tonnes/ha , not g/m^2 like in <code>cohortData</code>), age and aNPP (also in tonnes/ha) across the landscape (used for plotting and reporting).
</td>
</tr>
<tr>
<td style="text-align:left;">
treedFirePixelTableSinceLastDisp
</td>
<td style="text-align:left;">
3 columns: <code>pixelIndex</code>, <code>pixelGroup</code>, and <code>burnTime</code>. Each row represents a forested pixel that was burned up to and including this year, since last dispersal event, with its corresponding pixelGroup and time it occurred
</td>
</tr>
<tr>
<td style="text-align:left;">
vegTypeMap
</td>
<td style="text-align:left;">
Map of leading species in each pixel, colored according to <code>sim$sppColorVect</code>. Species mixtures calculated according to <code>P(sim)$vegLeadingProportion</code> and <code>P(sim)</code>$mixedType.
</td>
</tr>
</tbody>
</table>
</div>
<div id="links-to-other-modules" class="section level3">
<h3>Links to other modules</h3>
<p>Intended to be used with other landscape modules, such as <em>LandMine</em>, <em>fireSense</em>, <em>Biomass_borealDataPrep</em>, <em>Biomass_regeneration</em> and possibly many others. You can see all <em>potential</em> module linkages within the LandR ecosystem <a href="https://rpubs.com/PredictiveEcology/LandR_Module_Ecosystem">here</a>. Select <em>Biomass_core</em> from the drop-down menu to see linkages.</p>
</div>
<div id="getting-help" class="section level3">
<h3>Getting help</h3>
<ul>
<li><a href="https://github.com/PredictiveEcology/Biomass_core/issues" class="uri">https://github.com/PredictiveEcology/Biomass_core/issues</a></li>
</ul>
</div>
</div>
<div id="module-manual" class="section level2">
<h2>Module manual</h2>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>LandR <em>Biomass_core</em> (hereafter <em>Biomass_core</em>) a forest landscape model based on the LANDIS-II Biomass Succession Extension v.3.2.1 model [LBSE; <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span>]. It is the core forest succession model of the LandR ecosystem of <code>SpaDES</code> modules. Similarly to the LBSE, <em>Biomass_core</em> simulates changes in tree cohort aboveground biomass (g/m<sup>2</sup>.) by calculating growth, mortality and recruitment as functions of pixel and species characteristics, competition and disturbances (Fig. @ref(fig:fig-Biomass-core)). Specifically, growth is driven by both invariant (<code>growthcurve</code>) and spatially varying species growth traits (maximum biomass, <code>maxB</code>, and maximum annual net primary productivity, <code>maxANPP</code>), while mortality depends only on invariant species traits (<code>age</code>, <code>longevity</code> and <code>mortalityshape</code>). Disturbances (e.g., fire) can also cause cohort mortality, but are simulated in separate modules (e.g., <em>Biomass_regeneration</em> simulates the death of all cohorts immediately after a fire). The parameters <code>growthcurve</code> and <code>mortalityshape</code> directly influence the shape of species growth curves, by determining how fast they grow and how soon age mortality starts with respect to longevity. Cohort recruitment is determined by available “space” (<em>i.e.</em>, pixel shade), invariant species traits (regeneration mode, age at maturity, shade tolerance) and spatially varying traits (species establishment probability, <code>SEP</code>). The available “growing space” is calculated as species <code>maxB</code> minus the occupied biomass (summed across other cohorts and species). If there is “space”, a cohort can establish from one of three recruitment modes: serotiny, resprouting and germinating. Serotiny and resprouting occur only in response to fire and are simulated in two separate, but interchangeable modules, <em>Biomass_regeneration</em> and <em>Biomass_regenerationPM</em>. Germination occurs if seeds are made available from local sources (the pixel), or via seed dispersal. Seed dispersal can be of three modes: ‘no dispersal’, ‘universal dispersal’ (only interesting for dummy case studies) or ‘ward dispersal’ <span class="citation">(<a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>. The ‘ward dispersal’ algorithm describes a flexible kernel that calculates the probability of a species colonising a neighbour pixel as a function of distance from the source and dispersal-related (and invariant) species traits, and is used by default. We refer the reader to <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span>, <span class="citation">Scheller &amp; Domingo (<a href="#ref-SchellerDomingo2011" role="doc-biblioref">2011</a>)</span> and <span class="citation">Scheller &amp; Domingo (<a href="#ref-SchellerDomingo2012" role="doc-biblioref">2012</a>)</span> for further details with respect to the mechanisms implemented in the module.</p>
</div>
<div id="differences-between-biomass_core-and-lbse" class="section level3">
<h3>Differences between <em>Biomass_core</em> and LBSE</h3>
<div id="algorithm-changes" class="section level4">
<h4>Algorithm changes</h4>
<p>Upon porting LBSE into R, we made six minor modifications to the original model’s algorithms to better reflect ecological processes. This did not result in dramatic changes in simulation outputs and we note that these changes might also have been implemented in more recent versions of LBSE.</p>
<p>First, for each year and community (<em>i.e.</em>, ‘pixel group’ in <em>Biomass_core</em>, see below), LBSE calculates the competition index for a cohort sequentially (<em>i.e.</em>, one cohort at a time) after updating the growth and mortality (<em>i.e.</em>, the biomass gain and loss, respectively) of other cohorts, and with the calculation sequence following cohort age in descending order, but no explicit order of species. This sorting of growth and mortality calculations from oldest to youngest cohorts in LBSE was aimed at capturing size-asymmetric competition between cohorts, under the assumption that older cohorts have priority for growing space given their greater height (Scheller pers. comm.). We felt that sequential, within-year growth, death and recruitment may be not ecologically accurate, and that the size-asymmetric competition was being accounted for twice, as the calculation of the competition index already considers the competitive advantage of older cohorts [as shown in the User’s Guide; <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span>]. Hence, in <em>Biomass_core</em> growth, mortality and the competition index are calculated at the same time across all cohorts and species.</p>
<p>Second, the unknown species-level sorting mechanism contained within LBSE (which changed depending on the species order in the input species list file), led to different simulation results depending on the input species list file (e.g., Table @ref(tab:tableLBSEtest1) and Fig. @ref(fig:figLBSEtest1)). The calculation of competition, growth and mortality for all cohorts at the same time also circumvented this issue.</p>
<p>Third, in LBSE the calculation of total pixel biomass for the purpose of calculating the initial biomass of a new cohort included the (previously calculated) biomass of other new cohorts when succession time step = 1, but not when time step was &gt; 1. This does not reflect the documentation in the User’s Guide, which stated that “Bsum [total pixel biomass] is the current total biomass for the site (not including other new cohorts)” <span class="citation">(<a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>, when the succession time step was set to 1. Additionally, together with the lack of explicit ordering, it generated different results in terms of the biomass assigned to each new cohort (e.g. Table @ref(tab:tableLBSEtest2) and Fig. @ref(fig:figLBSEtest2)). In <em>Biomass_core</em> the initial biomass of new cohorts is no longer calculated sequentially (as with competition, growth and mortality), and thus the biomass of new cohorts is never included in the calculation of total pixel biomass.</p>
<p>Fourth, in LBSE, serotiny and resprouting could not occur in the same pixel following a fire, with serotiny taking precedence if activated. We understand that this provides an advantage to serotinous species, which could perhaps be disadvantaged with respect to fast-growing resprouters. However, we feel that it is ecologically more realistic that serotinous and resprouter species be able to both regenerate in a given community following a fire and allow the competition between serotinous and resprouting species to arise from species traits. <strong>Note that this change was implemented in the <em>Biomass_regeneration</em> and <em>Biomass_regenerationPM</em> modules.</strong></p>
<p>Fifth, in <em>Biomass_core</em>, species shade tolerance values can have decimal values to allow for finer adjustments of between-species competition.</p>
<p>Sixth, we added a new parameter called <code>minCohortBiomass</code>, that allows the user to control cohort removal bellow a certain threshold of biomass. In some simulation set-ups, we noticed that <em>Biomass_core</em> (and LBSE) were able to generate many very small cohorts in the understory that, due to cohort competition, were not able to gain biomass and grow. However, because competition does not increase mortality, only decreases growth, these cohorts survived at very low biomass levels until they reached sufficient age to suffer age-related mortality. We felt this is unlikely to be realistic in many cases. By default, this parameter is left at 0 to follow LBSE behaviour (<em>i.e.</em>, no cohorts removal based on minimum biomass).</p>
</div>
<div id="other-enhancements" class="section level4">
<h4>Other enhancements</h4>
<p>In addition to the five minor changes in growth, mortality and regeneration, we separated the components that govern vegetation responses to disturbances – only fire at the moment – into two independent modules, used interchangeably, and implemented hashing, caching and testing to improve the model’s computational efficiency and insure its performance.</p>
<div id="modularity" class="section level5">
<h5>Modularity</h5>
<p>Unlike in LBSE, post-disturbance regeneration is not part of <em>Biomass_core</em> <em>per se</em>, but belongs to two separate modules, used interchangeably (<a href="https://github.com/PredictiveEcology/Biomass_regeneration/blob/master/Biomass_regeneration.Rmd"><em>Biomass_regeneration</em></a> and <a href="https://github.com/PredictiveEcology/Biomass_regenerationPM/blob/master/Biomass_regenerationPM.Rmd"><em>Biomass_regenerationPM</em></a>). These need to be loaded and added to the “modules folder” of the project in case the user wants to simulate forest responses to disturbances (only fire disturbances at the moment). Again, this enables higher flexibility when swapping between different approaches to regeneration. For instance, default (<em>i.e.</em>, not climate sensitive) growth and mortality functions are part of the <code>LandR</code> R package, which needs to be loaded prior to running <em>Biomass_core</em>. Should the user wish to change the growth/mortality algorithms, they would need to provide compatible functions (with the same names) to the simulation via <code>simInit</code> – user-provided functions will replace those loaded with a package <!-- we should have an example of this-->. Note that the <code>LandR</code> package provides other supporting functions and objects to the simulation, and still needs to be loaded prior to running <em>Biomass_core</em>.</p>
</div>
<div id="hashing" class="section level5">
<h5>Hashing</h5>
<p>Our first strategy to improve simulation efficiency in <em>Biomass_core</em> was to use a hashing mechanism <span class="citation">(<a href="#ref-YangEtAl2011" role="doc-biblioref">Yang <em>et al.</em> 2011</a>)</span>. Instead of assigning a key to each pixel in a raster and tracking the simulation for each pixel in a lookup table, we indexed pixels using a <em>pixelGroup</em> key that contained unique combinations of ecolocation and community, and tracked and stored simulation data for each <em>pixelGroup</em> (Fig. @ref(fig:figLBSEtest3)). Ecolocation (called ‘ecoregion’ in LBSE and in model objects) is a spatial unit with similar biophysical characteristics. In our applications, we define ecolocation as the combination of land-cover types from the Land Cover Map of Canada 2005 (v1) and ecodistricts from the National Ecological Framework for Canada (<!--add source-->). Hence, these ecolocations contain relatively fine scale land cover information plus coarse scale regional information. In turn, community is the species composition and age structure of a particular pixel. This algorithm was able to ease the computational burden by significantly reducing the size of the lookup table and speeding-up the simulation process. After recruitment and disturbance events, pixels are rehashed into new pixel groups.</p>
</div>
<div id="caching" class="section level5">
<h5>Caching</h5>
<p>The second strategy aimed at improving model efficacy was the implementation of caching, and data-driven parametrisation and initialisation. Caching automatically archives outputs of a given function to disk (or memory) and reads them back when subsequent calls of this function are given identical inputs. All caching operations were achieved using the <code>reproducible</code> R package <span class="citation">(<a href="#ref-McIntireChubaty2020" role="doc-biblioref">McIntire &amp; Chubaty 2020</a>)</span>. In the current version of <em>Biomass_core</em>, the spin-up phase was replaced by data-driven landscape initialisation and many model parameters were derived from data, using “data modules” (e.g., <em>Biomass_borealDataPrep</em>). To avoid having to repeat data downloads and treatment, statistical estimation of parameters and landscape initialisation every time the simulation is re-run under the same conditions (<em>i.e.</em>, no data or algorithm changes), many of these pre-simulation steps are automatically cached. This means that the pre-simulation phase is significantly faster upon a second call when inputs have not changed (e.g., the input data and parametrisation methods), and when inputs do change only directly affected steps are re-run (see main text for examples). When not using data modules, <em>Biomass_core</em> still relies on caching for the preparation of its theoretical inputs.</p>
</div>
<div id="testing" class="section level5">
<h5>Testing</h5>
<p>Finally, we implemented code testing, to facilitate bug detection by comparing the outputs of functions [etc.] to expected outputs <span class="citation">(<a href="#ref-Wickham2011" role="doc-biblioref">Wickham 2011</a>)</span>. We built and integrated code tests in <em>Biomass_core</em> and across all LandR modules and the <code>LandR</code> R package <!-- package name may change --> and the in the form of assertions and integration tests. Assertions are run automatically during simulations (but can be turned off), while integration are be run manually. Tests were also implemented in R package dependencies of <em>Biomass_core</em>, such as the <code>LandR</code> R package <!-- package name may change --> and <code>SpaDES</code>, which are routinely tested using GitHub Actions continuous integration (CI) or automated checks on CRAN. For the <code>LandR</code> R package, we use GitHub Actions CI to automatically test for installation and execution errors.</p>
<p>Finally, because <em>Biomass_core</em> (and all other LandR modules) code is hosted in public GitHub repositories, there is a potentially high number of users that can identify issues and contribute to improve module code.</p>
</div>
</div>
<div id="performance-and-accuracy-of-biomass_core-with-respect-to-lbse" class="section level4" data-link="Algorithm changes">
<h4>Performance and accuracy of <em>Biomass_core</em> with respect to LBSE</h4>
<p>In the recoding of <em>Biomass_core</em>, we ensured similar outputs of each demographic process (namely, growth, mortality and recruitment) to the outputs from its counterpart in LBSE, using integration tests. Here, we report the comparisons of the overall simulation (i.e., including all demographic processes) between LBSE and <em>Biomass_core</em> using three randomly generated initial communities (Tables @ref(tab:tableLBSEtest3)-@ref(tab:tableLBSEtest5)). The remaining input parameters were taken from a LANDIS-II training course (Tables @ref(tab:tableLBSEtest6)-@ref(tab:tableLBSEtest9)), and contained species attributes information of 16 common tree species in boreal forests and 2 ecolocations. We ran simulations for 1000 years, with a succession time step of 10 and three repetitions, which were enough to account for the variability produced by stochastic processes. Seed dispersal was set as “ward dispersal”.</p>
<p>The results suggested that <em>Biomass_core</em> had a good agreement with LBSE using the three randomly generated initial communities (Fig. @ref(fig:figLBSEtest4)), with very small deviations for LBSE-generated biomasses. Notably, the mean differences between LBSE and <em>Biomass_core</em> were 0.03% (range: -0.01% ~ 0.13%), 0.03% (range: -0.01% ~ 0.11%) and 0.05% (-0.02% ~ 0.15%) for each initial community, respectively (right panels in Fig. @ref(fig:figLBSEtest4) of this appendix).</p>
<p>To examine how running time changed with map size, we ran simulations using maps with increasing number of pixels from 22,201 to 638,401. All maps were initialised with a single ecolocation and 7 different communities. Simulations were run for 120 years using a succession time step of 10 and replicated three times. To eliminate the effect of hardware on running time, we used machines that were all purchased at the same time, with equal specifications and running Windows 7. Each simulation ran on 2 CPU threads with a total RAM of 4000 Mb. For both LBSE and <em>Biomass_core</em>, the simulation time increased linearly with number of pixels, but the increase rate was smaller for <em>Biomass_core</em> (Fig. @ref(fig:figLBSEtest5)a). This meant that while both models had similar simulation efficiencies in small maps (&lt; 90,000 pixels), as map size increased <em>Biomass_core</em> was ~2 times faster than LBSE (maps &gt; 100,000 pixels; Fig. @ref(fig:figLBSEtest5)a). <em>Biomass_core</em> also scaled better with map size, as LBSE speeds fluctuated between 19 to 25 seconds per 1,000 pixels across all map sizes, while <em>Biomass_core</em> decreased from 21 to 11 seconds per 1,000 pixels from smaller to larger maps (Fig. @ref(fig:figLBSEtest5)b).</p>
</div>
</div>
<div id="initialization-inputs-and-parameters" class="section level3">
<h3>Initialization, inputs and parameters</h3>
<p>Unlike the initialization in LBSE, which “iterates the number of time steps equal to the maximum cohort age for each site”, beginning at <em>t</em> – oldest cohort age and adding cohorts at the appropriate time <span class="citation">(<a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>, <em>Biomass_core</em> initializes the simulation by deriving initial biomasses from available data, using data modules. If data modules are not available, <em>Biomass_core</em> initializes itself with theoretical data.</p>
<p>To be initialized, <em>Biomass_core</em> requires the following input objects and parameters:</p>
<div id="input-objects" class="section level4">
<h4>Input objects</h4>
<p>All of <em>Biomass_core</em>’s input objects have (theoretical) defaults that are produced automatically by the module (when running the <code>.inputObjects</code> function during the <code>simInit</code> call, and in the <code>init</code> event during the <code>spades</code> call – see <code>?SpaDES.core::events</code> and <code>SpaDES.core::simInit</code>). We suggest that new users run <em>Biomass_core</em> by itself supplying only a <code>studyArea</code> object. This will enable them to become familiar with all the input objects before attempting to supply their own, or combine <em>Biomass_core</em> with data modules.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleInputs2-Biomass-core)List of (ref:Biomass-core) input objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
objectClass
</th>
<th style="text-align:left;">
desc
</th>
<th style="text-align:left;">
sourceURL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
biomassMap
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
total biomass raster layer in study area (in g/m^2), filtered for pixels covered by cohortData. Only used if <code>P(sim)$initialBiomassSource == 'biomassMap'</code>, which is currently deactivated.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
cceArgs
</td>
<td style="text-align:left;">
list
</td>
<td style="text-align:left;">
a list of quoted objects used by the <code>growthAndMortalityDriver</code> <code>calculateClimateEffect</code> function
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
cohortData
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
<code>data.table</code> with cohort-level information on age and biomass, by pixelGroup and ecolocation (i.e., <code>ecoregionGroup</code>). If supplied, it must have the following columns: <code>pixelGroup</code> (integer), <code>ecoregionGroup</code> (factor), <code>speciesCode</code> (factor), <code>B</code> (integer in g/m^2), <code>age</code> (integer in years)
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ecoregion
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
ecoregion look up table
</td>
<td style="text-align:left;">
<a href="https://raw.githubusercontent.com/LANDIS-II-Foundation/Extensions-Succession/master/biomass-succession-archive/trunk/tests/v6.0-2.0/ecoregions.txt" class="uri">https://raw.githubusercontent.com/LANDIS-II-Foundation/Extensions-Succession/master/biomass-succession-archive/trunk/tests/v6.0-2.0/ecoregions.txt</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
ecoregionMap
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
ecoregion map that has mapcodes match ecoregion table and <code>speciesEcoregion</code> table. Defaults to a dummy map matching <code>rasterToMatch</code> with two regions
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
lastReg
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
an internal counter keeping track of when the last regeneration event occurred
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
minRelativeB
</td>
<td style="text-align:left;">
data.frame
</td>
<td style="text-align:left;">
table defining the relative biomass cut points to classify stand shadeness
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupMap
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
initial community map that has mapcodes match initial community table
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
rasterToMatch
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
a raster of the <code>studyArea</code> in the same resolution and projection as <code>biomassMap</code>
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
a table that has species traits such as longevity, shade tolerance, etc. Default is partially based on Dominic Cyr and Yan Boulanger’s project
</td>
<td style="text-align:left;">
<a href="https://raw.githubusercontent.com/dcyr/LANDIS-II_IA_generalUseFiles/master/speciesTraits.csv" class="uri">https://raw.githubusercontent.com/dcyr/LANDIS-II_IA_generalUseFiles/master/speciesTraits.csv</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesEcoregion
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table defining the maxANPP, maxB and SEP, which can change with both ecoregion and simulation time. Defaults to a dummy table based on dummy data os biomass, age, ecoregion and land cover class
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesLayers
</td>
<td style="text-align:left;">
RasterStack
</td>
<td style="text-align:left;">
percent cover raster layers of tree species in Canada. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2001 using a cover threshold of 10 - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata
</td>
<td style="text-align:left;">
<a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
sppColorVect
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
A named vector of colors to use for plotting. The names must be in <code>sim$sppEquiv[[sim$sppEquivCol]]</code>, and should also contain a color for ‘Mixed’
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquiv
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table of species equivalencies. See <code>LandR::sppEquivalencies_CA</code>.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
studyArea
</td>
<td style="text-align:left;">
SpatialPolygonsDataFrame
</td>
<td style="text-align:left;">
Polygon to use as the study area. Must be provided by the user
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaReporting
</td>
<td style="text-align:left;">
SpatialPolygonsDataFrame
</td>
<td style="text-align:left;">
multipolygon (typically smaller/unbuffered than studyArea) to use for plotting/reporting. Defaults to <code>studyArea</code>.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
sufficientLight
</td>
<td style="text-align:left;">
data.frame
</td>
<td style="text-align:left;">
table defining how the species with different shade tolerance respond to stand shade. Default is based on LANDIS-II Biomass Succession v6.2 parameters
</td>
<td style="text-align:left;">
<a href="https://raw.githubusercontent.com/LANDIS-II-Foundation/Extensions-Succession/master/biomass-succession-archive/trunk/tests/v6.0-2.0/biomass-succession_test.txt" class="uri">https://raw.githubusercontent.com/LANDIS-II-Foundation/Extensions-Succession/master/biomass-succession-archive/trunk/tests/v6.0-2.0/biomass-succession_test.txt</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
treedFirePixelTableSinceLastDisp
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
3 columns: <code>pixelIndex</code>, <code>pixelGroup</code>, and <code>burnTime</code>. Each row represents a forested pixel that was burned up to and including this year, since last dispersal event, with its corresponding pixelGroup and time it occurred
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Of the inputs in Table @ref(tab:moduleInputs2-Biomass-core), the following are particularly important and deserve special attention:</p>
<ul>
<li><p><strong>Spatial layers</strong></p>
<ul>
<li><p><code>ecoregionMap</code> – a raster layer with ecolocation IDs (note that the term “ecoregion” was inherited from LBSE and kept as is for consistency with original LBSE code). Ecolocations group pixels or similar biophysical conditions using up to two levels of grouping. In many of our applications, we use the Natural Ecoregion classification of Canada as the first grouping level and a land-cover classification as the second level. The raster layer must be defined as a categorical variable, with an associated Raster Attribute Table (RAT; see, e.g., <code>raster::ratify</code>). The RAT must contain the columns: <code>ID</code> (the value in the raster layer), <code>ecoregion</code> (the first level of ecolocation grouping) and <code>ecoregionGroup</code> (the full ecolocation “name” written as &lt;firstlevel_secondlevel&gt;). Note that <code>ecoregionGroup</code> usually originated from combining two raster layers and, thus, the grouping level IDs are also integers. For instance, if Natural Ecoregion <code>2</code> has land-cover types <code>1</code>, <code>2</code> and <code>3</code>, the RAT will contain <code>ID = {1,2,3}</code>, <code>ecoregion = {2}</code> and <code>ecoregionGroup = {2_1, 2_2, 2_3}</code>. All ecolocations are listed in the <code>ecoregion</code> <code>data.table</code>.</p></li>
<li><p><code>rasterToMatch</code> – a RasterLayer, with a given resolution and projection determining the pixels (<em>i.e.</em>, non NA values) where forest dynamics will be simulated. Needs to match <code>studyArea</code>. If not supplied, <em>Biomass_core</em> attempts to produce it, using <code>biomassMap</code> as the template for spatial resolution and projection.</p></li>
<li><p><code>studyArea</code> – shapefile. A <code>SpatialPolygonsDataFrame</code> with a single polygon determing the where the simulation will take place. This is the only input object that <strong>must be supplied by the user</strong>.</p></li>
</ul></li>
<li><p><strong>Species traits and other parameter tables</strong></p>
<ul>
<li><p><code>ecoregion</code> – <code>data.table</code> listing all ecolocation “names” (<em>ecoregionGroup</em> column; see <code>ecoregionMap</code> above for details) and their state (active – <code>yes</code> – or inactive – <code>no</code>)</p></li>
<li><p><code>minRelativeB</code> – <code>data.table</code> of minimum relative biomass values. This is a spatially variant trait used to determine the shade level in each pixel <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>, yet in our applications we often keep values constant across ecolocations. The table must contain the following columns:</p>
<ul>
<li><p><em>ecoregionGroup –</em> character. Ecolocation names. See <code>ecoregionMap</code> and <code>ecoregion</code> objects above.</p></li>
<li><p><em>X0-X5</em> – six numeric columns, one per shade class (no-shade, 0, to maximum shade, 5), with 0 to 1 values determining the minimum threshold of biomass (relative to the species/ecolocation <code>maxB</code>) necessary to reach a given shade-level. This means that shade-levels are determined on a species by species basis <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span></p></li>
</ul></li>
<li><p><code>species</code> – <code>data.table</code> of <em>invariant species traits</em>. There are species traits that do no vary spatially, nor temporally (e.g., longevity). The table must contain the following trait values (<em>i.e.</em>, columns) in order to run <em>Biomass_core</em> (note that columns should follow the data type indicated):</p>
<ul>
<li><p><em>speciesCode –</em> character. Species ID.</p></li>
<li><p><em>longevity –</em> integer. Maximum age in years <span class="citation">(see <a href="#ref-SchellerDomingo2011" role="doc-biblioref">Scheller &amp; Domingo 2011</a>)</span>.</p></li>
<li><p><em>sexualmature –</em> integer. Age at sexual maturity in years <span class="citation">(see <a href="#ref-SchellerDomingo2011" role="doc-biblioref">Scheller &amp; Domingo 2011</a>)</span>.</p></li>
<li><p><em>shadetolerance –</em> integer OR numeric. <em>Relative</em> shade tolerance (see <a href="#algorithm-changes">Algorithm changes</a>).</p></li>
<li><p><em>seeddistance_eff –</em> integer. Eeffective seed distance in meters. <span class="citation">(see <a href="#ref-SchellerDomingo2011" role="doc-biblioref">Scheller &amp; Domingo 2011</a>)</span></p></li>
<li><p><em>seeddistance_max –</em> integer. Maximum seed distance in meters. Note that is the pixel size is larger than the maximum seed distance, the species will not be able to disperse to neighbouring pixels <span class="citation">(see <a href="#ref-SchellerDomingo2011" role="doc-biblioref">Scheller &amp; Domingo 2011</a>)</span>.</p></li>
<li><p><em>mortalityshape –</em> integer. Shape of growth curve determining how quickly mortality begins <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>.</p></li>
<li><p><em>growthcurve –</em> numeric. Shape of growth curve determining ANPP reaches its maximum <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>.</p></li>
</ul></li>
<li><p><code>speciesEcoregion</code> – <code>data.table</code> of <em>spatiotemporally-varying species traits</em>. There are species traits vary spatially and, potentially, temporally. The table must contain the following columns in order to run <em>Biomass_core</em>:</p>
<ul>
<li><p><em>ecoregionGroup</em> – character. Ecolocation names. See <code>ecoregionMap</code> and <code>ecoregion</code> objects above.</p></li>
<li><p><em>speciesCode</em> – character. Species ID.</p></li>
<li><p><em>establishprob</em> – numeric. Species establishment probability (<code>SEP</code>) for a given species in an ecolocation and, potentially year. SEP influences the success of incoming seed germination, given pixel biophysical characteristics (note that <em>actual</em> success is determined by both SEP and light conditions in the pixel) <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>.</p></li>
<li><p><em>maxB</em> – integer. Maximum biomass for a given species in an ecolocation in units of g biomass / m<sup>2</sup>. Note that the actual maximum biomass reached by a species in a pixel may exceed <code>maxB</code> because <code>maxB</code> is applied at the cohort level an species may have several cohorts in a given pixel <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>.</p></li>
<li><p><em>maxANPP</em> – numeric. Maximum aboveground net primary productivity in units of g biomass / m<sup>2</sup> / year, by default it is calculated as 1/30 of <code>maxB</code> <span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span></p></li>
<li><p><em>year</em> – integer. Used when varying <code>SEP</code>, <code>maxB</code> and <code>maxANPP</code> values in time. Otherwise, use fill all lines with <code>0</code>.</p></li>
</ul></li>
<li><p><code>sufficientLight</code> – <code>data.table</code> defining the probability of germination for a species, given its <code>shadetolerance</code> level (see <code>species</code> above) and the shade level in the pixel (see <code>minRelativeB</code> above). Must contain columns:</p>
<ul>
<li><p><em>speciesshadetolerance</em> – integer. Species shade tolerance levels, from 1-5 (all levels must be present in this table).</p></li>
<li><p><em>X0-X5</em> – six integer columns, one per shade class (no-shade, 0, to maximum shade, 5), filled with 0s OR 1s values determining the probability of germination (or resprouting) for a species given a shade-level<span class="citation">(see <a href="#ref-SchellerMiranda2015" role="doc-biblioref">Scheller &amp; Miranda 2015</a>)</span>. Unlike LBSE, species <code>shadetolerance</code> values can take decimal values between 1-5, in which case the resulting probability of germination in a given pixel is interpolated between the corresponding lower and upper shade tolerance values.</p></li>
</ul></li>
<li><p><code>sppEquiv</code> – a <code>data.table</code> of species name equivalencies between various conventions. It must contain the columns <em>LandR</em> (species IDs following in LandR format) <em>EN_generic_short</em> (short generic species names in English – or any other language; used for plotting), <em>Type</em> (type of species, <em>Conifer</em> or <em>Deciduous</em>, as in “broadleaf”) and <em>Leading</em> (same as <em>EN_generic_short</em> but with “leading” appended – e.g., “Poplar leading”) <!-- we should add an assertion that checks whether these columns are present early on!!! -->. See <code>?LandR::sppEquivalencies_CA</code> for more information.</p></li>
<li><p><code>sppColorVect</code> – character. A named vector of colours used to plot species dynamics. Should contain one colour per species in the <code>species</code> table and, potentially a colour for species mixtures (named “Mixed”). Vector names must follow <code>species$speciesCode</code>.</p></li>
</ul></li>
<li><p><strong>Cohort-simulation-related objects</strong></p>
<ul>
<li><p><code>cohortData</code> – a <code>data.table</code> containing initial cohort information per <em>pixelGroup</em> (see <code>pixelGroupMap</code> below). This table is updated during the simulation as cohort dynamics are simulated. Must contain the following columns</p>
<ul>
<li><p><em>pixelGroup</em> – integer. <em>pixelGroup</em> ID. See <a href="#hashing">Hashing</a>.</p></li>
<li><p><em>ecoregionGroup</em> – character. Ecolocation names. See <code>ecoregionMap</code> and <code>ecoregion</code> objects above.</p></li>
<li><p><em>speciesCode</em> – character. Species ID.</p></li>
<li><p><em>age</em> – integer. Cohort age.</p></li>
<li><p><em>B</em> – integer. cohort biomass in g/m<sup>2</sup>.</p></li>
<li><p><em>mortality</em> – integer. cohort dead biomass in the current year in g/m<sup>2</sup>. Should be filled with 0s in initial conditions.</p></li>
<li><p><em>aNPPAct</em> – integer. Actual aboveground net primary productivity of the current year in g/m<sup>2</sup>. Hence <em>B</em> is the result of the previous year’s <em>B</em> minus <em>mortality</em> plus <em>aNPPAct</em>. See “1.1.3 Cohort growth and ageing” section of <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span>.</p></li>
</ul></li>
<li><p><code>pixelGroupMap</code> – a raster layer with <em>pixelGroup</em> IDs per pixel. Pixels are always grouped based on identical <em>ecoregionGroup</em>, <em>speciesCode</em>, <em>age</em> and <em>B</em> composition, even if the user supplies other initial groupings (e.g., this is possible in the <em>Biomass_borealDataPrep</em> data module).</p></li>
</ul></li>
</ul>
</div>
<div id="parameters" class="section level4">
<h4>Parameters</h4>
<p>Table @ref(tab:moduleParams2-Biomass-core) lists all parameters used in <em>Biomass_core</em>. Note that a few of these parameters are only relevant when simulating climate effects of cohort growth and mortality, which require also loading the <code>LandR.CS</code> R package. Like with input objects, default values are supplied for all parameters and we suggest the user becomes familiarized with them before attempting any changes. We also note that the <code>"spin-up"</code> and <code>"biomassMap"</code> options for the <code>initialBiomassSource</code> are currently deactivated, since <em>Biomass_core</em> no longer generates initial cohort biomass conditions using a spin-up based on initial stand age like LANDIS-II (<code>"spin-up"</code>), nor does it attempt to fill initial cohort biomasses using <code>biomassMap</code> (<code>"biomassMap"</code>). A list of useful parameters and their description is shown in Table @ref(tab:tableUsefulParams).</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleParams2-Biomass-core)List of (ref:Biomass-core) parameters and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramClass
</th>
<th style="text-align:left;">
default
</th>
<th style="text-align:left;">
min
</th>
<th style="text-align:left;">
max
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
calcSummaryBGM
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
end
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
A character vector describing when to calculate the summary of biomass, growth and mortality Currently any combination of 5 options is possible: ‘start’- as before vegetation succession events, i.e. before dispersal, ‘postDisp’ - after dispersal, ‘postRegen’ - after post-disturbance regeneration (currently the same as ‘start’), ‘postGM’ - after growth and mortality, ‘postAging’ - after aging, ‘end’ - at the end of vegetation succesion events, before plotting and saving. The ‘end’ option is always active, being also the default option.
</td>
</tr>
<tr>
<td style="text-align:left;">
calibrate
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Do calibration? Defaults to <code>FALSE</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
cohortDefinitionCols
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
pixelGro….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<code>cohortData</code> columns that determine what constitutes a cohort This parameter should only be modified if additional modules are adding columns to cohortData
</td>
</tr>
<tr>
<td style="text-align:left;">
cutpoint
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
1e+10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
A numeric scalar indicating how large each chunk of an internal data.table is, when processing by chunks
</td>
</tr>
<tr>
<td style="text-align:left;">
gmcsGrowthLimits
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
66.66666….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
if using <code>LandR.CS</code> for climate-sensitive growth and mortality, a percentile is used to estimate the effect of climate on growth/mortality (currentClimate/referenceClimate). Upper and lower limits are suggested to circumvent problems caused by very small denominators as well as predictions outside the data range used to generate the model
</td>
</tr>
<tr>
<td style="text-align:left;">
gmcsMortLimits
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
66.66666….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
if using <code>LandR.CS</code> for climate-sensitive growth and mortality, a percentile is used to estimate the effect of climate on growth/mortality (currentClimate/referenceClimate). Upper and lower limits are suggested to circumvent problems caused by very small denominators as well as predictions outside the data range used to generate the model
</td>
</tr>
<tr>
<td style="text-align:left;">
gmcsMinAge
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
if using <code>LandR.CS</code> for climate-sensitive growth and mortality, the minimum age for which to predict climate-sensitive growth and mortality. Young stands (&lt; 30) are poorly represented by the PSP data used to parameterize the model.
</td>
</tr>
<tr>
<td style="text-align:left;">
growthAndMortalityDrivers
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
LandR
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
package name where the following functions can be found: <code>calculateClimateEffect</code>, <code>assignClimateEffect</code> (see <code>LandR.CS</code> for climate sensitivity equivalent functions, or leave default if this is not desired)
</td>
</tr>
<tr>
<td style="text-align:left;">
growthInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
start(sim)
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Initial time for the growth event to occur
</td>
</tr>
<tr>
<td style="text-align:left;">
initialBiomassSource
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
cohortData
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Currently, there are three options: ‘spinUp’, ‘cohortData’, ‘biomassMap’. If ‘spinUp’, it will derive biomass by running spinup derived from Landis-II. If ‘cohortData’, it will be taken from the <code>cohortData</code> object, i.e., it is already correct, by cohort. If ‘biomassMap’, it will be taken from <code>sim$biomassMap</code>, divided across species using <code>sim$speciesLayers</code> percent cover values ‘spinUp’ uses <code>sim$standAgeMap</code> as the driver, so biomass is an output . That means it will be unlikely to match any input information about biomass, unless this is set to ‘biomassMap’, and a <code>sim$biomassMap</code> is supplied. Only the ‘cohortData’ option is currently active.
</td>
</tr>
<tr>
<td style="text-align:left;">
keepClimateCols
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
include growth and mortality predictions in <code>cohortData</code>?
</td>
</tr>
<tr>
<td style="text-align:left;">
minCohortBiomass
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
cohorts with biomass below this threshold (g/m^2) are removed. Not a LANDIS-II BSE parameter.
</td>
</tr>
<tr>
<td style="text-align:left;">
mixedType
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
How to define mixed stands: 1 for any species admixture; 2 for deciduous &gt; conifer. See <code>?LandR::vegTypeMapGenerator</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
plotOverstory
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
swap max age plot with overstory biomass
</td>
</tr>
<tr>
<td style="text-align:left;">
seedingAlgorithm
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
wardDisp….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
choose which seeding algorithm will be used among ‘noDispersal’, ‘universalDispersal’, and ‘wardDispersal’ (default). See Scheller &amp; Miranda (2015) - Biomass Succession extension, v3.2.1 User Guide
</td>
</tr>
<tr>
<td style="text-align:left;">
spinupMortalityfraction
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
0.001
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
defines the mortality loss fraction in spin up-stage simulation. Only used if <code>P(sim)$initialBiomassSource == 'biomassMap'</code>, which is currently deactivated.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
Boreal
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to use as a naming convention
</td>
</tr>
<tr>
<td style="text-align:left;">
successionTimestep
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
defines the simulation time step, default is 10 years. Note that growth and mortality always happen on a yearly basis.
</td>
</tr>
<tr>
<td style="text-align:left;">
vegLeadingProportion
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
0.8
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
a number that defines whether a species is leading for a given pixel
</td>
</tr>
<tr>
<td style="text-align:left;">
.maxMemory
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
maximum amount of memory (in GB) to use for dispersal calculations.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
start(sim)
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Vector of length = 1, describing the simulation time at which the first plot event should occur. To plotting off completely use <code>P(sim)$.plots</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
defines the plotting time step. If <code>NA</code>, the default, .plotInterval is set to successionTimestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plots
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
object
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Passed to <code>types</code> in <code>Plots</code> (see <code>?Plots</code>). There are a few plots that are made within this module, if set. Note that plots (or their data) saving will ONLY occur at <code>end(sim)</code>. If <code>NA</code> plotting is off completely (this includes plot saving).
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotMaps
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Controls whether maps should be plotted or not. Set to <code>FALSE</code> if <code>P(sim)$.plots == NA</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Vector of length = 1, describing the simulation time at which the first save event should occur. Set to <code>NA</code> if no saving is desired. If not <code>NA</code>, then saving will occur at <code>P(sim)$.saveInitialTime</code> with a frequency equal to <code>P(sim)$.saveInterval</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
defines the saving time step. If <code>NA</code>, the default, .saveInterval is set to <code>P(sim)$successionTimestep</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
.studyAreaName
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Human-readable name for the study area used. If <code>NA</code>, a hash of <code>studyArea</code> will be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
.inputOb….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Internal. Can be names of events or the whole module name; these will be cached by <code>SpaDES</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
.useParallel
</td>
<td style="text-align:left;">
ANY
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Used only in seed dispersal. If numeric, it will be passed to <code>data.table::setDTthreads</code> and should be &lt;= 2; If <code>TRUE</code>, it will be passed to <code>parallel::makeCluster</code>; and if a cluster object, it will be passed to <code>parallel::parClusterApplyB</code>.
</td>
</tr>
</tbody>
</table>
<div class="fullwidth">
<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Required inputs</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Plotting &amp; saving</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>.plots</code></td>
<td align="left">activates/deactivates plotting and defines type fo plotting (see <code>?Plots</code>)</td>
</tr>
<tr class="odd">
<td align="left"><code>.plotInitialTime</code></td>
<td align="left">defines when plotting starts</td>
</tr>
<tr class="even">
<td align="left"><code>.plotInterval</code></td>
<td align="left">defines plotting frequency</td>
</tr>
<tr class="odd">
<td align="left"><code>.plotMaps</code></td>
<td align="left">activates/deactivates map plotting</td>
</tr>
<tr class="even">
<td align="left"><code>.saveInitialTime</code></td>
<td align="left">defines when saving starts</td>
</tr>
<tr class="odd">
<td align="left"><code>.saveInterval</code></td>
<td align="left">defines saving frequency</td>
</tr>
<tr class="even">
<td align="left">Simulation</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>seedingAlgorithm</code></td>
<td align="left">dispersal type (see above)</td>
</tr>
<tr class="even">
<td align="left"><code>successionTimestep</code></td>
<td align="left">defines frequency of dispersal/local recruitment event (growth and mortality are always yearly)</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>mixedType</code></td>
<td align="left">how mixed forest stands are defined</td>
</tr>
<tr class="odd">
<td align="left"><code>vegLeadingProportion</code></td>
<td align="left">relative biomass threshold to consider a species “leading” (<em>i.e.</em>, dominant)</td>
</tr>
</tbody>
</table>
</div>
<p>: (#tab:tableUsefulParams) Useful <em>Biomass_core</em> parameters.</p>
</div>
</div>
<div id="simulation-flow" class="section level3">
<h3>Simulation flow</h3>
<div id="no-disturbances" class="section level4">
<h4>No disturbances</h4>
<p><em>Biomass_core</em> itself does not simulate disturbances, or their effect on vegetation (<em>i.e.</em>, post-disturbance mortality and regeneration). The general flow of <em>Biomass_core</em> processes is:</p>
<ol style="list-style-type: decimal">
<li>Preparation of necessary objects for the simulation – either by accessory data prep. modules, or <em>Biomass_core</em> itself (using LANDIS-II test parameters and dummy data for stand age, biomass and land cover and ecological zoning)</li>
<li>Seed dispersal – see <span class="citation">Scheller &amp; Domingo (<a href="#ref-SchellerDomingo2012" role="doc-biblioref">2012</a>)</span> for details</li>
</ol>
<ul>
<li>Seed dispersal can be a slow process and has been adapted to occur every 10 years. The user can set it to occur more often, but this should not make much of a difference to model outputs, because age classes are meant to be collapsed to tens.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Growth and mortality – based on <span class="citation">Scheller &amp; Mladenoff (<a href="#ref-SchellerMladenoff2004" role="doc-biblioref">2004</a>)</span></li>
</ol>
<ul>
<li>unlike dispersal, growth and mortality should occur every year</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Ageing – based on <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span></li>
</ol>
<ul>
<li>follows the same frequency as dispersal, collapsing ages to classes with resolution = to this frequency</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Preparation of visual/saved outputs … (repeat 2-4) …</li>
</ol>
</div>
<div id="with-disturbances" class="section level4">
<h4>With disturbances</h4>
<p>Note that should a post-disturbance regeneration module be used (e.g., <em>Biomass_regeneration</em>), regeneration will occur after the disturbance, but <em>before</em> dispersal and background vegetation growth and mortality. Hence, the disturbance should take place either at the very beginning or at the very end of each simulation time step. The general flow of <em>Biomass_core</em> processes when disturbances are included (by linking other modules) is:</p>
<ol style="list-style-type: decimal">
<li>Preparation of necessary objects for the simulation – either by accessory prep. data modules, or <em>Biomass_core</em> itself (using LANDIS-II test parameters and dummy data.)</li>
<li>Disturbances – simulated by a disturbance module</li>
<li>Post-disturbance regeneration – simulated by a regeneration module (<em>Biomass_regeneration</em> is an optional download)</li>
<li>Seed dispersal – see <span class="citation">Scheller &amp; Domingo (<a href="#ref-SchellerDomingo2012" role="doc-biblioref">2012</a>)</span> for details</li>
<li>Growth, ageing and mortality – based on <span class="citation">Scheller &amp; Miranda (<a href="#ref-SchellerMiranda2015" role="doc-biblioref">2015</a>)</span></li>
<li>Preparation of visual/saved outputs … (repeat 2-6) …</li>
</ol>
</div>
</div>
</div>
<div id="usage-example" class="section level2">
<h2>Usage example</h2>
<div id="load-spades" class="section level3">
<h3>Load <code>SpaDES</code></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## make sure all necessary packages are installed</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>SpaDES.install<span class="sc">::</span><span class="fu">makeSureAllPackagesInstalled</span>(<span class="at">modulePath =</span> <span class="st">&quot;../Biomass_core/&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>moduleName <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Biomass_core&quot;</span>)  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>spadesModulesDirectory <span class="ot">&lt;-</span> <span class="st">&quot;..&quot;</span> <span class="co"># In general, a module code will be controlled at one level above the source code</span></span></code></pre></div>
</div>
<div id="get-the-module" class="section level3">
<h3>Get the module</h3>
<p>See <a href="https://github.com/PredictiveEcology/SpaDES-modules">SpaDES-modules repository</a> to see how to download this and other <code>SpaDES</code> modules. Alternatively, it can be forked or cloned from its <a href="https://github.com/PredictiveEcology/Biomass_core/">GitHub repository</a> directly.</p>
</div>
<div id="setup-simulation" class="section level3">
<h3>Setup simulation</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tempDir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setPaths</span>(<span class="at">inputPath =</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;inputs&quot;</span>), </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cachePath =</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;cache&quot;</span>), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">modulePath =</span> spadesModulesDirectory, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">outputPath =</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;outputs&quot;</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="dv">30</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>studyArea <span class="ot">&lt;-</span> <span class="fu">Cache</span>(randomStudyArea, <span class="at">size =</span> <span class="fl">1e7</span>) <span class="co"># cache this so it creates a random one only once on a machine</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the species you want to work with – using the naming convention in &quot;Boreal&quot; column of LandR::sppEquivalencies_CA</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>speciesNameConvention <span class="ot">&lt;-</span> <span class="st">&quot;Boreal&quot;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>speciesToUse <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Pice_Gla&quot;</span>, <span class="st">&quot;Popu_Tre&quot;</span>, <span class="st">&quot;Pinu_Con&quot;</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>sppEquiv <span class="ot">&lt;-</span> LandR<span class="sc">::</span>sppEquivalencies_CA[<span class="fu">get</span>(speciesNameConvention) <span class="sc">%in%</span> speciesToUse]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign a colour convention for graphics for each species</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>sppColorVect <span class="ot">&lt;-</span> LandR<span class="sc">::</span><span class="fu">sppColors</span>(sppEquiv, speciesNameConvention,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newVals =</span> <span class="st">&quot;Mixed&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Usage example</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">as.list</span>(moduleName)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>objects <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">studyArea =</span> studyArea, <span class="at">sppEquiv =</span> sppEquiv, <span class="at">sppColorVect =</span> sppColorVect)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">getPaths</span>()</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>successionTimestep <span class="ot">&lt;-</span> 10L</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="do">## keep default values for most parameters </span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="do">## (omitted from this list)</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">Biomass_core =</span> <span class="fu">list</span>(</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sppEquivCol&quot;</span> <span class="ot">=</span> speciesNameConvention</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;successionTimestep&quot;</span> <span class="ot">=</span> successionTimestep</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plots&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;screen&quot;</span>, <span class="st">&quot;object&quot;</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plotInitialTime&quot;</span> <span class="ot">=</span> times<span class="sc">$</span>start</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plots&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;screen&quot;</span>, <span class="st">&quot;png&quot;</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.saveInitialTime&quot;</span> <span class="ot">=</span> times<span class="sc">$</span>start</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.useCache&quot;</span> <span class="ot">=</span> <span class="st">&quot;init&quot;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.useParallel&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>outputs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">expand.grid</span>(<span class="at">objectName =</span> <span class="st">&quot;cohortData&quot;</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">saveTime =</span> <span class="fu">unique</span>(<span class="fu">seq</span>(times<span class="sc">$</span>start, times<span class="sc">$</span>end, <span class="at">by =</span> <span class="dv">1</span>)),</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">eventPriority =</span> <span class="dv">1</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">graphics.off</span>()</span></code></pre></div>
</div>
<div id="run-simulation" class="section level3">
<h3>Run simulation</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInitAndSpades</span>(<span class="at">times =</span> times,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">params =</span> parameters, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">modules =</span> modules, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">objects =</span> objects, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">paths =</span> paths,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">outputs =</span> outputs,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">debug =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure">
<img src="figures/Biomass_coreOutPlots1.png" alt="(ref:Biomass-core) automatically generates simulation visuals of species dynamics across the landscape in terms of total biomass, number of presences and age and productivity (above), as well as yearly plots of total biomass, productivity, mortality, reproduction and leading species in each pixel (below)."  /><img src="figures/Biomass_coreOutPlots2.png" alt="(ref:Biomass-core) automatically generates simulation visuals of species dynamics across the landscape in terms of total biomass, number of presences and age and productivity (above), as well as yearly plots of total biomass, productivity, mortality, reproduction and leading species in each pixel (below)."  />
<p class="caption">
(#fig:fig-Biomass-coreOutPlots)(ref:Biomass-core) automatically generates simulation visuals of species dynamics across the landscape in terms of total biomass, number of presences and age and productivity (above), as well as yearly plots of total biomass, productivity, mortality, reproduction and leading species in each pixel (below).
</p>
</div>
</div>
</div>
<div id="appendix" class="section level2">
<h2>Appendix</h2>
<div id="tables" class="section level3">
<h3>Tables</h3>
<table>
<caption>(#tab:tableLBSEtest1) Input order and processing order (as determined by LBSE) for the same community used to assess the impact of sequential calculation of the competition index, combined with a lack of explicit species ordering. The input order was the order of species in the initial communities table input file. The processing order was the order used in the simulation, which was obtained from <code>Landis-log.txt</code> when <code>CalibrateMode</code> was set to ‘yes’. Species starting ages are also shown.</caption>
<colgroup>
<col width="17%" />
<col width="11%" />
<col width="5%" />
<col width="14%" />
<col width="17%" />
<col width="11%" />
<col width="5%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Input order 1</th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left">Input order 2</th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Community</td>
<td align="left">Input</td>
<td align="left">Age</td>
<td align="left">Processing</td>
<td align="left">Community</td>
<td align="left">Input</td>
<td align="left">Age</td>
<td align="left">Processing</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">order</td>
<td align="left"></td>
<td align="left">order</td>
<td align="left"></td>
<td align="left">order</td>
<td align="left"></td>
<td align="left">order</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">abiebals</td>
<td align="left">20</td>
<td align="left">poputrem</td>
<td align="left">1</td>
<td align="left">pinustro</td>
<td align="left">20</td>
<td align="left">thujocci</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">20</td>
<td align="left">querelli</td>
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">20</td>
<td align="left">tiliamer</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">20</td>
<td align="left">pinuresi</td>
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">20</td>
<td align="left">querelli</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">20</td>
<td align="left">pinustro</td>
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">20</td>
<td align="left">querrubr</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">20</td>
<td align="left">tiliamer</td>
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">20</td>
<td align="left">betupapy</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">fraxamer</td>
<td align="left">20</td>
<td align="left">tsugcana</td>
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">20</td>
<td align="left">fraxamer</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">20</td>
<td align="left">querrubr</td>
<td align="left">1</td>
<td align="left">pinuresi</td>
<td align="left">20</td>
<td align="left">tsugcana</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">20</td>
<td align="left">thujocci</td>
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">20</td>
<td align="left">abiebals</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">pinuresi</td>
<td align="left">20</td>
<td align="left">acersacc</td>
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">20</td>
<td align="left">acerrubr</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinustro</td>
<td align="left">20</td>
<td align="left">betualle</td>
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">20</td>
<td align="left">pinubank</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">20</td>
<td align="left">abiebals</td>
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">20</td>
<td align="left">pinustro</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">20</td>
<td align="left">acerrubr</td>
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">20</td>
<td align="left">poputrem</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">20</td>
<td align="left">piceglau</td>
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">20</td>
<td align="left">pinuresi</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">20</td>
<td align="left">pinubank</td>
<td align="left">1</td>
<td align="left">abiebals</td>
<td align="left">20</td>
<td align="left">acersacc</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">20</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">20</td>
<td align="left">betualle</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">20</td>
<td align="left">fraxamer</td>
<td align="left">1</td>
<td align="left">fraxamer</td>
<td align="left">20</td>
<td align="left">piceglau</td>
</tr>
</tbody>
</table>
<table>
<caption>(#tab:tableLBSEtest2) Input order and processing order (as determined by LBSE) for the same community used to assess the impact of setting the succession time step to 1, combined with a lack of explicit species ordering. The input order was the order of species in the initial communities table input file. The processing order was the order used in the simulation, which was obtained from <code>Landis-log.txt</code> when <code>CalibrateMode</code> was set to ‘yes’. Species starting ages are also shown.</caption>
<colgroup>
<col width="17%" />
<col width="11%" />
<col width="5%" />
<col width="14%" />
<col width="17%" />
<col width="11%" />
<col width="5%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Input order 1</th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left">Input order 2</th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Community</td>
<td align="left">Input</td>
<td align="left">Age</td>
<td align="left">Processing</td>
<td align="left">Community</td>
<td align="left">Input</td>
<td align="left">Age</td>
<td align="left">Processing</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">order</td>
<td align="left"></td>
<td align="left">order</td>
<td align="left"></td>
<td align="left">order</td>
<td align="left"></td>
<td align="left">order</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">abiebals</td>
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">1</td>
<td align="left">pinustro</td>
<td align="left">1</td>
<td align="left">thujocci</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">1</td>
<td align="left">tiliamer</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">1</td>
<td align="left">pinuresi</td>
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">1</td>
<td align="left">querelli</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">1</td>
<td align="left">pinustro</td>
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">1</td>
<td align="left">querrubr</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">1</td>
<td align="left">betupapy</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">fraxamer</td>
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">1</td>
<td align="left">fraxamer</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">1</td>
<td align="left">pinuresi</td>
<td align="left">1</td>
<td align="left">tsugcana</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">1</td>
<td align="left">abiebals</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">pinuresi</td>
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">1</td>
<td align="left">acerrubr</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinustro</td>
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">1</td>
<td align="left">pinubank</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">1</td>
<td align="left">abiebals</td>
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">1</td>
<td align="left">pinustro</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">1</td>
<td align="left">poputrem</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">1</td>
<td align="left">pinuresi</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">1</td>
<td align="left">abiebals</td>
<td align="left">1</td>
<td align="left">acersacc</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">betualle</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">1</td>
<td align="left">fraxamer</td>
<td align="left">1</td>
<td align="left">fraxamer</td>
<td align="left">1</td>
<td align="left">piceglau</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<caption>(#tab:tableLBSEtest3) Randomly generated community combination no. 1 used in the recruitment comparison runs.</caption>
<colgroup>
<col width="15%" />
<col width="14%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Community</th>
<th align="left">Species</th>
<th align="left">Age 1</th>
<th align="left">Age 2</th>
<th align="left">Age 3</th>
<th align="left">Age 4</th>
<th align="left">Age 5</th>
<th align="left">Age 6</th>
<th align="left">Age 7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">37</td>
<td align="left">45</td>
<td align="left">46</td>
<td align="left">85</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">piceglau</td>
<td align="left">27</td>
<td align="left">73</td>
<td align="left">153</td>
<td align="left">256</td>
<td align="left">270</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">pinustro</td>
<td align="left">157</td>
<td align="left">159</td>
<td align="left">181</td>
<td align="left">220</td>
<td align="left">223</td>
<td align="left">303</td>
<td align="left">307</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">querrubr</td>
<td align="left">80</td>
<td align="left">102</td>
<td align="left">127</td>
<td align="left">152</td>
<td align="left">206</td>
<td align="left">227</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">3</td>
<td align="left">91</td>
<td align="left">126</td>
<td align="left">145</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">138</td>
<td align="left">144</td>
<td align="left">276</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">24</td>
<td align="left">106</td>
<td align="left">136</td>
<td align="left">149</td>
<td align="left">279</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">27</td>
<td align="left">67</td>
<td align="left">70</td>
<td align="left">153</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">3</td>
<td align="left">10</td>
<td align="left">24</td>
<td align="left">31</td>
<td align="left">71</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">92</td>
<td align="left">224</td>
<td align="left">234</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">73</td>
<td align="left">146</td>
<td align="left">262</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">fraxamer</td>
<td align="left">108</td>
<td align="left">118</td>
<td align="left">137</td>
<td align="left">147</td>
<td align="left">204</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">piceglau</td>
<td align="left">40</td>
<td align="left">128</td>
<td align="left">131</td>
<td align="left">159</td>
<td align="left">174</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">pinustro</td>
<td align="left">78</td>
<td align="left">156</td>
<td align="left">237</td>
<td align="left">245</td>
<td align="left">270</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">querelli</td>
<td align="left">67</td>
<td align="left">97</td>
<td align="left">186</td>
<td align="left">292</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">tiliamer</td>
<td align="left">70</td>
<td align="left">103</td>
<td align="left">121</td>
<td align="left">152</td>
<td align="left">178</td>
<td align="left">180</td>
<td align="left">245</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">acerrubr</td>
<td align="left">5</td>
<td align="left">83</td>
<td align="left">125</td>
<td align="left">126</td>
<td align="left">127</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">pinuresi</td>
<td align="left">1</td>
<td align="left">25</td>
<td align="left">42</td>
<td align="left">49</td>
<td align="left">76</td>
<td align="left">79</td>
<td align="left">103</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">poputrem</td>
<td align="left">4</td>
<td align="left">9</td>
<td align="left">62</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">querelli</td>
<td align="left">101</td>
<td align="left">104</td>
<td align="left">167</td>
<td align="left">226</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">tsugcana</td>
<td align="left">37</td>
<td align="left">135</td>
<td align="left">197</td>
<td align="left">404</td>
<td align="left">405</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">acerrubr</td>
<td align="left">15</td>
<td align="left">29</td>
<td align="left">63</td>
<td align="left">70</td>
<td align="left">105</td>
<td align="left">133</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">piceglau</td>
<td align="left">67</td>
<td align="left">132</td>
<td align="left">189</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">tsugcana</td>
<td align="left">21</td>
<td align="left">26</td>
<td align="left">110</td>
<td align="left">146</td>
<td align="left">341</td>
<td align="left">462</td>
<td align="left">463</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">acerrubr</td>
<td align="left">128</td>
<td align="left">137</td>
<td align="left">145</td>
<td align="left">147</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">acersacc</td>
<td align="left">241</td>
<td align="left">245</td>
<td align="left">261</td>
<td align="left">277</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">querrubr</td>
<td align="left">23</td>
<td align="left">72</td>
<td align="left">120</td>
<td align="left">142</td>
<td align="left">188</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">tiliamer</td>
<td align="left">4</td>
<td align="left">68</td>
<td align="left">98</td>
<td align="left">118</td>
<td align="left">139</td>
<td align="left">197</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">betualle</td>
<td align="left">5</td>
<td align="left">23</td>
<td align="left">31</td>
<td align="left">249</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">pinubank</td>
<td align="left">67</td>
<td align="left">70</td>
<td align="left">89</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">querelli</td>
<td align="left">194</td>
<td align="left">217</td>
<td align="left">257</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<caption>(#tab:tableLBSEtest4) Randomly generated community combination no. 2 used in the recruitment comparison runs.</caption>
<colgroup>
<col width="15%" />
<col width="14%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Community</th>
<th align="left">Species</th>
<th align="left">Age 1</th>
<th align="left">Age 2</th>
<th align="left">Age 3</th>
<th align="left">Age 4</th>
<th align="left">Age 5</th>
<th align="left">Age 6</th>
<th align="left">Age 7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="left">acerrubr</td>
<td align="left">22</td>
<td align="left">26</td>
<td align="left">30</td>
<td align="left">40</td>
<td align="left">47</td>
<td align="left">145</td>
<td align="left">146</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">betualle</td>
<td align="left">23</td>
<td align="left">41</td>
<td align="left">43</td>
<td align="left">120</td>
<td align="left">209</td>
<td align="left">227</td>
<td align="left">270</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">fraxamer</td>
<td align="left">25</td>
<td align="left">90</td>
<td align="left">119</td>
<td align="left">173</td>
<td align="left">185</td>
<td align="left">282</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">pinuresi</td>
<td align="left">48</td>
<td align="left">53</td>
<td align="left">70</td>
<td align="left">121</td>
<td align="left">157</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">pinustro</td>
<td align="left">5</td>
<td align="left">82</td>
<td align="left">126</td>
<td align="left">298</td>
<td align="left">352</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">querrubr</td>
<td align="left">2</td>
<td align="left">30</td>
<td align="left">34</td>
<td align="left">74</td>
<td align="left">77</td>
<td align="left">162</td>
<td align="left">245</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">2</td>
<td align="left">39</td>
<td align="left">43</td>
<td align="left">84</td>
<td align="left">116</td>
<td align="left">127</td>
<td align="left">143</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">34</td>
<td align="left">57</td>
<td align="left">75</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">108</td>
<td align="left">202</td>
<td align="left">218</td>
<td align="left">243</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">5</td>
<td align="left">117</td>
<td align="left">131</td>
<td align="left">186</td>
<td align="left">189</td>
<td align="left">246</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">10</td>
<td align="left">19</td>
<td align="left">46</td>
<td align="left">80</td>
<td align="left">133</td>
<td align="left">148</td>
<td align="left">231</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">31</td>
<td align="left">48</td>
<td align="left">190</td>
<td align="left">246</td>
<td align="left">330</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">pinubank</td>
<td align="left">11</td>
<td align="left">37</td>
<td align="left">38</td>
<td align="left">47</td>
<td align="left">67</td>
<td align="left">93</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">querrubr</td>
<td align="left">11</td>
<td align="left">48</td>
<td align="left">57</td>
<td align="left">177</td>
<td align="left">180</td>
<td align="left">228</td>
<td align="left">236</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">tiliamer</td>
<td align="left">28</td>
<td align="left">42</td>
<td align="left">78</td>
<td align="left">79</td>
<td align="left">223</td>
<td align="left">250</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">tsugcana</td>
<td align="left">140</td>
<td align="left">202</td>
<td align="left">372</td>
<td align="left">381</td>
<td align="left">451</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">acersacc</td>
<td align="left">48</td>
<td align="left">107</td>
<td align="left">262</td>
<td align="left">265</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">betupapy</td>
<td align="left">4</td>
<td align="left">12</td>
<td align="left">45</td>
<td align="left">65</td>
<td align="left">83</td>
<td align="left">96</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">poputrem</td>
<td align="left">13</td>
<td align="left">20</td>
<td align="left">37</td>
<td align="left">75</td>
<td align="left">90</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">querelli</td>
<td align="left">72</td>
<td align="left">90</td>
<td align="left">104</td>
<td align="left">115</td>
<td align="left">116</td>
<td align="left">265</td>
<td align="left">278</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">tiliamer</td>
<td align="left">20</td>
<td align="left">21</td>
<td align="left">56</td>
<td align="left">98</td>
<td align="left">237</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">tsugcana</td>
<td align="left">86</td>
<td align="left">224</td>
<td align="left">425</td>
<td align="left">429</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">fraxamer</td>
<td align="left">77</td>
<td align="left">133</td>
<td align="left">181</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">pinustro</td>
<td align="left">13</td>
<td align="left">37</td>
<td align="left">67</td>
<td align="left">220</td>
<td align="left">287</td>
<td align="left">293</td>
<td align="left">375</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">querrubr</td>
<td align="left">27</td>
<td align="left">48</td>
<td align="left">89</td>
<td align="left">97</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">thujocci</td>
<td align="left">91</td>
<td align="left">244</td>
<td align="left">305</td>
<td align="left">390</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">abiebals</td>
<td align="left">86</td>
<td align="left">95</td>
<td align="left">119</td>
<td align="left">121</td>
<td align="left">127</td>
<td align="left">158</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">betualle</td>
<td align="left">83</td>
<td align="left">113</td>
<td align="left">136</td>
<td align="left">161</td>
<td align="left">216</td>
<td align="left">231</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">betupapy</td>
<td align="left">10</td>
<td align="left">38</td>
<td align="left">64</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">piceglau</td>
<td align="left">16</td>
<td align="left">63</td>
<td align="left">70</td>
<td align="left">102</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">acerrubr</td>
<td align="left">8</td>
<td align="left">34</td>
<td align="left">112</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">31</td>
<td align="left">57</td>
<td align="left">61</td>
<td align="left">74</td>
<td align="left">80</td>
<td align="left">91</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">fraxamer</td>
<td align="left">63</td>
<td align="left">100</td>
<td align="left">108</td>
<td align="left">140</td>
<td align="left">196</td>
<td align="left">294</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">pinubank</td>
<td align="left">15</td>
<td align="left">19</td>
<td align="left">44</td>
<td align="left">47</td>
<td align="left">51</td>
<td align="left">80</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">thujocci</td>
<td align="left">78</td>
<td align="left">146</td>
<td align="left">163</td>
<td align="left">213</td>
<td align="left">214</td>
<td align="left">228</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">tsugcana</td>
<td align="left">47</td>
<td align="left">108</td>
<td align="left">387</td>
<td align="left">389</td>
<td align="left">449</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<caption>(#tab:tableLBSEtest5) Randomly generated community combination no. 3 used in the recruitment comparison runs.</caption>
<colgroup>
<col width="15%" />
<col width="14%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Community</th>
<th align="left">Species</th>
<th align="left">Age 1</th>
<th align="left">Age 2</th>
<th align="left">Age 3</th>
<th align="left">Age 4</th>
<th align="left">Age 5</th>
<th align="left">Age 6</th>
<th align="left">Age 7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="left">pinubank</td>
<td align="left">7</td>
<td align="left">26</td>
<td align="left">32</td>
<td align="left">37</td>
<td align="left">48</td>
<td align="left">85</td>
<td align="left">90</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">pinuresi</td>
<td align="left">11</td>
<td align="left">103</td>
<td align="left">109</td>
<td align="left">179</td>
<td align="left">188</td>
<td align="left">197</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">querrubr</td>
<td align="left">89</td>
<td align="left">139</td>
<td align="left">180</td>
<td align="left">206</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">36</td>
<td align="left">39</td>
<td align="left">45</td>
<td align="left">49</td>
<td align="left">66</td>
<td align="left">68</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">13</td>
<td align="left">165</td>
<td align="left">254</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">3</td>
<td align="left">19</td>
<td align="left">54</td>
<td align="left">64</td>
<td align="left">76</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">22</td>
<td align="left">59</td>
<td align="left">93</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">68</td>
<td align="left">98</td>
<td align="left">274</td>
<td align="left">275</td>
<td align="left">363</td>
<td align="left">378</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">13</td>
<td align="left">20</td>
<td align="left">105</td>
<td align="left">124</td>
<td align="left">248</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">36</td>
<td align="left">90</td>
<td align="left">142</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">fraxamer</td>
<td align="left">11</td>
<td align="left">241</td>
<td align="left">279</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">piceglau</td>
<td align="left">16</td>
<td align="left">42</td>
<td align="left">129</td>
<td align="left">177</td>
<td align="left">200</td>
<td align="left">244</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">pinustro</td>
<td align="left">200</td>
<td align="left">342</td>
<td align="left">384</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">abiebals</td>
<td align="left">31</td>
<td align="left">57</td>
<td align="left">61</td>
<td align="left">92</td>
<td align="left">108</td>
<td align="left">162</td>
<td align="left">183</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">piceglau</td>
<td align="left">126</td>
<td align="left">255</td>
<td align="left">261</td>
<td align="left">267</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">poputrem</td>
<td align="left">28</td>
<td align="left">41</td>
<td align="left">57</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">querrubr</td>
<td align="left">83</td>
<td align="left">91</td>
<td align="left">144</td>
<td align="left">173</td>
<td align="left">184</td>
<td align="left">238</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">thujocci</td>
<td align="left">6</td>
<td align="left">66</td>
<td align="left">68</td>
<td align="left">204</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">fraxamer</td>
<td align="left">12</td>
<td align="left">110</td>
<td align="left">266</td>
<td align="left">270</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">pinustro</td>
<td align="left">174</td>
<td align="left">270</td>
<td align="left">359</td>
<td align="left">379</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">poputrem</td>
<td align="left">4</td>
<td align="left">7</td>
<td align="left">18</td>
<td align="left">24</td>
<td align="left">63</td>
<td align="left">76</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">tiliamer</td>
<td align="left">126</td>
<td align="left">136</td>
<td align="left">197</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">tsugcana</td>
<td align="left">49</td>
<td align="left">91</td>
<td align="left">128</td>
<td align="left">194</td>
<td align="left">411</td>
<td align="left">487</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">abiebals</td>
<td align="left">35</td>
<td align="left">53</td>
<td align="left">108</td>
<td align="left">114</td>
<td align="left">147</td>
<td align="left">174</td>
<td align="left">195</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">acerrubr</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">101</td>
<td align="left">145</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">pinubank</td>
<td align="left">14</td>
<td align="left">15</td>
<td align="left">38</td>
<td align="left">40</td>
<td align="left">59</td>
<td align="left">69</td>
<td align="left">83</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">acerrubr</td>
<td align="left">4</td>
<td align="left">46</td>
<td align="left">117</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">betualle</td>
<td align="left">36</td>
<td align="left">41</td>
<td align="left">116</td>
<td align="left">213</td>
<td align="left">253</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">betupapy</td>
<td align="left">4</td>
<td align="left">6</td>
<td align="left">76</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">pinuresi</td>
<td align="left">43</td>
<td align="left">68</td>
<td align="left">85</td>
<td align="left">171</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">querrubr</td>
<td align="left">84</td>
<td align="left">86</td>
<td align="left">113</td>
<td align="left">185</td>
<td align="left">193</td>
<td align="left">223</td>
<td align="left">228</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">tiliamer</td>
<td align="left">13</td>
<td align="left">106</td>
<td align="left">181</td>
<td align="left">199</td>
<td align="left">246</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<table>
<caption>(#tab:tableLBSEtest6) Invariant species traits table used in comparison runs.</caption>
<colgroup>
<col width="8%" />
<col width="9%" />
<col width="12%" />
<col width="13%" />
<col width="15%" />
<col width="15%" />
<col width="13%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th>Species</th>
<th>Longevity</th>
<th>Sexualmature</th>
<th>Shadetolerance</th>
<th>Seeddistance_eff</th>
<th>Seeddistance_max</th>
<th>Mortalityshape</th>
<th>Growthcurve</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>abiebals</td>
<td>200</td>
<td>25</td>
<td>5</td>
<td>30</td>
<td>160</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>acerrubr</td>
<td>150</td>
<td>10</td>
<td>4</td>
<td>100</td>
<td>200</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>acersacc</td>
<td>300</td>
<td>40</td>
<td>5</td>
<td>100</td>
<td>200</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>betualle</td>
<td>300</td>
<td>40</td>
<td>4</td>
<td>100</td>
<td>400</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>betupapy</td>
<td>100</td>
<td>30</td>
<td>2</td>
<td>200</td>
<td>5000</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>fraxamer</td>
<td>300</td>
<td>30</td>
<td>4</td>
<td>70</td>
<td>140</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>piceglau</td>
<td>300</td>
<td>25</td>
<td>3</td>
<td>30</td>
<td>200</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>pinubank</td>
<td>100</td>
<td>15</td>
<td>1</td>
<td>20</td>
<td>100</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>pinuresi</td>
<td>200</td>
<td>35</td>
<td>2</td>
<td>20</td>
<td>275</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>pinustro</td>
<td>400</td>
<td>40</td>
<td>3</td>
<td>60</td>
<td>210</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>poputrem</td>
<td>100</td>
<td>20</td>
<td>1</td>
<td>1000</td>
<td>5000</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>querelli</td>
<td>300</td>
<td>35</td>
<td>2</td>
<td>30</td>
<td>3000</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>querrubr</td>
<td>250</td>
<td>25</td>
<td>3</td>
<td>30</td>
<td>3000</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>thujocci</td>
<td>400</td>
<td>30</td>
<td>2</td>
<td>45</td>
<td>60</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>tiliamer</td>
<td>250</td>
<td>30</td>
<td>4</td>
<td>30</td>
<td>120</td>
<td>10</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>tsugcana</td>
<td>500</td>
<td>30</td>
<td>5</td>
<td>30</td>
<td>100</td>
<td>10</td>
<td>0.25</td>
</tr>
</tbody>
</table>
<table>
<caption>(#tab:tableLBSEtest7) Minimum relative biomass table used in comparison runs. X0-5 represent site shade classes from no-shade (0) to maximum shade (5). All ecolocations shared the same values.</caption>
<thead>
<tr class="header">
<th align="left">Ecolocation</th>
<th align="left">X0</th>
<th align="left">X1</th>
<th align="left">X2</th>
<th align="left">X3</th>
<th align="left">X4</th>
<th align="left">X5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">All</td>
<td align="left">0</td>
<td align="left">0.15</td>
<td align="left">0.25</td>
<td align="left">0.5</td>
<td align="left">0.8</td>
<td align="left">0.95</td>
</tr>
</tbody>
</table>
<table>
<caption>(#tab:tableLBSEtest8) Probability of germination for species shade tolerance and shade level combinations (called <em>sufficient light</em> table in LBSE and <code>sufficientLight</code> input <code>data.table</code> in LandR <em>Biomass_core</em>) used in comparison runs.</caption>
<thead>
<tr class="header">
<th align="left">Shadetolerance</th>
<th align="left">0</th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<table>
<caption>(#tab:tableLBSEtest9) Species ecolocation table used in comparison runs. <code>SEP</code> stands for species establishment probability, <code>maxB</code> for maximum biomass and <code>maxANPP</code> for maximum aboveground net primary productivity. Values were held constant throughout the simulation.</caption>
<thead>
<tr class="header">
<th align="left">Ecolocation</th>
<th align="left">Species</th>
<th align="left">SEP</th>
<th align="left">maxANPP</th>
<th align="left">maxB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">abiebals</td>
<td align="left">0.9</td>
<td align="left">886</td>
<td align="left">26580</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">acerrubr</td>
<td align="left">1</td>
<td align="left">1175</td>
<td align="left">35250</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">acersacc</td>
<td align="left">0.82</td>
<td align="left">1106</td>
<td align="left">33180</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">betualle</td>
<td align="left">0.64</td>
<td align="left">1202</td>
<td align="left">36060</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">betupapy</td>
<td align="left">1</td>
<td align="left">1202</td>
<td align="left">36060</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">fraxamer</td>
<td align="left">0.18</td>
<td align="left">1202</td>
<td align="left">36060</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">piceglau</td>
<td align="left">0.58</td>
<td align="left">969</td>
<td align="left">29070</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinubank</td>
<td align="left">1</td>
<td align="left">1130</td>
<td align="left">33900</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">pinuresi</td>
<td align="left">0.56</td>
<td align="left">1017</td>
<td align="left">30510</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">pinustro</td>
<td align="left">0.72</td>
<td align="left">1090</td>
<td align="left">38150</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">poputrem</td>
<td align="left">1</td>
<td align="left">1078</td>
<td align="left">32340</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">querelli</td>
<td align="left">0.96</td>
<td align="left">1096</td>
<td align="left">32880</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">querrubr</td>
<td align="left">0.66</td>
<td align="left">1017</td>
<td align="left">30510</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">thujocci</td>
<td align="left">0.76</td>
<td align="left">1090</td>
<td align="left">32700</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">tiliamer</td>
<td align="left">0.54</td>
<td align="left">1078</td>
<td align="left">32340</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">tsugcana</td>
<td align="left">0.22</td>
<td align="left">1096</td>
<td align="left">32880</td>
</tr>
</tbody>
</table>
</div>
<div id="figures" class="section level3">
<h3>Figures</h3>
<div class="figure" style="text-align: center">
<img src="figures/figLBSEtest1.png" alt="Differences in total landscape aboveground biomass when using two different input species orders for the same community. These simulations demonstrate how the sequential calculation of the competition index, combined with a lack of explicit species ordering affect the overall landscape aboveground biomass in time when using different input species orders (see Table \@ref(tab:tableLBSEtest1)). In order to prevent differences introduced by cohort recruitment, species’ ages at sexual maturity were changed to the species’ longevity values, and the simulation ran for 75 years to prevent any cohorts from reaching sexual maturity. The bottom panel shows the difference between the two simulations in percentage, calculated as $\frac{Biomass_{order2} - Biomass_{order1}}{Biomass_{order2}} * 100$" width="60%" />
<p class="caption">
(#fig:figLBSEtest1)Differences in total landscape aboveground biomass when using two different input species orders for the same community. These simulations demonstrate how the sequential calculation of the competition index, combined with a lack of explicit species ordering affect the overall landscape aboveground biomass in time when using different input species orders (see Table @ref(tab:tableLBSEtest1)). In order to prevent differences introduced by cohort recruitment, species’ ages at sexual maturity were changed to the species’ longevity values, and the simulation ran for 75 years to prevent any cohorts from reaching sexual maturity. The bottom panel shows the difference between the two simulations in percentage, calculated as <span class="math inline">\(\frac{Biomass_{order2} - Biomass_{order1}}{Biomass_{order2}} * 100\)</span>
</p>
</div>
<p><br/><br/></p>
<div class="figure" style="text-align: center">
<img src="figures/figLBSEtest2.png" alt="Differences in the biomasses assigned to new cohorts, summed for each species across pixels, when using two different input species orders for the same community and when the succession time step is 1. These simulations demonstrate how the different summation of total cohort biomass for a succession time step of 1 and the lack of explicit species ordering affect simulation results when changing the species order in the input file (see Table \@ref(tab:tableLBSEtest2)). Here, initial cohort ages were also set to 1. We show the initial total biomass attributed to each species at the end of year 1." width="60%" />
<p class="caption">
(#fig:figLBSEtest2)Differences in the biomasses assigned to new cohorts, summed for each species across pixels, when using two different input species orders for the same community and when the succession time step is 1. These simulations demonstrate how the different summation of total cohort biomass for a succession time step of 1 and the lack of explicit species ordering affect simulation results when changing the species order in the input file (see Table @ref(tab:tableLBSEtest2)). Here, initial cohort ages were also set to 1. We show the initial total biomass attributed to each species at the end of year 1.
</p>
</div>
<p><br/><br/></p>
<div class="figure" style="text-align: center">
<img src="figures/figLBSEtest3.png" alt="Hashing design for (ref:Biomass-core). In the re-coded (ref:Biomass-core), the pixel group map was hashed based on the unique combination of species composition (i.e., community map) and ecolocation map, and associated with a lookup table. The subfigure in the right upper corner was the original design that linked the map to the lookup table by pixel key." width="60%" />
<p class="caption">
(#fig:figLBSEtest3)Hashing design for (ref:Biomass-core). In the re-coded (ref:Biomass-core), the pixel group map was hashed based on the unique combination of species composition (i.e., community map) and ecolocation map, and associated with a lookup table. The subfigure in the right upper corner was the original design that linked the map to the lookup table by pixel key.
</p>
</div>
<p><br/><br/></p>
<div class="figure" style="text-align: center">
<img src="figures/figLBSEtest4.png" alt="Visual comparison of simulation outputs for three randomly generated initial communities (left panels) and difference between those outputs (right panels). The % difference between LBSE and (ref:Biomass-core) were calculated as $\frac{Biomass_{LBSE} - Biomass_{Biomass_core}}{Biomass_{LBSE}} * 100$" width="60%" />
<p class="caption">
(#fig:figLBSEtest4)Visual comparison of simulation outputs for three randomly generated initial communities (left panels) and difference between those outputs (right panels). The % difference between LBSE and (ref:Biomass-core) were calculated as <span class="math inline">\(\frac{Biomass_{LBSE} - Biomass_{Biomass_core}}{Biomass_{LBSE}} * 100\)</span>
</p>
</div>
<p><br/><br/></p>
<div class="figure" style="text-align: center">
<img src="figures/figLBSEtest5.png" alt="Simulation efficiencies of LBSE and (ref:Biomass-core) with increasing map size, in terms of a) mean running time across repetitions (left y-axis) and the ratio LBSE to (ref:Biomass-core) running times (right y-axis and blue line), and b) running time scalability as the mean running time per 1000 pixels." width="60%" />
<p class="caption">
(#fig:figLBSEtest5)Simulation efficiencies of LBSE and (ref:Biomass-core) with increasing map size, in terms of a) mean running time across repetitions (left y-axis) and the ratio LBSE to (ref:Biomass-core) running times (right y-axis and blue line), and b) running time scalability as the mean running time per 1000 pixels.
</p>
</div>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<!--chapter:end:modules/Biomass_core/Biomass_core2.Rmd-->
</div>
</div>
<div id="landr-data-modules" class="section level1">
<h1>LandR Data Modules</h1>
<p>The LandR ecosystem of SpaDES modules has a variety of ‘data modules’ that are used to obtain and pre-process input data, as well as estimate input parameters required by the core forest landscape simulation module <em>Biomass_core</em>. These modules are presented in the next chapters.</p>
<!--chapter:end:LandR-dataModulesForeword.Rmd-->
</div>
<div id="landr-biomass_speciesdata-module" class="section level1">
<h1>LandR <em>Biomass_speciesData</em> Module</h1>
<!-- the following are text references used in captions for LaTeX compatibility -->
<p>(ref:Biomass-speciesData) <em>Biomass_speciesData</em></p>
<p><a href="http://commonmark.org"><img src="https://img.shields.io/badge/Made%20with-Markdown-1f425f.png" alt="made-with-Markdown" /></a>
<a href="https://github.com/PredictiveEcology/Biomass_speciesData/issues"><img src="https://img.shields.io/badge/Get%20help-Report%20issues-%3CCOLOR%3E.png" alt="Generic badge" /></a></p>
<!-- if knitting to pdf remember to add the pandoc_args: ["--extract-media", "."] option to yml in order to get the badge images -->
<p><strong>This documentation is work in progress. Potential discrepancies and omissions
may exist for the time being. If you find any, do contact us using the link
above^^</strong></p>
<div id="authors-1" class="section level4">
<h4>Authors:</h4>
<p>Eliot J B McIntire <a href="mailto:eliot.mcintire@nrcan-rncan.gc.ca" class="email">eliot.mcintire@nrcan-rncan.gc.ca</a> [aut, cre], Alex M. Chubaty <a href="mailto:achubaty@for-cast.ca" class="email">achubaty@for-cast.ca</a> [aut], Ceres Barros <a href="mailto:cbarros@mail.ubc.ca" class="email">cbarros@mail.ubc.ca</a> [aut]
<!-- ideally separate authors with new lines, '\n' not working --></p>
</div>
<div id="module-overview-1" class="section level2">
<h2>Module Overview</h2>
<div id="module-summary-1" class="section level3">
<h3>Module summary</h3>
<p>This module downloads and pre-process species % cover data layers to be passed
to other LandR data modules (e.g., <em>Biomass_borealDataPrep</em>) or to the LandR
forest simulation module <em>Biomass_core</em>.</p>
</div>
<div id="module-inputs-and-parameters-at-a-glance" class="section level3">
<h3>Module inputs and parameters at a glance</h3>
<p>Below are the full list of input objects (Table
@ref(tab:moduleInputs-Biomass-speciesData)) and parameters (Table
@ref(tab:moduleParams-Biomass-speciesData)) that <em>Biomass_speciesData</em> expects.
Of these, the only input that <strong>must</strong> be provided (i.e., <em>Biomass_speciesData</em>
does not have a default for) is <code>studyAreaLarge</code>.</p>
<p>Raw data layers downloaded by the module are saved in <code>dataPath(sim)</code>, which can
be controlled via <code>options(reproducible.destinationPath = ...)</code>.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleInputs-Biomass-speciesData)List of (ref:Biomass-speciesData) input objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
desc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rasterToMatchLarge
</td>
<td style="text-align:left;">
a raster of <code>studyAreaLarge</code> in the same resolution and projection the simulation’s. Defaults to the using the Canadian Forestry Service, National Forest Inventory, kNN-derived stand biomass map.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppColorVect
</td>
<td style="text-align:left;">
A named vector of colors to use for plotting. The names must be in sim<span class="math inline">\(sppEquiv[[sim\)</span>sppEquivCol]], and should also contain a color for ‘Mixed’
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquiv
</td>
<td style="text-align:left;">
table of species equivalencies. See <code>LandR::sppEquivalencies_CA</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaLarge
</td>
<td style="text-align:left;">
Polygon to use as the parametrisation study area. Must be provided by the user. Note that <code>studyAreaLarge</code> is only used for parameter estimation, and can be larger than the actual study area used for LandR simulations (e.g, larger than <code>studyArea</code> in LandR Biomass_core).
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaReporting
</td>
<td style="text-align:left;">
multipolygon (typically smaller/unbuffered than <code>studyAreaLarge</code> and <code>studyArea</code> in LandR Biomass_core) to use for plotting/reporting. If not provided, will default to <code>studyAreaLarge</code>.
</td>
</tr>
</tbody>
</table>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleParams-Biomass-speciesData)List of (ref:Biomass-speciesData) parameters and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
coverThresh
</td>
<td style="text-align:left;">
The minimum % cover a species needs to have (per pixel) in the study area to be considered present
</td>
</tr>
<tr>
<td style="text-align:left;">
dataYear
</td>
<td style="text-align:left;">
Passed to <code>paste0('prepSpeciesLayers_', types)</code> function to fetch data from that year (if applicable). Defaults to 2001 as the default kNN year.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to group species by and use as a naming convention. If different species in, e.g., the kNN data have the same name in the chosen column, their data are merged into one species by summing their % cover in each raster cell.
</td>
</tr>
<tr>
<td style="text-align:left;">
types
</td>
<td style="text-align:left;">
The possible data sources. These must correspond to a function named paste0(‘prepSpeciesLayers_’, types). Defaults to ‘KNN’ to get the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from year ‘dataYear’, using the <code>LandR::prepSpeciesLayers_KNN</code> function (see <a href="https://open.canada.ca/" class="uri">https://open.canada.ca/</a> data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990 for details on these data). Other currently available options are ‘ONFRI’, ‘CASFRI’, ‘Pickell’ and ‘ForestInventory’, which attempt to get proprietary data - the user must be granted access first. A custom function can be used to retrieve any data, just as long as it is accessible by the module (e.g., in the global environment) and is named as paste0(‘prepSpeciesLayers_’, types).
</td>
</tr>
<tr>
<td style="text-align:left;">
vegLeadingProportion
</td>
<td style="text-align:left;">
a number that defines whether a species is leading for a given pixel. Only used for plotting.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
This describes the simulation time at which the first plot event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInterval
</td>
<td style="text-align:left;">
This describes the simulation time interval between plot events
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
This describes the simulation time at which the first save event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
This describes the simulation time interval between save events
</td>
</tr>
<tr>
<td style="text-align:left;">
.studyAreaName
</td>
<td style="text-align:left;">
Human-readable name for the study area used. If NA, a hash of <code>studyAreaLarge</code> will be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
Controls cache; caches the init event by default
</td>
</tr>
<tr>
<td style="text-align:left;">
.useParallel
</td>
<td style="text-align:left;">
Used in reading csv file with fread. Will be passed to data.table::setDTthreads.
</td>
</tr>
</tbody>
</table>
</div>
<div id="events-1" class="section level3">
<h3>Events</h3>
<p><em>Biomass_speciesData</em> only runs two events:</p>
<ul>
<li>Module “initiation” (<code>init</code> event), during which all species % cover layers
are downloaded and processed.</li>
<li>Plotting of the processed species cover layers (<code>initPlot</code> event).</li>
</ul>
</div>
<div id="module-outputs-1" class="section level3">
<h3>Module outputs</h3>
<p>The module produces the following outputs (Table
@ref(tab:moduleOutputs-Biomass-speciesData)):</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleOutputs-Biomass-speciesData)List of (ref:Biomass-speciesData) output objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
desc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
speciesLayers
</td>
<td style="text-align:left;">
biomass percentage raster layers by species in Canada species map
</td>
</tr>
<tr>
<td style="text-align:left;">
treed
</td>
<td style="text-align:left;">
Table with one logical column for each species, indicating whether there were non-zero cover values in each pixel.
</td>
</tr>
<tr>
<td style="text-align:left;">
numTreed
</td>
<td style="text-align:left;">
a named vector with number of pixels with non-zero cover values for each species
</td>
</tr>
<tr>
<td style="text-align:left;">
nonZeroCover
</td>
<td style="text-align:left;">
A single value indicating how many pixels have non-zero cover
</td>
</tr>
</tbody>
</table>
<p>and automatically saves the processed species cover layers in the output path
defined in <code>getPaths(sim)$outputPath</code>.</p>
</div>
<div id="links-to-other-modules-1" class="section level3">
<h3>Links to other modules</h3>
<p>Intended to be used with other LandR data modules (e.g.,
<em>Biomass_borealDataPrep</em>) that require species cover data and the LandR forest
simulation <em>Biomass_core</em> module. You can see all <em>potential</em> module linkages
within the LandR ecosystem
<a href="https://rpubs.com/PredictiveEcology/LandR_Module_Ecosystem">here</a>. Select
<em>Biomass_speciesData</em> from the drop-down menu to see linkages.</p>
</div>
<div id="getting-help-1" class="section level3">
<h3>Getting help</h3>
<ul>
<li><a href="https://github.com/PredictiveEcology/Biomass_speciesData/issues" class="uri">https://github.com/PredictiveEcology/Biomass_speciesData/issues</a></li>
</ul>
</div>
</div>
<div id="module-manual-1" class="section level2">
<h2>Module manual</h2>
<div id="detailed-description" class="section level3">
<h3>Detailed description</h3>
<p>This module accesses and processes species percent cover (% cover) data for the
parametrisation and initialization of LandR <em>Biomass_core</em>. This module ensures
1) all data use the same geospatial geometries and 2) that these are correctly
re-projected to studyAreaLarge, and 3) attempts to sequentially fill-in and
replace the lowest quality data with higher quality data when several data
sources are used. It’s primary output is a <code>RasterStack</code> of species % cover,
with each layer corresponding to a species.</p>
<p>Currently, the module can access the Canadian Forest Inventory forest attributes
kNN dataset [the default; <span class="citation">Beaudoin <em>et al.</em> (<a href="#ref-BeaudoinEtAl2017" role="doc-biblioref">2017</a>)</span>], the Common Attribute Schema for
Forest Resource Inventories [CASFRI; <span class="citation">Cosco (<a href="#ref-Cosco2011" role="doc-biblioref">2011</a>)</span>] dataset, the Ontario Forest
Resource Inventory (ONFRI), a dataset specific to Alberta compiled by Paul
Pickell, and other Alberta forest inventory datasets. However, <strong>only the NFI
kNN data are freely available</strong> – access to the other datasets must be granted
by module developers and data owners, and a Google account is required.
Nevertheless, the module is flexible enough that any user can use it to process
additional datasets, provided that an adequate R function is passed to the
module (see <code>types</code> parameter details in <a href="#parameters-2">Parameters</a>)</p>
<p>When multiple data sources are used, the module will use replace lower quality
data with higher quality data following the order specified by the parameter
<code>types</code> (see <a href="#parameters-2">Parameters</a>).</p>
<p>The module can also exclude species % cover layers if they don’t have a minimum
% cover value in at least one pixel. This means that the user should still
inspect in how many pixels the species is deemed present, as it is possible that
some data have only a few pixels with high % cover for a given species. In this
case, the user may choose to exclude these species <em>a posteriori</em>. The summary
plot automatically shown by <em>Biomass_speciesData</em> can help diagnose whether
certain species are present in very few pixels (see Fig.
@ref(fig:fig-Biomass-speciesDataOutPlots)).</p>
</div>
<div id="initialization-inputs-and-parameters-1" class="section level3">
<h3>Initialization, inputs and parameters</h3>
<p><em>Biomass_speciesData</em> initializes itself and prepares all inputs provided that
it has internet access to download the raw data layers (or that these layers
have been previously downloaded and stored in the folder specified by
<code>options("reproducible.destinationPath")</code>).</p>
<p>The module defaults to processing cover data fo all species listed in the
<code>Boreal</code> column of the default <code>sppEquiv</code> input <code>data.table</code> object, for which
there are available % cover layers in the kNN dataset (Table
@ref(tab:defaultSppBiomass-speciesData); see <code>?LandR::sppEquivalencies_CA</code> for
more information):</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:defaultSppBiomass-speciesData)List of species cover data downloaded by default by (ref:Biomass-speciesData).
</caption>
<thead>
<tr>
<th style="text-align:left;">
Species
</th>
<th style="text-align:left;">
Generic name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<em>Abies balsamea</em>
</td>
<td style="text-align:left;">
Balsam Fir
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Abies lasiocarpa</em>
</td>
<td style="text-align:left;">
Fir
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Acer negundo</em>
</td>
<td style="text-align:left;">
Boxelder maple
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Acer pensylvanicum</em>
</td>
<td style="text-align:left;">
Striped maple
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Acer saccharum</em>
</td>
<td style="text-align:left;">
Sugar maple
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Acer spicatum</em>
</td>
<td style="text-align:left;">
Mountain maple
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Acer spp.</em>
</td>
<td style="text-align:left;">
Maple
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Alnus spp</em>
</td>
<td style="text-align:left;">
Alder
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Betula alleghaniensis</em>
</td>
<td style="text-align:left;">
Swamp birch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Betula papyrifera</em>
</td>
<td style="text-align:left;">
Paper birch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Betula populifolia</em>
</td>
<td style="text-align:left;">
Gray birch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Betula spp.</em>
</td>
<td style="text-align:left;">
Birch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Fagus grandifolia</em>
</td>
<td style="text-align:left;">
American beech
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Fraxinus americana</em>
</td>
<td style="text-align:left;">
American ash
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Fraxinus nigra</em>
</td>
<td style="text-align:left;">
Black ash
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Larix laricina</em>
</td>
<td style="text-align:left;">
Tamarack
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Larix lyallii</em>
</td>
<td style="text-align:left;">
Alpine larch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Larix occidentalis</em>
</td>
<td style="text-align:left;">
Western larch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Larix spp.</em>
</td>
<td style="text-align:left;">
Larch
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea engelmannii</em>
</td>
<td style="text-align:left;">
Engelmann’s spruce
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea glauca</em>
</td>
<td style="text-align:left;">
White.Spruce
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea mariana</em>
</td>
<td style="text-align:left;">
Black.Spruce
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea spp.</em>
</td>
<td style="text-align:left;">
Spruce
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus albicaulis</em>
</td>
<td style="text-align:left;">
Whitebark pine
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus banksiana</em>
</td>
<td style="text-align:left;">
Jack pine
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus contorta</em>
</td>
<td style="text-align:left;">
Lodgepole pine
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus monticola</em>
</td>
<td style="text-align:left;">
Western white pine
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus resinosa</em>
</td>
<td style="text-align:left;">
Red pine
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus spp.</em>
</td>
<td style="text-align:left;">
Pine
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Populus balsamifera v. balsamifera</em>
</td>
<td style="text-align:left;">
Balsam poplar
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Populus trichocarpa</em>
</td>
<td style="text-align:left;">
Black cottonwood
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Populus grandidentata</em>
</td>
<td style="text-align:left;">
White poplar
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Populus spp.</em>
</td>
<td style="text-align:left;">
Poplar
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Populus tremuloides</em>
</td>
<td style="text-align:left;">
Trembling poplar
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Tsuga canadensis</em>
</td>
<td style="text-align:left;">
Eastern hemlock
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Tsuga spp.</em>
</td>
<td style="text-align:left;">
Hemlock
</td>
</tr>
</tbody>
</table>
<div id="input-objects-1" class="section level4">
<h4>Input objects</h4>
<p><em>Biomass_speciesData</em> requires the following input data layers</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleInputs2-Biomass-speciesData)List of (ref:Biomass-speciesData) input objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
objectClass
</th>
<th style="text-align:left;">
desc
</th>
<th style="text-align:left;">
sourceURL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rasterToMatchLarge
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
a raster of <code>studyAreaLarge</code> in the same resolution and projection the simulation’s. Defaults to the using the Canadian Forestry Service, National Forest Inventory, kNN-derived stand biomass map.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
sppColorVect
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
A named vector of colors to use for plotting. The names must be in sim<span class="math inline">\(sppEquiv[[sim\)</span>sppEquivCol]], and should also contain a color for ‘Mixed’
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquiv
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
table of species equivalencies. See <code>LandR::sppEquivalencies_CA</code>.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaLarge
</td>
<td style="text-align:left;">
SpatialPolygonsDataFrame
</td>
<td style="text-align:left;">
Polygon to use as the parametrisation study area. Must be provided by the user. Note that <code>studyAreaLarge</code> is only used for parameter estimation, and can be larger than the actual study area used for LandR simulations (e.g, larger than <code>studyArea</code> in LandR Biomass_core).
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
studyAreaReporting
</td>
<td style="text-align:left;">
SpatialPolygonsDataFrame
</td>
<td style="text-align:left;">
multipolygon (typically smaller/unbuffered than <code>studyAreaLarge</code> and <code>studyArea</code> in LandR Biomass_core) to use for plotting/reporting. If not provided, will default to <code>studyAreaLarge</code>.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Of the inputs in Table @ref(tab:moduleInputs2-Biomass-speciesData), the
following are particularly important and deserve special attention:</p>
<ul>
<li><p><code>studyAreaLarge</code> – the polygon defining the area for which species cover
data area desired. It can be larger (but never smaller) that the study area
used in the simulation of forest dynamics (i.e., <code>studyArea</code> object in
<em>Biomass_core</em>).</p></li>
<li><p><code>sppEquiv</code> – a table of correspondences between different species naming
conventions. This table is used across several LandR modules, including
<em>Biomass_core</em>. It is particularly important here because it will determine
whether and how species (and their cover layers) are merged, if this is
desired by the user. For instance, if the user wishes to simulate a generic
<em>Picea spp.</em> that includes, <em>Picea glauca</em>, <em>Picea mariana</em> and <em>Picea
engelmannii</em>, they will need to provide these three species names in the
data column (e.g., <code>KNN</code> if obtaining forest attribute kNN data layers from
the Canadian Forest Inventory), but the same name (e.g., “Pice_Spp”) in the
coumn chosen for the naming convention used throughout the simulation (the
<code>sppEquivCol</code> parameter); see Table
@ref(tab:mergingSpp-Biomass-speciesData) for an example)</p></li>
</ul>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:mergingSpp-Biomass-speciesData)Example of species merging for simulation. Here the user wants to model <em>Abies balsamea</em>, <em>A. lasiocarpa</em> and <em>Pinus contorta</em> as separate species, but all <em>Picea</em> species as a generic <em>Picea spp.</em>. For this, all six species are identified in the ‘KNN’ column, so that their % cover layers can be obtained, but in the ‘Boreal’ column (which defines the naming convention used in the simulation in this example) all <em>Picea</em> species have the same name. (ref:Biomass-speciesData) will merge their % cover data into a single layer by summing their cover per pixel.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Species
</th>
<th style="text-align:left;">
KNN
</th>
<th style="text-align:left;">
Boreal
</th>
<th style="text-align:left;">
Modelled as
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<em>Abies balsamea</em>
</td>
<td style="text-align:left;">
Abie_Bal
</td>
<td style="text-align:left;">
Abie_Bal
</td>
<td style="text-align:left;">
<em>Abies balsamea</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Abies lasiocarpa</em>
</td>
<td style="text-align:left;">
Abie_Las
</td>
<td style="text-align:left;">
Abie_Las
</td>
<td style="text-align:left;">
<em>Abies lasiocarpa</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea engelmannii</em>
</td>
<td style="text-align:left;">
Pice_Eng
</td>
<td style="text-align:left;">
Pice_Spp
</td>
<td style="text-align:left;">
<em>Picea spp.</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea glauca</em>
</td>
<td style="text-align:left;">
Pice_Gla
</td>
<td style="text-align:left;">
Pice_Spp
</td>
<td style="text-align:left;">
<em>Picea spp.</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Picea mariana</em>
</td>
<td style="text-align:left;">
Pice_Mar
</td>
<td style="text-align:left;">
Pice_Spp
</td>
<td style="text-align:left;">
<em>Picea spp.</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Pinus contorta</em>
</td>
<td style="text-align:left;">
Pinu_Con
</td>
<td style="text-align:left;">
Pinu_Con
</td>
<td style="text-align:left;">
<em>Pinus contorta</em>
</td>
</tr>
</tbody>
</table>
</div>
<div id="parameters-1" class="section level4">
<h4>Parameters</h4>
<p>Table @ref(tab:moduleParams2-Biomass-speciesData) lists all parameters used in
<em>Biomass_speciesData</em> and their detailed information.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleParams2-Biomass-speciesData)List of (ref:Biomass-speciesData) parameters and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramClass
</th>
<th style="text-align:left;">
default
</th>
<th style="text-align:left;">
min
</th>
<th style="text-align:left;">
max
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
coverThresh
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The minimum % cover a species needs to have (per pixel) in the study area to be considered present
</td>
</tr>
<tr>
<td style="text-align:left;">
dataYear
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2001
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Passed to <code>paste0('prepSpeciesLayers_', types)</code> function to fetch data from that year (if applicable). Defaults to 2001 as the default kNN year.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
Boreal
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to group species by and use as a naming convention. If different species in, e.g., the kNN data have the same name in the chosen column, their data are merged into one species by summing their % cover in each raster cell.
</td>
</tr>
<tr>
<td style="text-align:left;">
types
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
KNN
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The possible data sources. These must correspond to a function named paste0(‘prepSpeciesLayers_’, types). Defaults to ‘KNN’ to get the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from year ‘dataYear’, using the <code>LandR::prepSpeciesLayers_KNN</code> function (see <a href="https://open.canada.ca/" class="uri">https://open.canada.ca/</a> data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990 for details on these data). Other currently available options are ‘ONFRI’, ‘CASFRI’, ‘Pickell’ and ‘ForestInventory’, which attempt to get proprietary data - the user must be granted access first. A custom function can be used to retrieve any data, just as long as it is accessible by the module (e.g., in the global environment) and is named as paste0(‘prepSpeciesLayers_’, types).
</td>
</tr>
<tr>
<td style="text-align:left;">
vegLeadingProportion
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
0.8
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
a number that defines whether a species is leading for a given pixel. Only used for plotting.
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time at which the first plot event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time interval between plot events
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time at which the first save event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time interval between save events
</td>
</tr>
<tr>
<td style="text-align:left;">
.studyAreaName
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Human-readable name for the study area used. If NA, a hash of <code>studyAreaLarge</code> will be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Controls cache; caches the init event by default
</td>
</tr>
<tr>
<td style="text-align:left;">
.useParallel
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Used in reading csv file with fread. Will be passed to data.table::setDTthreads.
</td>
</tr>
</tbody>
</table>
<p>Of the parameters listed in Table @ref(tab:moduleParams2-Biomass-speciesData),
the following are particularly important:</p>
<ul>
<li><p><code>coverThresh</code> – integer. Defines a minimum % cover value (from 0-100) that
the species must have in at least one pixel to be considered present in the
study area, otherwise it is excluded from the final stack of species layers.
Note that this will affect what species have data for an eventual simulation
and the user will need to adjust simulation parameters (e.g., species in
trait tables will need to match the species in the cover layers)
accordingly.</p></li>
<li><p><code>types</code> – character. Which % cover data sources are to be used (see
<a href="#detailed-description-1">Detailed description</a>). Several data sources can be passed, in which case
the module will overlay the lower quality layers with higher quality ones
<strong>following the order of data sources specified by <code>types</code></strong> – i.e., if
<code>types == c("KNN", "CASFRI", "ForestInventory")</code>, <em>KNN</em> is assumed to be the
lowest quality data set and <em>ForestInventory</em> the highest: values in <em>KNN</em>
layers are replaced with overlapping values from <em>CASFRI</em> layers and values
from <em>KNN</em> and <em>CASFRI</em> layers are replaced with overlapping values of
<em>ForestInventory</em> layers.</p></li>
</ul>
</div>
</div>
<div id="simulation-flow-1" class="section level3">
<h3>Simulation flow</h3>
<p>The general flow of <em>Biomass_speciesData</em> processes is:</p>
<ol style="list-style-type: decimal">
<li><p>Download (if necessary) of and spatial processing of species cover layers
from the first data source listed in the <code>types</code> parameter. Spatial
processing consists in sub-setting the data to the area defined by
<code>studyAreaLarge</code> and ensuring that the spatial projection and resolution
match those of <code>rasterToMatchLarge</code>. After spatial processing, species
layers that have no pixels with values &gt;= to the <code>coverThresh</code> parameter
are excluded.</p></li>
<li><p>If more than one data source is listed in <code>types</code>, the second set of species
cover layers is downloaded and processed as above.</p></li>
<li><p>The second set of layers is assumed to be the highest quality dataset and
used to replaced overlapping pixel values on the first (including for
species whose layers may have been initially excluded after applying the
<code>coverThresh</code> filter).</p></li>
<li><p>Steps 2 and 3 are repeated for remaining data sources listed in <code>types</code>.</p></li>
<li><p>Final layers are saved to disk and plotted. A summary of number of pixels
with forest cover are calculated (<code>treed</code>and <code>numTreed</code> output objects; see
<a href="#module-outputs-2">Module outputs</a>).</p></li>
</ol>
</div>
</div>
<div id="usage-example-1" class="section level2">
<h2>Usage example</h2>
<div id="load-spades-and-other-packages." class="section level3">
<h3>Load <code>SpaDES</code> and other packages.</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(Require)) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;Require&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(Require)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Require</span>(<span class="fu">c</span>(<span class="st">&quot;PredictiveEcology/SpaDES.install&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;SpaDES&quot;</span>, <span class="st">&quot;PredictiveEcology/SpaDES.core@development&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PredictiveEcology/LandR&quot;</span>), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">install_githubArgs =</span> <span class="fu">list</span>(<span class="at">dependencies =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
<div id="get-module-necessary-packages-and-set-up-folder-directories" class="section level3">
<h3>Get module, necessary packages and set up folder directories</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tempDir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>spadesModulesDirectory <span class="ot">&lt;-</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;modules&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">inputPath =</span> <span class="fu">normPath</span>(<span class="fu">file.path</span>(tempDir, <span class="st">&quot;inputs&quot;</span>)), </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">cachePath =</span> <span class="fu">normPath</span>(<span class="fu">file.path</span>(tempDir, <span class="st">&quot;cache&quot;</span>)), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">modulePath =</span> <span class="fu">normPath</span>(spadesModulesDirectory), </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">outputPath =</span> <span class="fu">normPath</span>(<span class="fu">file.path</span>(tempDir, <span class="st">&quot;outputs&quot;</span>)))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">getModule</span>(<span class="st">&quot;PredictiveEcology/Biomass_speciesData&quot;</span>, <span class="at">modulePath =</span> spadesModulesDirectory, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="do">## make sure all necessary packages are installed:</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">makeSureAllPackagesInstalled</span>(spadesModulesDirectory)</span></code></pre></div>
</div>
<div id="setup-simulation-1" class="section level3">
<h3>Setup simulation</h3>
<p>For this demonstration we are using all default parameter values, except
<code>coverThresh</code> , which is lowered to 5%. The species layers (the major output of
interest) are saved automatically, so there is no need to tell <code>spades</code> what to
save using the <code>outputs</code> argument (see <code>?SpaDES.core::outputs</code>).</p>
<p>We pass the global parameter <code>.plotInitialTime = 1</code> in the <code>simInitAndSpades</code>
function to activate plotting.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># User may want to set some options -- see ?reproducibleOptions </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    -- e.g., often the path to the &#39;inputs&#39; folder will be set outside of project by user:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># options(reproducible.inputPaths = &quot;E:/Data/LandR_related/&quot;) # to re-use datasets across projects</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>studyAreaLarge <span class="ot">&lt;-</span> <span class="fu">Cache</span>(randomStudyArea, <span class="at">size =</span> <span class="fl">1e7</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cacheRepo =</span> paths<span class="sc">$</span>cachePath) <span class="co"># cache this so it creates a random one only once on a machine</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the species you want to work with -- here we use the naming convention in &quot;Boreal&quot; column of LandR::sppEquivalencies_CA (default)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>speciesNameConvention <span class="ot">&lt;-</span> <span class="st">&quot;Boreal&quot;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>speciesToUse <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Pice_Gla&quot;</span>, <span class="st">&quot;Popu_Tre&quot;</span>, <span class="st">&quot;Pinu_Con&quot;</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>sppEquiv <span class="ot">&lt;-</span> LandR<span class="sc">::</span>sppEquivalencies_CA[<span class="fu">get</span>(speciesNameConvention) <span class="sc">%in%</span> speciesToUse]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign a colour convention for graphics for each species</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>sppColorVect <span class="ot">&lt;-</span> LandR<span class="sc">::</span><span class="fu">sppColors</span>(sppEquiv, speciesNameConvention,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newVals =</span> <span class="st">&quot;Mixed&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Usage example</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Biomass_speciesData&quot;</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>objects <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;studyAreaLarge&quot;</span> <span class="ot">=</span> studyAreaLarge,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;sppEquiv&quot;</span> <span class="ot">=</span> sppEquiv,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;sppColorVect&quot;</span> <span class="ot">=</span> sppColorVect)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Biomass_speciesData&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;coverThresh&quot;</span> <span class="ot">=</span> 5L))</span></code></pre></div>
</div>
<div id="run-module" class="section level3">
<h3>Run module</h3>
<p>Note that because this is a data module (i.e., only attempts to prepare data for
the simulation) we are not iterating it and so both the start and end times are
set to <code>1</code> here.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>opts <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">reproducible.useCache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">reproducible.inputPaths =</span> paths<span class="sc">$</span>inputPath)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>mySimOut <span class="ot">&lt;-</span> <span class="fu">simInitAndSpades</span>(<span class="at">times =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">1</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">modules =</span> modules, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">parameters =</span> params,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">objects =</span> objects, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">paths =</span> paths,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">.plotInitialTime =</span> <span class="dv">1</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(opts)</span></code></pre></div>
<p>Here are some of the data retrieved by <em>Biomass_speciesData</em> for a randomly
generated study area within Canada.</p>
<div class="figure">
<img src="figures/testRunFigure.png" alt="(ref:Biomass-speciesData) automatically generates a plot of species dominance and number of presences in the study area when `.plotInitialTime=1` is passed as an argument."  />
<p class="caption">
(#fig:fig-Biomass-speciesDataOutPlots)(ref:Biomass-speciesData) automatically generates a plot of species dominance and number of presences in the study area when <code>.plotInitialTime=1</code> is passed as an argument.
</p>
</div>
</div>
</div>
<div id="references-1" class="section level2">
<h2>References</h2>
<!--chapter:end:modules/Biomass_speciesData/Biomass_speciesData2.Rmd-->
</div>
</div>
<div id="landr-validation-modules" class="section level1">
<h1>LandR Validation Modules</h1>
<p>LandR ‘validation modules’ differ from ‘data modules’ in that their objective is not to obtain input data and estimate parameters to run a simulation, but rather to confront simulation outputs against observed data – even if these modules can potentially obtain and pre-process the validation data.
At the moment, only one validation module is available <em>Biomass_validationKNN</em>, but we expect an increment in the number of validation modules as LandR usage expands.</p>
<!--chapter:end:LandR-validModulesForeword.Rmd-->
</div>
<div id="landr-biomass_validationknn-module" class="section level1">
<h1>LandR <em>Biomass_validationKNN</em> Module</h1>
<!-- the following are text references used in captions for LaTeX compatibility -->
<p>(ref:Biomass-validationKNN) <em>Biomass_validationKNN</em></p>
<p><a href="http://commonmark.org"><img src="https://img.shields.io/badge/Made%20with-Markdown-1f425f.png" alt="made-with-Markdown" /></a>
<a href="https://github.com/PredictiveEcology/Biomass_validationKNN/issues"><img src="https://img.shields.io/badge/Get%20help-Report%20issues-%3CCOLOR%3E.png" alt="Generic badge" /></a></p>
<!-- if knitting to pdf remember to add the pandoc_args: ["--extract-media", "."] option to yml in order to get the badge images -->
<p><strong>This documentation is work in progress. Potential discrepancies and omissions
may exist for the time being. If you find any, do contact us using the link
above^^</strong></p>
<div id="authors-2" class="section level4">
<h4>Authors:</h4>
<p>Ceres Barros <a href="mailto:cbarros@mail.ubc.ca" class="email">cbarros@mail.ubc.ca</a> [aut, cre]
<!-- ideally separate authors with new lines, '\n' not working --></p>
</div>
<div id="module-overview-2" class="section level2">
<h2>Module Overview</h2>
<div id="module-summary-2" class="section level3">
<h3>Module summary</h3>
<p>An approach to validating outputs from LandR Biomass - notably the
<em>Biomass_core</em> vegetation simulation module - using publicly available data for
Canadian forests. This module produces both visual and statistical validation of
<em>Biomass_core</em> outputs that are related to species abundance and
presence/absence in the landscape. To do so, it downloads and prepares all
necessary data (observed and simulated), calculates validation statistics and
produces/saves validation plots.</p>
</div>
<div id="module-inputs-and-parameters-at-a-glance-1" class="section level3">
<h3>Module inputs and parameters at a glance</h3>
<p><em>Biomass_validationKNN</em> requires access to outputs of simulations from
<em>Biomass_core</em>, and internet access to retrieve the observed kNN datasets used
for validation. Raw data layers downloaded by the module are saved in
<code>dataPath(sim)</code>, which can be controlled via
<code>options(reproducible.destinationPath = ...)</code>.</p>
<p>We advise future users to run <em>Biomass_validationKNN</em> with defaults and inspect
what the objects are like before supplying their own data, or alternative data
URLs. We expect the number of validation modules to increase as other validation
approaches are developed based on project needs.</p>
<p>The module is able to compile all simulation output data provided that the user
supplies the object names and their file paths via the <code>simulationOutputs</code> input
object. Alternatively, the user may pass the pre-compiled outputs (namely the
<code>cohortData</code> and <code>pixelGroupMap</code> objects) via the <code>allCohortData</code> and
<code>pixelGroupMapStk</code> input objects. See <a href="#input-objects-2">Input objects</a> for more detail.</p>
<p>Key parameters are those defining simulation years and replicates,
(<code>validationYears</code>, <code>validationReps</code>) and plot control (<code>.plots</code>). Here’s the
full list of parameters:</p>
<p>Below is the full list of input objects (Table
@ref(tab:moduleInputs-Biomass-validationKNN)) and parameters (Table
@ref(tab:moduleParams-Biomass-validationKNN)) that <em>Biomass_validationKNN</em>
expects. The only input that <strong>must</strong> be provided (i.e., <em>Biomass_validationKNN</em>
does not have a default for) is <code>studyArea</code>. All other input objects and
parameters have internal defaults (see Tables
@ref(tab:moduleInputs2-Biomass-validationKNN) and
@ref(tab:moduleParams2-Biomass-validationKNN). Objects suffixed with <code>*Start</code>
correspond to the same objects in the simulation without this suffix (e.g.
<code>rawBiomassMapStart</code> is <code>rawBiomassMap</code> in the simulation), whereas other
objects like <code>studyArea</code> and <code>rasterToMatch</code> have the same names in the
simulation and should be exactly the same object.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleInputs-Biomass-validationKNN)List of (ref:Biomass-validationKNN) input objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
desc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
allCohortData
</td>
<td style="text-align:left;">
All <code>cohortData</code> tables saved during the simulation, particularly for the validation years. If not supplied, the module will attempt to retrieve them using the ‘simulationOutputs’ table
</td>
</tr>
<tr>
<td style="text-align:left;">
biomassMap
</td>
<td style="text-align:left;">
total biomass raster layer in study area (in g/m^2), filtered for pixels covered by <code>cohortData</code>. Only used to calculate total no. of pixels being simulated If not supplied, will default to <code>rawBiomassMapStart</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
firePerimeters
</td>
<td style="text-align:left;">
A map of fire perimeters in the study area that can be used to exclude pixels that have been burnt during the validation period. If burnt pixels are not to be excluded Provide an empty <code>sf</code> object with the same properties as the default. Defaults to the latest Canadian Wildland Fire Information System National Burned Area Composite, subset to fires occuring up to last validation year (inclusively). Source URL determined by <code>fireURL</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
fireURL
</td>
<td style="text-align:left;">
A URL to a fire database, such as the Canadian National Fire Database, that is a zipped shapefile with fire polygons, an attribute (i.e., a column) named ‘Year’. If supplied (omitted with NULL or NA), this will be used to ‘update’ age pixels on <code>standAgeMap</code> with ‘time since fire’ as derived from this fire polygons map
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupMapStk
</td>
<td style="text-align:left;">
A stack of <code>pixelGroupMap</code>s saved during the simulation, particularly for the validation years. If not supplied, the module will attempt to make it using the ‘simulationOutputs’ table
</td>
</tr>
<tr>
<td style="text-align:left;">
rawBiomassMapStart
</td>
<td style="text-align:left;">
observed total biomass raster layer in study area at the first year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived total aboveground biomass map from 2001 (in ton/ha). See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata.
</td>
</tr>
<tr>
<td style="text-align:left;">
rawBiomassMapEnd
</td>
<td style="text-align:left;">
observed total biomass raster layer in study area at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived total aboveground biomass map from 2011 (in ton/ha) See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
rasterToMatch
</td>
<td style="text-align:left;">
A raster of the <code>studyArea</code> in the same resolution and projection as <code>rawBiomassMapStart</code>. This is the scale used for all outputs for use in the simulation.
</td>
</tr>
<tr>
<td style="text-align:left;">
rstLCChange
</td>
<td style="text-align:left;">
A mask-type map of land cover changes in the study area that can be used to exclude pixels that have been disturbed during the validation period. If disturbed pixels are not to be excluded Provide an empty sf object with the same properties as the default. Defaults to Canada’s forest change map between 1985-2011 (CFS), filtered for years 2001-2011 (inclusively) and all disturbances collapsed (map only has values of 1 and NA). See <code>P(sim)$LCChangeYr</code> parameter to change the period of disturbances, and <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;">
rstLCChangeYr
</td>
<td style="text-align:left;">
An OPTIONAL map of land cover change years in the study area used to exclude pixels that have been disturbed during the validation period. It defaults to Canada’s forest change year national map between 1985-2011 (CFS). If <code>P(sim)$LCChangeYr</code> is not <code>NULL</code>, this layer is used to filted disturbed pixels that fall within the years specified by <code>P(sim)$LCChangeYr</code>. If <code>P(sim)$LCChangeYr</code> is <code>NULL</code> this layer is not used. See <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;">
simulationOutputs
</td>
<td style="text-align:left;">
An OPTIONAL table listing simulation outputs (as passed to <code>spades()</code>, or <code>experiment) that will be used to make</code>allCohortData<code>,</code>pixelGroupMapStk<code>, if these are not provided. &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; speciesLayersStart &lt;/td&gt;    &lt;td style="text-align:left;"&gt; observed cover percentage raster layers by species in Canada species map, at the first year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2001, using a cover threshold of 10% - see https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990 for metadata &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; speciesLayersEnd &lt;/td&gt;    &lt;td style="text-align:left;"&gt; observed percent cover raster layers by species in Canada used for validation at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2011 - see https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990 for metadata &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; sppColorVect &lt;/td&gt;    &lt;td style="text-align:left;"&gt; A named vector of colors to use for plotting. The names must be in sim$sppEquiv[[sim$sppEquivCol]], and should also contain a color for 'Mixed' &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; sppEquiv &lt;/td&gt;    &lt;td style="text-align:left;"&gt; table of species equivalencies. See</code>LandR::sppEquivalencies_CA`.
</td>
</tr>
<tr>
<td style="text-align:left;">
standAgeMapStart
</td>
<td style="text-align:left;">
observed stand age map in study area, at the first year of the validation period Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived biomass map from 2001 - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata
</td>
</tr>
<tr>
<td style="text-align:left;">
standAgeMapEnd
</td>
<td style="text-align:left;">
observed stand age raster layer in study area, at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived stand age map from 2011. See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
studyArea
</td>
<td style="text-align:left;">
Polygon to use as the study area. Must be provided by the user
</td>
</tr>
</tbody>
</table>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleParams-Biomass-validationKNN)List of (ref:Biomass-validationKNN) parameters and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
coverThresh
</td>
<td style="text-align:left;">
The minimum % cover a species needs to have (per pixel) in the study area to be considered present. Should be the same as the one used to obtain the species cover layers for simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
deciduousCoverDiscount
</td>
<td style="text-align:left;">
This was estimated with data from NWT on March 18, 2020 and may or may not be universal. Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
LCChangeYr
</td>
<td style="text-align:left;">
OPTIONAL. An integer or vector of integers of the validation period years, defining which years of land-cover changes (i.e. disturbances) should be excluded. <code>NULL</code> by default, which presumes no subsetting based on years is done internally (either the user supplies a pre-filtered <code>rstLCChange</code>, or no filtering is desired). If not <code>NULL</code> <code>rstLCChangeYr</code> is used to filter disturbed pixels within the specified years. See <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;">
minCoverThreshold
</td>
<td style="text-align:left;">
Cover that is equal to or below this number will be omitted from the dataset Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
obsDeltaAgeB
</td>
<td style="text-align:left;">
When TRUE, the observed changes in biomass and age (deltaB, deltaAge) between the two validation years will be plotted as maps and scatterplots
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupBiomassClass
</td>
<td style="text-align:left;">
When assigning <code>pixelGroup</code> membership, this defines the resolution of biomass that will be considered ‘the same pixelGroup’, e.g., if it is 100, then 5160 and 5240 will be the same Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to use as a naming convention
</td>
</tr>
<tr>
<td style="text-align:left;">
validationReps
</td>
<td style="text-align:left;">
The simulation repetitions for the validation. Defaults to 1:10. Set to NA if not using repetitions (i.e. only one run)
</td>
</tr>
<tr>
<td style="text-align:left;">
validationYears
</td>
<td style="text-align:left;">
The simulation years for the validation. Defaults to 2001 and 2011. Must select two years
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
If NA plotting is off completely (this includes saving).
</td>
</tr>
<tr>
<td style="text-align:left;">
.plots
</td>
<td style="text-align:left;">
Passed to <code>types</code> in Plots (see ?Plots). There are a few plots that are made within this module, if set. Note that plots (or their data) are saved in file.path(outputPath(sim), ‘figures’). If <code>NA</code>, plotting is off completely (this includes plot saving).
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
This describes the simulation time at which the first save event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
This describes the simulation time interval between save events
</td>
</tr>
<tr>
<td style="text-align:left;">
.studyAreaName
</td>
<td style="text-align:left;">
Human-readable name for the study area used. If <code>NA</code>, a hash of <code>studyArea</code> will be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
Controls cache; caches the init event by default
</td>
</tr>
</tbody>
</table>
</div>
<div id="events-2" class="section level3">
<h3>Events</h3>
<p>The following events take place during a <em>Biomass_validationKNN</em> run. Note that
this module only runs once (in one “time step”).</p>
<ul>
<li><p>Module initiation (<code>init</code> event) - prepares both the observed and simulated
data to be compared</p></li>
<li><p>Calculation of summary variables for validation (<code>calculateValidVars</code> event)</p></li>
<li><p>Calculation of validation statistics (<code>validationStats</code> event)</p></li>
<li><p>Optional diagnostic plots of biomass and age changes (<span class="math inline">\(\Delta\)</span>B,
<span class="math inline">\(\Delta\)</span>Age) in the observed data (<code>obsDeltaMaps</code> event).</p></li>
<li><p>Plotting events:</p>
<ul>
<li><p>Plots of landscape-wide (<code>landscapeWidePlots</code> event), pixel-level
(<code>pixelLevelPlots</code> events) comparisons of all summary variables</p></li>
<li><p>Plots of biomass and age changes (<span class="math inline">\(\Delta\)</span>B, <span class="math inline">\(\Delta\)</span>Age) in observed
and simulated data, with respect to the first year. (<code>deltaBComparisons</code>
event)</p></li>
</ul></li>
</ul>
</div>
<div id="module-outputs-2" class="section level3">
<h3>Module outputs</h3>
<p>The module produces the following outputs (Table
@ref(tab:moduleOutputs-Biomass-validationKNN)):</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleOutputs-Biomass-validationKNN)List of (ref:Biomass-validationKNN) output objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
desc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
logLikelihood
</td>
<td style="text-align:left;">
A table of negative sum log-likelihood values calculated for different variables and averaged across repetitions. At the moment, log-likelihood values are calculated for biomass (landscape- and pixel-level), species presences and dominance (lanscape-level) and deltaB (landscape- and pixel-level. For biomass and count data (presences/dominance, we assume an underlying multinomial distribution, and for deltaB a multivariate Gaussian distribution - note that the later is still under development.
</td>
</tr>
<tr>
<td style="text-align:left;">
landscapeMAD
</td>
<td style="text-align:left;">
Mean absolute deviance values calculated on landscape-level relative abundances, species presences and dominance, and deltaB, per repetition and year (except for deltaB, which is integrated across years)
</td>
</tr>
<tr>
<td style="text-align:left;">
landscapeVars
</td>
<td style="text-align:left;">
A table containing observed and simulated landscape-averaged variables used for validation (by year and repetition, ‘rep’, in the case of simulated data), namely: species relative abundances (‘relAbund’), species presenses (‘count’), species dominance (as in no. pixels where a given species, has higher ‘relAbund’; ‘countDom’) and species changes in biomass, as 2011 minus 2001 (‘deltaB’). Observed data rows are labelled as ‘observed’ in ‘dataType’ column. In species dominance, pixels with &gt;= 2 species with max(B) and pixels with no B are classified as ‘Mixed’ and ‘No veg.’, respectively in the ‘speciesCode’ column - note that this is ‘vegType’ column in <code>pixelCohortData</code>.
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelCohortData
</td>
<td style="text-align:left;">
A table containing observed and simulated pixel-level data (by year and repetition, ‘rep’, in the case of simulated data) on species biomass (summed across cohorts, ‘B’), total pixel biomass (‘pixelB’), average biomass-weighted pixel age (‘pixelAge’), species relative abundance (calculated as B/pixelB, ‘relativeAbund’), species dominance (the species with max(B), ‘vegType’), and lanscape-wide biomass (‘landscapeB’). Observed data columns are suffixed with ‘Obsrvd’. In species dominance, pixels with &gt;= 2 species with max(B) (i.e. ‘noDoms’ &gt;= 2) are classified as ‘Mixed’.
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelMAD
</td>
<td style="text-align:left;">
Mean absolute deviance values calculated on pixel-level relative abundances and deltaB, per repetition and year (except for deltaB, which is integrated across years)
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelVars
</td>
<td style="text-align:left;">
The same as <code>landscapeVars</code>, but variables are calculated at the pixel-level
</td>
</tr>
<tr>
<td style="text-align:left;">
rstDisturbedPix
</td>
<td style="text-align:left;">
Raster of pixel IDs (as a mask) that have been disturbed by fire or suffered land-cover changes during the validation period. These pixels are excluded form the validation.
</td>
</tr>
<tr>
<td style="text-align:left;">
rawBiomassMapStart
</td>
<td style="text-align:left;">
observed total biomass raster layer in study area at the first year of the validation period. Filtered to exclude pixels that were disturbed during the validation period
</td>
</tr>
<tr>
<td style="text-align:left;">
rawBiomassMapEnd
</td>
<td style="text-align:left;">
observed total biomass raster layer in study area at the last year of the validation period. Filtered to exclude pixels that were disturbed during the validation period
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesLayersStart
</td>
<td style="text-align:left;">
observed percent cover raster layers by species in Canada at the first year of the validation period. Filtered to exclude pixels that were disturbed during the validation period
</td>
</tr>
<tr>
<td style="text-align:left;">
speciesLayersEnd
</td>
<td style="text-align:left;">
observed percent cover raster layers by species in Canada at the last year of the validation period. Filtered to exclude pixels that were disturbed during the validation period
</td>
</tr>
<tr>
<td style="text-align:left;">
standAgeMapStart
</td>
<td style="text-align:left;">
observed stand age map in study area, at the first year of the validation period Filtered to exclude pixels that were disturbed during the validation period
</td>
</tr>
<tr>
<td style="text-align:left;">
standAgeMapEnd
</td>
<td style="text-align:left;">
observed stand age map in study area, at the last year of the validation period Filtered to exclude pixels that were disturbed during the validation period
</td>
</tr>
</tbody>
</table>
<p>and saves the validation figures in the output path defined in
<code>getPaths(sim)$outputPath</code> (which was defined as <code>paths$outputPath</code>). Tables are
not saved unless specified via <code>spades(outputs = data.frame(...), ...)</code>. If not
saving objects to disk (such as tables), these can be looked at using, e.g.,
<code>mySimValidation$logLikelihood</code>.</p>
</div>
<div id="links-to-other-modules-2" class="section level3">
<h3>Links to other modules</h3>
<p>Intended to be used with <em>Biomass_core</em> and any other modules that link to it
and affect cohort biomass (e.g., via <code>cohortData</code> table). You can see all
<em>potential</em> module linkages within the LandR ecosystem
<a href="https://rpubs.com/PredictiveEcology/LandR_Module_Ecosystem">here</a>. Select
<em>Biomass_validationKNN</em> from the drop-down menu to see linkages.</p>
</div>
<div id="getting-help-2" class="section level3">
<h3>Getting help</h3>
<ul>
<li><a href="https://github.com/PredictiveEcology/Biomass_validationKNN/issues" class="uri">https://github.com/PredictiveEcology/Biomass_validationKNN/issues</a></li>
</ul>
</div>
</div>
<div id="module-manual-2" class="section level2">
<h2>Module manual</h2>
<div id="detailed-description-1" class="section level3">
<h3>Detailed description</h3>
<p>This module compares simulated outputs of two years (across replicates), with
corresponding years of observed data. It was designed to compare the observed
data for years 2001 (start point for the simulation) and 2011 (i.e., after 10
years of simulation) of the kNN forest layers of the Canadian National Forest
Inventory – these are currently the only available FAIR datasets <span class="citation">(<em>sensu</em> <a href="#ref-StallEtAl2019" role="doc-biblioref">Stall <em>et al.</em> 2019</a>)</span>) on stand biomass and species % cover changes across Canada.
However, the user can supply other sources of observed data, as long as they
have an identical format.</p>
<p>The validation is done both visually (using barplots and boxplots) and using two
statistics: mean absolute deviation of simulated biomass (per species) and the
sum of negative log-likelihoods (SNLL) of predictions with respect to observed
data for species biomass, species presences/absences and changes in biomass
(<span class="math inline">\(\Delta\)</span>B) - the later is still under development.</p>
<p>This module assumes that the simulation data preparation was carried out by
<em>Biomass_borealDataPrep</em>, and so, to ensure that the comparison and the
simulated datasets are built with the same assumptions, the data treatment steps
in <em>Biomass_borealDataPrep</em> are repeated here. The module may also excludes
disturbed pixels coded in <code>rstLCCChange</code> and fire perimeter data
(<code>firePerimeters</code>). If this is not intended, pass a <code>rstLCCChange</code> with <code>NA</code>’s
only and/or an empty <code>firePerimeters</code> <code>sf</code> object. <em>Biomass_validationKNN</em> then
compares simulated species biomass, presences, dominance, and changes in biomass
against observed data available for the starting conditions (2011 by default)
and a second time point (e.g. 2011, or after 10 years of simulation). To do so,
for each year and replicate, and for both the simulated and observed data, the
module calculates:</p>
<ul>
<li><p>species relative abundances at the pixel- and landscape-level (across all
pixels)</p></li>
<li><p>species presences and dominance at the landscape level</p></li>
<li><p>changes in species biomass (<span class="math inline">\(\Delta\)</span>B) at the pixel- and landscape-level for
both the simulated and observed data. Biomass units respect those used in
<em>Biomass_core</em> (<span class="math inline">\(g/m^2\)</span>).</p></li>
</ul>
<p>Pixel-level relative abundances are calculated as the species biomass (summed
across cohorts) divided by the total pixel biomass (summed across cohorts and
species), while landscape-wide relative abundances are calculated as the sum of
a species biomass across all pixels divided by the sum of total biomass across
all pixels. Species presences are calculated as the number of pixels where a
given species is present, and species dominance is calculated as the number of
pixels where a species has the highest relative biomass in a given pixel. Pixels
where two or more species share the highest biomass value are classified as
‘mixed forest’, and pixels without any biomass are classified as ‘no veg.’.
Finally, (<span class="math inline">\(\Delta\)</span>B) is calculated per species as the final biomass (e.g., year
2011) minus the initial biomass (e.g., year 2001), either at the pixel- or
landscape-level. All calculations were done per replicate.</p>
</div>
<div id="validation-approaches" class="section level3">
<h3>Validation approaches</h3>
<div id="visual-validation" class="section level4">
<h4>Visual validation</h4>
<p>The module plots the above metrics as barplots showing landscape-level values
(averaged across replicates for the simulated data) or boxplots showing
pixel-level values. Plotting can be live and/or in the form of exported images
(or both turned off completely).</p>
</div>
<div id="mean-absolute-deviation" class="section level4">
<h4>Mean absolute deviation</h4>
<p>Mean absolute deviance (MAD) values are calculated on landscape- and pixel-level
species relative abundances and <span class="math inline">\(\Delta\)</span>B, and landscape-level species presences
and dominance, per replicate and year (except for <span class="math inline">\(\Delta\)</span>B, which is integrated
across years). Output tables with MAD values are exported as <code>landscapeMAD</code> and
<code>pixelMAD</code>, and the module also produces visual inspection of these values as
dot-and-whisker plots.</p>
</div>
<div id="sum-of-negative-log-likelihood-snll" class="section level4">
<h4>Sum of negative log-likelihood (SNLL)</h4>
<p>To provide a measure of overall goodness of fit of the simulation model, given a
given set of starting conditions and simulation mechanisms (i.e., the
combination of inputs to <em>Biomass_core</em> but also other modules that may be
associated in affecting vegetation dynamics), <em>Biomass_validationKNN</em> estimates
sum of negative log-likelihoods (SNLL) of simulated species biomasses, <span class="math inline">\(\Delta\)</span>B
(both at the landscape and pixel-level), and species presences (at the
landscape-level), with respect to their observed counterparts. More precisely,
let <span class="math inline">\(\ell\)</span> be the log-likelihood function denoting the probability of observing
<span class="math inline">\(x\)</span> of <span class="math inline">\(X\)</span> (a random variable following a continuous probability distribution
<span class="math inline">\(f(x)\)</span>), given a parameter <span class="math inline">\(\theta\)</span>:</p>
<span class="math display">\[\begin{equation}
  \ell(\theta \mid x) = f(x)
  (\#eq:loglik)
\end{equation}\]</span>
<p>In our case, <span class="math inline">\(\theta\)</span> is equivalent to the model’s starting conditions and
structure, <span class="math inline">\(X\)</span> is the observed data with <span class="math inline">\(x\)</span> being the simulated values, and
<span class="math inline">\(f(x)\)</span> the continuous probability distribution of <span class="math inline">\(X\)</span>. For each variable that we
wanted to evaluate and for each simulation replicate, Equation @ref(eq:loglik)
is applied to calculate the SNLL estimated for each value of <span class="math inline">\(x\)</span> at the pixel or
landscape-level, <span class="math inline">\(i\)</span>:</p>
<span class="math display">\[\begin{equation}
  -\sum_{i = 1}^{N} \ell(\theta \mid x_{i})
  (\#eq:negsumloglik)
\end{equation}\]</span>
<p>where <span class="math inline">\(N\)</span> is equal to total number of pixels. At the landscape scale <span class="math inline">\(N = 1\)</span>.</p>
<p>For species biomass and species presences, we draw the probability of observing
<span class="math inline">\(x_{i}\)</span> (a vector of species biomasses/presences in pixel/landscape <span class="math inline">\(i\)</span>) from a
multinomial density distribution
(<span class="math inline">\(f(x_{i}) = {\sf Multi}(n_{i}, \mathrm{p}_{i})\)</span>), where
<span class="math inline">\(n_{i} = \sum_{j = 1}^{K} X_{i,j}\)</span> (<span class="math inline">\(X\)</span> being the observed values of biomass of
<span class="math inline">\(j = 1, ..., K\)</span> species in a pixel/landscape <span class="math inline">\(i\)</span>) and <span class="math inline">\(\mathrm{p_{i}}\)</span> is the
vector of simulated values <span class="math inline">\(x_{i,j}\)</span>.</p>
<p><strong>The computation of SNLL for</strong> <span class="math inline">\(\Delta\)</span>B is still under development. We have
implemented the following, approach: For <span class="math inline">\(\Delta\)</span>B, we draw the probability of
observing <span class="math inline">\(x_{i,j}\)</span> (the simulated <span class="math inline">\(\Delta\)</span>B of <span class="math inline">\(j = 1, ..., K\)</span> species in a
pixel/landscape <span class="math inline">\(i\)</span>) from a multivariate Gaussian distribution,
<span class="math inline">\(f(x_{i}) = \mathcal {N}(\mu_{i}, \mathrm{M}_{i})\)</span>, where <span class="math inline">\(\mu_{i}\)</span> is the
vector of observed mean <span class="math inline">\(\Delta\)</span>B for each species <span class="math inline">\(j = 1, ..., K\)</span>, and
<span class="math inline">\(\mathrm{M}\)</span> is the observed <span class="math inline">\(K * K\)</span> variance-covariance matrix of species
<span class="math inline">\(\Delta\)</span>B. Unfortunately this is presenting problems, due to <span class="math inline">\(\mathrm{M}\)</span> not
being strictly positive definite.</p>
<p>After calculating SNLL across pixels (or for a landscape), values are averaged
across replicates for an overall model estimate and exported in the
<code>logLikelihood</code> table.</p>
<p>We refer to the Wikipedia pages on the <a href="https://en.wikipedia.org/wiki/Multinomial_distribution">multinomial
distribution</a> and on the
<a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Density_function">multivariate Gaussian
distribution</a>
for a good summary of these two distributions and their use in SNLL estimation.</p>
</div>
</div>
<div id="initialization-inputs-and-parameters-2" class="section level3">
<h3>Initialization, inputs and parameters</h3>
<p><em>Biomass_validationKNN</em> initializes itself and prepares all inputs provided that
it has access to outputs of simulations from <em>Biomass_core</em>, and internet access
to retrieve the observed kNN datasets used for validation. Future users should
run <em>Biomass_validationKNN</em> with defaults and inspect what the objects are like
before supplying their own data, or alternative data URLs. Alternatively, users
may develop their own validation modules using <em>Biomass_validationKNN</em> as a
template.</p>
<div id="input-objects-2" class="section level4">
<h4>Input objects</h4>
<p><em>Biomass_validationKNN</em> requires the following input data layers: land-cover
change (change type and year), fire perimeters, % species cover, stand age and
stand biomass. By default, the module will take these from National Forest
Inventory kNN layers for years 2001 and 2011. We recommend that the user
supplies layers used to initialise the simulation as the starting input layers
(2001 if that is the starting point) to guarantee that they match. Table
@ref(tab:moduleInputs2-Biomass-validationKNN) shows the full list of input
objects used by the module.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleInputs2-Biomass-validationKNN)List of (ref:Biomass-validationKNN) input objects and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
objectName
</th>
<th style="text-align:left;">
objectClass
</th>
<th style="text-align:left;">
desc
</th>
<th style="text-align:left;">
sourceURL
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
allCohortData
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
All <code>cohortData</code> tables saved during the simulation, particularly for the validation years. If not supplied, the module will attempt to retrieve them using the ‘simulationOutputs’ table
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
biomassMap
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
total biomass raster layer in study area (in g/m^2), filtered for pixels covered by <code>cohortData</code>. Only used to calculate total no. of pixels being simulated If not supplied, will default to <code>rawBiomassMapStart</code>
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
firePerimeters
</td>
<td style="text-align:left;">
sf
</td>
<td style="text-align:left;">
A map of fire perimeters in the study area that can be used to exclude pixels that have been burnt during the validation period. If burnt pixels are not to be excluded Provide an empty <code>sf</code> object with the same properties as the default. Defaults to the latest Canadian Wildland Fire Information System National Burned Area Composite, subset to fires occuring up to last validation year (inclusively). Source URL determined by <code>fireURL</code>
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
fireURL
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
A URL to a fire database, such as the Canadian National Fire Database, that is a zipped shapefile with fire polygons, an attribute (i.e., a column) named ‘Year’. If supplied (omitted with NULL or NA), this will be used to ‘update’ age pixels on <code>standAgeMap</code> with ‘time since fire’ as derived from this fire polygons map
</td>
<td style="text-align:left;">
<a href="https://cwfis.cfs.nrcan.gc.ca/downloads/nfdb/fire_poly/current_version/NFDB_poly.zip" class="uri">https://cwfis.cfs.nrcan.gc.ca/downloads/nfdb/fire_poly/current_version/NFDB_poly.zip</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupMapStk
</td>
<td style="text-align:left;">
RasterStack
</td>
<td style="text-align:left;">
A stack of <code>pixelGroupMap</code>s saved during the simulation, particularly for the validation years. If not supplied, the module will attempt to make it using the ‘simulationOutputs’ table
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
rawBiomassMapStart
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
observed total biomass raster layer in study area at the first year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived total aboveground biomass map from 2001 (in ton/ha). See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata.
</td>
<td style="text-align:left;">
<a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
rawBiomassMapEnd
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
observed total biomass raster layer in study area at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived total aboveground biomass map from 2011 (in ton/ha) See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a>
</td>
<td style="text-align:left;">
<a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Biomass_TotalLiveAboveGround_v1.tif</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
rasterToMatch
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
A raster of the <code>studyArea</code> in the same resolution and projection as <code>rawBiomassMapStart</code>. This is the scale used for all outputs for use in the simulation.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
rstLCChange
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
A mask-type map of land cover changes in the study area that can be used to exclude pixels that have been disturbed during the validation period. If disturbed pixels are not to be excluded Provide an empty sf object with the same properties as the default. Defaults to Canada’s forest change map between 1985-2011 (CFS), filtered for years 2001-2011 (inclusively) and all disturbances collapsed (map only has values of 1 and NA). See <code>P(sim)$LCChangeYr</code> parameter to change the period of disturbances, and <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.
</td>
<td style="text-align:left;">
<a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_type_1985_2011.zip" class="uri">https://opendata.nfis.org/downloads/forest_change/C2C_change_type_1985_2011.zip</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
rstLCChangeYr
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
An OPTIONAL map of land cover change years in the study area used to exclude pixels that have been disturbed during the validation period. It defaults to Canada’s forest change year national map between 1985-2011 (CFS). If <code>P(sim)$LCChangeYr</code> is not <code>NULL</code>, this layer is used to filted disturbed pixels that fall within the years specified by <code>P(sim)$LCChangeYr</code>. If <code>P(sim)$LCChangeYr</code> is <code>NULL</code> this layer is not used. See <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.
</td>
<td style="text-align:left;">
<a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_year_1985_2011.zip" class="uri">https://opendata.nfis.org/downloads/forest_change/C2C_change_year_1985_2011.zip</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
simulationOutputs
</td>
<td style="text-align:left;">
data.table
</td>
<td style="text-align:left;">
An OPTIONAL table listing simulation outputs (as passed to <code>spades()</code>, or <code>experiment) that will be used to make</code>allCohortData<code>,</code>pixelGroupMapStk<code>, if these are not provided. &lt;/td&gt;    &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; speciesLayersStart &lt;/td&gt;    &lt;td style="text-align:left;"&gt; RasterStack &lt;/td&gt;    &lt;td style="text-align:left;"&gt; observed cover percentage raster layers by species in Canada species map, at the first year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2001, using a cover threshold of 10% - see https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990 for metadata &lt;/td&gt;    &lt;td style="text-align:left;"&gt; http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/ &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; speciesLayersEnd &lt;/td&gt;    &lt;td style="text-align:left;"&gt; RasterStack &lt;/td&gt;    &lt;td style="text-align:left;"&gt; observed percent cover raster layers by species in Canada used for validation at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived species cover maps from 2011 - see https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990 for metadata &lt;/td&gt;    &lt;td style="text-align:left;"&gt; http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/ &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; sppColorVect &lt;/td&gt;    &lt;td style="text-align:left;"&gt; character &lt;/td&gt;    &lt;td style="text-align:left;"&gt; A named vector of colors to use for plotting. The names must be in sim$sppEquiv[[sim$sppEquivCol]], and should also contain a color for 'Mixed' &lt;/td&gt;    &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;   &lt;/tr&gt;   &lt;tr&gt;    &lt;td style="text-align:left;"&gt; sppEquiv &lt;/td&gt;    &lt;td style="text-align:left;"&gt; data.table &lt;/td&gt;    &lt;td style="text-align:left;"&gt; table of species equivalencies. See</code>LandR::sppEquivalencies_CA`.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
standAgeMapStart
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
observed stand age map in study area, at the first year of the validation period Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived biomass map from 2001 - see <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a> for metadata
</td>
<td style="text-align:left;">
<a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Stand_Age_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2001-attributes_attributs-2001/NFI_MODIS250m_2001_kNN_Structure_Stand_Age_v1.tif</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
standAgeMapEnd
</td>
<td style="text-align:left;">
RasterLayer
</td>
<td style="text-align:left;">
observed stand age raster layer in study area, at the last year of the validation period. Defaults to the Canadian Forestry Service, National Forest Inventory, kNN-derived stand age map from 2011. See <a href="https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990" class="uri">https://open.canada.ca/data/en/dataset/ec9e2659-1c29-4ddb-87a2-6aced147a990</a>
</td>
<td style="text-align:left;">
<a href="http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Stand_Age_v1.tif" class="uri">http://ftp.maps.canada.ca/pub/nrcan_rncan/Forests_Foret/canada-forests-attributes_attributs-forests-canada/2011-attributes_attributs-2011/NFI_MODIS250m_2011_kNN_Structure_Stand_Age_v1.tif</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
studyArea
</td>
<td style="text-align:left;">
SpatialPolygonsDataFrame
</td>
<td style="text-align:left;">
Polygon to use as the study area. Must be provided by the user
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Of the inputs in Table @ref(tab:moduleInputs2-Biomass-validationKNN), the
following are particularly important and deserve special attention:</p>
<ul>
<li><p><strong>Spatial layers</strong></p>
<ul>
<li><p><code>biomassMap</code> – a map of simulated stand biomass (in <span class="math inline">\(g/m^2\)</span> ) filtered
for the pixels where cohort dynamics were simulated. This corresponds to
the <code>sim$biomassMap</code> object produced by <em>Biomass_borealDataPrep</em> or to
the <code>sim$simulatedBiomassMap</code> produced by <em>Biomass_core</em>.</p></li>
<li><p><code>firePerimeters</code> – a fire perimeters polygon map that should be used to
exclude recently burned pixels from the analysis. If this is not desired
the user needs to provide an empty <code>sf</code> object (e.g.,
<code>sf::st_polygon()</code>) .</p></li>
<li><p><code>rawBiomassMapStart</code> – raw biomass data used to initialize and
parametrize <code>Biomass_core</code>. By default, the module uses the stand
biomass map from KNN for the year 2001. The user must make sure this
appropriate for their use case, or else supply the correct raster layer.</p></li>
<li><p><code>rawBiomassMapEnd</code> – raw biomass data used to validate the model after
several simualtion years. By default, the module uses the stand biomass
map from KNN for the year 2011, which is compared with the 10th year of
a simulation initialised using the KNN 2001 data. The user must make
sure this appropriate for their use case, or else supply the correct
raster layer.</p></li>
<li><p><code>rstLCChange</code> – a binary raster layer with disturbed pixels that should
be removed from the analyses. Can be combined with <code>rstLCChangeYr</code> to
filter pixels disturbed in a given time period defined by
<code>P(sim)$LCChangeYr</code>. Defaults to <a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_type_1985_2011.zip">Canada’s forest change national map
between 1985-2011
(CFS)</a>.</p></li>
<li><p><code>rstLCChangeYr</code> – a raster layer with year of disturbance. This is an
optional layer that can be combined with <code>rstLCChange</code> and
<code>P(sim)$LCChangeYr</code> to filter disturbed pixels by year of disturbance.
Not used by default. Defaults to <a href="https://opendata.nfis.org/downloads/forest_change/C2C_change_year_1985_2011.zip">Canada’s forest change year national
map between 1985-2011
(CFS)</a>.</p></li>
<li><p><code>speciesLayersStart</code> – same as <code>rawBiomassMapStart</code>, but with respect
to species % cover data.</p></li>
<li><p><code>speciesLayersEnd</code> – same as <code>rawBiomassMapEnd</code>, but with respect to
species % cover data.</p></li>
<li><p><code>studyArea</code> – shapefile. A <code>SpatialPolygonsDataFrame</code> with a single
polygon determining the where the simulation will take place. This is
the only input object that <strong>must be supplied by the user</strong>.</p></li>
</ul></li>
<li><p><strong>Simulation-related objects</strong></p>
<ul>
<li><p><code>allCohortData</code> – OPTIONAL. A <code>data.table</code> containing all <code>cohortData</code>
objects relevant for the validation (e.g., as many <code>cohortData</code> objects
as simulation replicates times 2, for the beginning and end year). If
not supplied, <em>Biomass_validationKNN</em> attempts to produce this object
using the <code>cohortData</code> object file listed in <code>simulationOutputs</code> .
Hence, the user must either supply <strong>both</strong> <code>allCohortData</code> and
<code>pixelGroupMapStk</code> <strong>or</strong> <code>simulationOutputs.</code></p></li>
<li><p><code>pixelGroupMapStk</code> – OPTIONAL. As <code>allCohortData</code> but with respect to
<code>pixelGroupMap</code> objects.</p></li>
<li><p><code>simulationOutputs</code> – OPTIONAL. A <code>data.frame</code> that has the same
structure as the <code>data.frame</code>’s specifying outputs to be saved in
<code>spades(…, outputs = data.frame(…))</code>. We advise passing the same
<code>data.frame</code> that was supplied to <code>spades</code> during the simulation call,
but filtered by the relevant <code>cohortData</code> and <code>pixelGroupMap</code> objects
and, potentially, with file paths corrected to match the current working
directory (see <a href="#usage-example-2">Usage example</a>). Only used if <code>allCohortData</code> and
<code>pixelGroupMapStk</code> are not supplied.</p></li>
<li><p><code>pixelGroupMap</code> – a raster layer with <em>pixelGroup</em> IDs per pixel.
Pixels are always grouped based on identical <em>ecoregionGroup</em>,
<em>speciesCode</em>, <em>age</em> and <em>B</em> composition, even if the user supplies
other initial groupings (e.g., this is possible in the
<em>Biomass_borealDataPrep</em> data module).</p></li>
</ul></li>
</ul>
</div>
<div id="parameters-2" class="section level4">
<h4>Parameters</h4>
<p>Table @ref(tab:moduleParams2-Biomass-validationKNN) lists all parameters used
in <em>Biomass_validationKNN</em> and their detailed information.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:moduleParams2-Biomass-validationKNN)List of (ref:Biomass-validationKNN) parameters and their description.
</caption>
<thead>
<tr>
<th style="text-align:left;">
paramName
</th>
<th style="text-align:left;">
paramClass
</th>
<th style="text-align:left;">
default
</th>
<th style="text-align:left;">
min
</th>
<th style="text-align:left;">
max
</th>
<th style="text-align:left;">
paramDesc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
coverThresh
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The minimum % cover a species needs to have (per pixel) in the study area to be considered present. Should be the same as the one used to obtain the species cover layers for simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
deciduousCoverDiscount
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
0.8418911
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This was estimated with data from NWT on March 18, 2020 and may or may not be universal. Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
LCChangeYr
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1900
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
OPTIONAL. An integer or vector of integers of the validation period years, defining which years of land-cover changes (i.e. disturbances) should be excluded. <code>NULL</code> by default, which presumes no subsetting based on years is done internally (either the user supplies a pre-filtered <code>rstLCChange</code>, or no filtering is desired). If not <code>NULL</code> <code>rstLCChangeYr</code> is used to filter disturbed pixels within the specified years. See <a href="https://opendata.nfis.org/mapserver/nfis-change_eng.html" class="uri">https://opendata.nfis.org/mapserver/nfis-change_eng.html</a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;">
minCoverThreshold
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
Cover that is equal to or below this number will be omitted from the dataset Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
obsDeltaAgeB
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
When TRUE, the observed changes in biomass and age (deltaB, deltaAge) between the two validation years will be plotted as maps and scatterplots
</td>
</tr>
<tr>
<td style="text-align:left;">
pixelGroupBiomassClass
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
When assigning <code>pixelGroup</code> membership, this defines the resolution of biomass that will be considered ‘the same pixelGroup’, e.g., if it is 100, then 5160 and 5240 will be the same Should be the same as the one used when preparing <code>cohortData</code> in the simulation set up.
</td>
</tr>
<tr>
<td style="text-align:left;">
sppEquivCol
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
Boreal
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The column in <code>sim$sppEquiv</code> data.table to use as a naming convention
</td>
</tr>
<tr>
<td style="text-align:left;">
validationReps
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
1, 2, 3,….
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The simulation repetitions for the validation. Defaults to 1:10. Set to NA if not using repetitions (i.e. only one run)
</td>
</tr>
<tr>
<td style="text-align:left;">
validationYears
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
2001, 2011
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
The simulation years for the validation. Defaults to 2001 and 2011. Must select two years
</td>
</tr>
<tr>
<td style="text-align:left;">
.plotInitialTime
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
If NA plotting is off completely (this includes saving).
</td>
</tr>
<tr>
<td style="text-align:left;">
.plots
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
object, png
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Passed to <code>types</code> in Plots (see ?Plots). There are a few plots that are made within this module, if set. Note that plots (or their data) are saved in file.path(outputPath(sim), ‘figures’). If <code>NA</code>, plotting is off completely (this includes plot saving).
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInitialTime
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time at which the first save event should occur
</td>
</tr>
<tr>
<td style="text-align:left;">
.saveInterval
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
This describes the simulation time interval between save events
</td>
</tr>
<tr>
<td style="text-align:left;">
.studyAreaName
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Human-readable name for the study area used. If <code>NA</code>, a hash of <code>studyArea</code> will be used.
</td>
</tr>
<tr>
<td style="text-align:left;">
.useCache
</td>
<td style="text-align:left;">
logical
</td>
<td style="text-align:left;">
init
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Controls cache; caches the init event by default
</td>
</tr>
</tbody>
</table>
<p>Of the parameters listed in Table
@ref(tab:moduleParams2-Biomass-validationKNN), the following are particularly
important:</p>
<ul>
<li><p><code>LCChangeYr</code> – integer. Optional parameter defining the years of
disturbance that should be filtered out of the analysis using the
<code>rstLCChangeYr</code> layer. This parameter is set to <code>NULL</code> by default, meaning
that <code>rstLCChangeYr</code> will not be used.</p></li>
<li><p><code>sppEquivCol</code> – character. the column name in <code>specieEquivalency</code>
data.table that defines the naming convention to use throughout the
simulation. The user needs to make sure the is</p></li>
<li><p><code>validationReps</code> – integer. which simulation replicates should be used for
the validation.</p></li>
<li><p><code>validationYears</code> – integer. What simulation years should be used for the
validation - the year number needs to match the observed data year. For
instance, if the first observed data year is 2001, that must be the first
simulation year.</p></li>
</ul>
</div>
</div>
<div id="simulation-flow-2" class="section level3">
<h3>Simulation flow</h3>
<p>The general flow of <em>Biomass_validationKNN</em> processes is:</p>
<ol style="list-style-type: decimal">
<li><p>Preparation of all necessary objects, namely obtaining the observed data
layers from online repositories (or if available stored local copies) and
the compiling simulated data if the user has not done so previously (see
<a href="#input-objects-2">Input objects</a>).</p></li>
<li><p>Calculation of summary variables for validation, namely:</p>
<ul>
<li><p>relative biomass per species per pixel and across the landscape (per
year and per replicate)</p></li>
<li><p>changes in species biomass per pixel and across the landscape (per
replicate), with respect to the first year.</p></li>
<li><p>species dominance across the landscape</p></li>
<li><p>species presences across the landscape</p></li>
</ul></li>
<li><p>Calculation of validation statistics, namely mean absolute deviations (MAD)
and sum of negative log-likelihoods (SNLL).</p></li>
<li><p>Assessment of the relationship between observed <span class="math inline">\(\Delta\)</span>B and observed
<span class="math inline">\(\Delta\)</span>Age – this is an optional visual diagnostic of the observed data
that produces scatterplots of <span class="math inline">\(\Delta\)</span>B ~ <span class="math inline">\(\Delta\)</span>Age of three types:</p>
<ul>
<li><p>With raw observed values of <span class="math inline">\(\Delta\)</span>B and <span class="math inline">\(\Delta\)</span>Age</p></li>
<li><p>With <span class="math inline">\(\Delta\)</span>B and <span class="math inline">\(\Delta\)</span>Age calculated on observed data <em>after</em>
pre-processing (i.e., the data clean-steps done in
<code>Biomass_borealDataPrep</code>, which are also done to the observed data
before validation)</p></li>
<li><p>With the data shown in 2) above, but filtered by pixels where there was
only a stand age increment corresponding to the number of years of
between the two validation time points. This is not necessarily a
<em>correct</em> filter, as stands may have suffered an age reduction due to
the loss of old cohorts from background mortality (i.e., not coming from
disturbances. However, if using the default input datasets, it is
unlikely that this is a widespread phenomenon in only 10 years. We
remind the user that disturbed pixels should be removed from the
analyses when validating succession dynamics in the absence of
disturbance - the default option.</p></li>
</ul></li>
<li><p>Plots:</p>
<ul>
<li><p>Barplots of landscape-wide and pixel-level comparisons between observed
and simulated data, with respect to relative biomass, dominance and
presences.</p></li>
<li><p>Boxplots of biomass changes (<span class="math inline">\(\Delta\)</span>B) in observed and simulated data,
with respect to the first year.</p></li>
<li><p>Maps of biomass and age changes (<span class="math inline">\(\Delta\)</span>B, <span class="math inline">\(\Delta\)</span>Age) with respect to
the first year, in observed and simulated data.</p></li>
</ul></li>
</ol>
<p>All module default outputs are in the form of plots, but the user can chose to
save any objects (see Table @ref(tab:moduleOutputs-Biomass-validationKNN)).</p>
</div>
</div>
<div id="usage-example-2" class="section level2">
<h2>Usage example</h2>
<div id="load-spades-and-other-packages.-1" class="section level3">
<h3>Load <code>SpaDES</code> and other packages.</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES.install)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES.experiment)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span></code></pre></div>
</div>
<div id="get-the-modules" class="section level3">
<h3>Get the modules</h3>
<p>Because <em>Biomass_validationKNN</em> is meant to validate simulation outputs against
observed data, we need to first run a simulation of forest dynamics with
<em>Biomass_core</em>. To do that we get both modules’ code from the PredictiveEcology
GitHub repository. Notice that we are placing all module code, inputs and
outputs in temporary directories.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tempDir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>spadesModulesDirectory <span class="ot">&lt;-</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;modules&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">inputPath =</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;inputs&quot;</span>), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cachePath =</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;cache&quot;</span>), </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">modulePath =</span> spadesModulesDirectory, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">outputPath =</span> <span class="fu">file.path</span>(tempDir, <span class="st">&quot;outputs&quot;</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getModule</span>(<span class="st">&quot;PredictiveEcology/Biomass_core&quot;</span>, <span class="at">modulePath =</span> spadesModulesDirectory, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">getModule</span>(<span class="st">&quot;PredictiveEcology/Biomass_validationKNN&quot;</span>, <span class="at">modulePath =</span> spadesModulesDirectory, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">## by default the repository branch name is appended to the module folder name.</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="do">## so we change the folder name to remove the &quot;-master&quot; suffix.</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="fu">c</span>(<span class="fu">file.path</span>(spadesModulesDirectory, <span class="st">&quot;Biomass_core-master&quot;</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">file.path</span>(spadesModulesDirectory, <span class="st">&quot;Biomass_validationKNN-master&quot;</span>)),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="fu">file.path</span>(spadesModulesDirectory, <span class="st">&quot;Biomass_core&quot;</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">file.path</span>(spadesModulesDirectory, <span class="st">&quot;Biomass_validationKNN&quot;</span>)))</span></code></pre></div>
</div>
<div id="setup-simulation-2" class="section level3">
<h3>Setup simulation</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">2001</span>, <span class="at">end =</span> <span class="dv">2011</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>studyArea <span class="ot">&lt;-</span> <span class="fu">Cache</span>(randomStudyArea, <span class="at">size =</span> <span class="fl">1e7</span>) <span class="co"># cache this so it creates a random one only once on a machine</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the species you want to work with -- using the naming convention in &quot;Boreal&quot; column of LandR::sppEquivalencies_CA</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>speciesNameConvention <span class="ot">&lt;-</span> <span class="st">&quot;Boreal&quot;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>speciesToUse <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Pice_Gla&quot;</span>, <span class="st">&quot;Popu_Tre&quot;</span>, <span class="st">&quot;Pinu_Con&quot;</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>sppEquiv <span class="ot">&lt;-</span> LandR<span class="sc">::</span>sppEquivalencies_CA[<span class="fu">get</span>(speciesNameConvention) <span class="sc">%in%</span> speciesToUse]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign a colour convention for graphics for each species</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>sppColorVect <span class="ot">&lt;-</span> LandR<span class="sc">::</span><span class="fu">sppColors</span>(sppEquiv, speciesNameConvention,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newVals =</span> <span class="st">&quot;Mixed&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Usage example</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="st">&quot;Biomass_core&quot;</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>objects <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">studyArea =</span> studyArea, <span class="at">sppEquiv =</span> sppEquiv, <span class="at">sppColorVect =</span> sppColorVect)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>successionTimestep <span class="ot">&lt;-</span> 20L</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="do">## keep default values for most parameters </span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="do">## (ommitted from this list)</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Biomass_core =</span> <span class="fu">list</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sppEquivCol&quot;</span> <span class="ot">=</span> speciesNameConvention</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;successionTimestep&quot;</span> <span class="ot">=</span> successionTimestep</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plotInitialTime&quot;</span> <span class="ot">=</span> times<span class="sc">$</span>start</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plotInterval&quot;</span> <span class="ot">=</span> 1L</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plots&quot;</span> <span class="ot">=</span> <span class="st">&quot;png&quot;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.saveInitialTime&quot;</span> <span class="ot">=</span> times<span class="sc">$</span>start</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.useCache&quot;</span> <span class="ot">=</span> <span class="st">&quot;init&quot;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.useParallel&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>outputs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">expand.grid</span>(<span class="at">objectName =</span> <span class="st">&quot;cohortData&quot;</span>,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">saveTime =</span> <span class="fu">unique</span>(<span class="fu">seq</span>(times<span class="sc">$</span>start, times<span class="sc">$</span>end, <span class="at">by =</span> <span class="dv">1</span>)),</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">eventPriority =</span> <span class="dv">1</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>outputs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outputs, <span class="fu">data.frame</span>(<span class="at">objectName =</span> <span class="st">&quot;pixelGroupMap&quot;</span>,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">saveTime =</span> <span class="fu">unique</span>(<span class="fu">seq</span>(times<span class="sc">$</span>start, times<span class="sc">$</span>end, <span class="at">by =</span> <span class="dv">1</span>)),</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">eventPriority =</span> <span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="run-simulation-1" class="section level3">
<h3>Run simulation</h3>
<p>Here we run a simulation with three replicates using the <code>experiment2</code> function
of the <code>SpaDES.experiment</code> R package <span class="citation">(<a href="#ref-McIntireChubaty2021" role="doc-biblioref">McIntire &amp; Chubaty 2021</a>)</span>, which builds a
folder structure where simulation outputs are conveniently organised.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graphics.off</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mySimInit <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> times,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">params =</span> parameters, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">modules =</span> modules, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">objects =</span> objects, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">paths =</span> paths,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">outputs =</span> outputs)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(sequential)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>mySimExperiment <span class="ot">&lt;-</span> <span class="fu">experiment2</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sim1 =</span> mySimInit,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">clearSimEnv =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">3</span>)</span></code></pre></div>
</div>
<div id="validate-simulation-outputs-with-biomass_validationknn" class="section level3">
<h3>Validate simulation outputs with <em>Biomass_validationKNN</em></h3>
<p>Note that because we ran <em>Biomass_core</em> by itself using theoretical input data,
we can expect the validation to reveal that the module didn’t do a great job at
reproducing observed patterns.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>simulationOutputs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mySimExperiment, <span class="at">FUN =</span> <span class="cf">function</span>(x, localSimPaths) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  oldPath <span class="ot">&lt;-</span> <span class="fu">dirname</span>(<span class="fu">outputPath</span>(x)) <span class="do">## exclude sim*_rep* folder</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  DT <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">outputs</span>(x))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  DT[, file <span class="sc">:</span><span class="er">=</span> <span class="fu">sub</span>(oldPath, localSimPaths<span class="sc">$</span>outputPath, file)]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  DT</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>}, <span class="at">localSimPaths =</span> <span class="fu">as.list</span>(<span class="fu">normPath</span>(paths)))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>simulationOutputs <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(simulationOutputs)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>validationPaths <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">normPath</span>(paths))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>validationPaths<span class="sc">$</span>outputPath <span class="ot">&lt;-</span> <span class="fu">file.path</span>(validationPaths<span class="sc">$</span>outputPath, <span class="st">&quot;validation&quot;</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>validationTimes <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">1</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>validationParams <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Biomass_validationKNN =</span> <span class="fu">list</span>(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sppEquivCol&quot;</span> <span class="ot">=</span> <span class="fu">params</span>(mySimInit)<span class="sc">$</span>Biomass_core<span class="sc">$</span>sppEquivCol</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;validationReps&quot;</span> <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)  <span class="do">## or length of simLists</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;validationYears&quot;</span> <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">2001</span>, <span class="dv">2011</span>))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;.plots&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;png&quot;</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="do">## make an empty fire polygon object to bypass removing fire-disturbed pixels</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>noFires <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_polygon</span>()</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>validationObjects <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;biomassMap&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>biomassMap</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;firePerimeters&quot;</span> <span class="ot">=</span> noFires</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;rasterToMatch&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>rasterToMatch</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;rawBiomassMapStart&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>biomassMap</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;simulationOutputs&quot;</span> <span class="ot">=</span> simulationOutputs</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;speciesLayersStart&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>speciesLayers</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;sppColorVect&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>sppColorVect</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;sppEquiv&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>sppEquiv</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;studyArea&quot;</span> <span class="ot">=</span> mySimExperiment<span class="sc">$</span>sim1_rep1<span class="sc">$</span>studyArea</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>mySimValidation <span class="ot">&lt;-</span> <span class="fu">simInitAndSpades</span>(<span class="at">times =</span> validationTimes</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                                    , <span class="at">params =</span> validationParams</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                                    , <span class="at">modules =</span> <span class="st">&quot;Biomass_validationKNN&quot;</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                                    , <span class="at">objects =</span> validationObjects</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                                    , <span class="at">paths =</span> validationPaths</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                                    , <span class="at">.studyAreaName =</span> SAname)</span></code></pre></div>
<p>Here are some of the output figures automatically produced by
<em>Biomass_validationKNN</em></p>
<div class="figure">
<img src="figures/LandscapeComparisons_PresAbs.png" alt="(ref:Biomass-validationKNN) automatically generates plots showing a visual comparison between simulated and observed species presences (right) across the landscape, and relative species biomass per pixel (left)." width="50%" /><img src="figures/PixelComparisons_relB.png" alt="(ref:Biomass-validationKNN) automatically generates plots showing a visual comparison between simulated and observed species presences (right) across the landscape, and relative species biomass per pixel (left)." width="50%" />
<p class="caption">
(#fig:fig-Biomass-validationKNNOutPlots)(ref:Biomass-validationKNN) automatically generates plots showing a visual comparison between simulated and observed species presences (right) across the landscape, and relative species biomass per pixel (left).
</p>
</div>
<div class="figure">
<img src="figures/landscapeMAD.png" alt="A plot of landscape-wide mean absolute deviations (MAD) from (top to bottom) observed mean relative abundance, no. of presences, no. of pixels where the species is dominant and $\Delta$B."  />
<p class="caption">
(#fig:fig-Biomass-validationKNNOutPlots2)A plot of landscape-wide mean absolute deviations (MAD) from (top to bottom) observed mean relative abundance, no. of presences, no. of pixels where the species is dominant and <span class="math inline">\(\Delta\)</span>B.
</p>
</div>
<div class="figure">
<img src="figures/observedDeltaBDeltaAge.png" alt="Diagnostic plot of observed changes in biomass and age $\Delta$B and $\Delta$Age, respectively)."  />
<p class="caption">
(#fig:fig-Biomass-validationKNNOutPlots3)Diagnostic plot of observed changes in biomass and age <span class="math inline">\(\Delta\)</span>B and <span class="math inline">\(\Delta\)</span>Age, respectively).
</p>
</div>
</div>
</div>
<div id="references-2" class="section level2">
<h2>References</h2>
<!--chapter:end:modules/Biomass_validationKNN/Biomass_validationKNN2.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-BeaudoinEtAl2017" class="csl-entry">
Beaudoin, A., Bernier, P.Y., Villemaire, P., Guindon, L. &amp; Guo, X.J. (2017). <a href="https://doi.org/10.23687/EC9E2659-1C29-4DDB-87A2-6ACED147A990">Species composition, forest properties and land cover types across canada’s forests at 250m resolution for 2001 and 2011</a>.
</div>
<div id="ref-ChubatyMcIntire2019" class="csl-entry">
Chubaty, A.M. &amp; McIntire, E.J.B. (2019). <em><a href="https://CRAN.R-project.org/package=SpaDES">SpaDES: Develop and run spatially explicit discrete event simulation models</a></em>.
</div>
<div id="ref-Cosco2011" class="csl-entry">
Cosco, J. (2011). <em>COMMON ATTRIBUTE SCHEMA (CAS) FOR FOREST INVENTORIES ACROSS CANADA</em>. BOREAL AVIAN MODELLING PROJECT, CANADIAN BEACONs PROJECT.
</div>
<div id="ref-McIntireChubaty2020" class="csl-entry">
McIntire, E.J.B. &amp; Chubaty, A.M. (2020). <em><a href="https://reproducible.predictiveecology.org, https://github.com/PredictiveEcology/reproducible">Reproducible: A set of tools that enhance reproducibility beyond package management</a></em>.
</div>
<div id="ref-McIntireChubaty2021" class="csl-entry">
McIntire, E.J.B. &amp; Chubaty, A.M. (2021). <em><a href="https://github.com/PredictiveEcology/SpaDES.experiment">SpaDES.experiment: Simulation experiments within the SpaDES ecosystem</a></em>.
</div>
<div id="ref-SchellerDomingo2011" class="csl-entry">
Scheller, R.M. &amp; Domingo, J.B. (2011). <em>LANDIS-II model v6.0 <span></span> user guide</em>.
</div>
<div id="ref-SchellerDomingo2012" class="csl-entry">
Scheller, R.M. &amp; Domingo, J.B. (2012). <em>LANDIS-II model v6.0 <span></span> conceptual description</em>.
</div>
<div id="ref-SchellerMiranda2015" class="csl-entry">
Scheller, R.M. &amp; Miranda, B.R. (2015). <em>LANDIS-II biomass succession v3.2 extension <span></span> user guide</em>.
</div>
<div id="ref-SchellerMladenoff2004" class="csl-entry">
Scheller, R.M. &amp; Mladenoff, D.J. (2004). <a href="https://doi.org/10.1016/j.ecolmodel.2004.01.022">A forest growth and biomass module for a landscape simulation model, LANDIS: design, validation, and application</a>. <em>Ecological Modelling</em>, 180, 211–229.
</div>
<div id="ref-StallEtAl2019" class="csl-entry">
Stall, S., Yarmey, L., Cutcher-Gershenfeld, J., Hanson, B., Lehnert, K., Nosek, B., <em>et al.</em> (2019). <a href="https://doi.org/10.1038/d41586-019-01720-7">Make scientific data FAIR</a>. <em>Nature</em>, 570, 27–29.
</div>
<div id="ref-Wickham2011" class="csl-entry">
Wickham, H. (2011). <a href="https://doi.org/10.32614/RJ-2011-002">testthat: Get Started with Testing</a>. <em>The R Journal</em>, 3, 5.
</div>
<div id="ref-YangEtAl2011" class="csl-entry">
Yang, J., He, H.S., Shifley, S.R., Thompson, F.R. &amp; Zhang, Y. (2011). <a href="https://doi.org/10.1016/j.ecolmodel.2011.04.032">An innovative computer design for modeling forest landscape change in very large spatial extents with fine resolutions</a>. <em>Ecological Modelling</em>, 222, 2623–2630.
</div>
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
