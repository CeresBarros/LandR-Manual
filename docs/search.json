[{"path":"index.html","id":"preface","chapter":"1 Preface","heading":"1 Preface","text":"LandR collection SpaDES modules (see Chubaty & McIntire 2019) aimed simulating forest dynamics across large spatial scales, taking account various disturbances affected (e.g., wildfire climate change), well interactions components forest systems, bird communities ungulates (via changes habitat species) carbon cycling.present manual “live” document, grow change according existing number LandR modules, well development. addition, sub-manuals may produced describing smaller collections LandR modules – e.g., LandR Biomass manual describes LandR modules essential simulation vegetation components forest succession, hence excluding fire disturbance modules.","code":""},{"path":"landr-biomass_core-module.html","id":"landr-biomass_core-module","chapter":"2 LandR Biomass_core Module","heading":"2 LandR Biomass_core Module","text":"(ref:Biomass-core) Biomass_core\n(ref:percent) %\ndocumentation work progress. Potential discrepancies omissions may exist time . find , contact us using link ^^","code":""},{"path":"landr-biomass_core-module.html","id":"authors","chapter":"2 LandR Biomass_core Module","heading":"2.0.0.1 Authors:","text":"Yong Luo yluo1@lakeheadu.ca [aut], Eliot J B McIntire eliot.mcintire@canada.ca [aut, cre], Jean Marchal jean.d.marchal@gmail.com [ctb], Alex M. Chubaty achubaty@-cast.ca [ctb], Ceres Barros cbarros@mail.ubc.ca [ctb] ","code":""},{"path":"landr-biomass_core-module.html","id":"module-overview","chapter":"2 LandR Biomass_core Module","heading":"2.1 Module Overview","text":"","code":""},{"path":"landr-biomass_core-module.html","id":"module-summary","chapter":"2 LandR Biomass_core Module","heading":"2.1.1 Module summary","text":"LandR Biomass_core (hereafter Biomass_core) core forest succession simulation module LandR ecosystem SpaDES modules (see Chubaty & McIntire 2019). simulates tree cohort ageing, growth, mortality competition light resources, well seed dispersal (Fig. 2.1), spatially explicit manner using yearly time steps. model based LANDIS-II Biomass Succession Extension v.3.2.1 [LBSE; Scheller & Miranda (2015b)], changes (see [Differences Biomass_core LBSE]). Nonetheless, essential functioning succession model still largely follows LANDIS-II counterpart, refer reader corresponding LANDIS-II BSE manual (Scheller & Miranda 2015b) detailed reading mechanisms implemented model.\nFigure 2.1: (ref:Biomass-core) simulates tree cohort growth, mortality, recruitment dispersal dynamics, function cohort ageing competition light (shading) space, well disturbances like fire (simulated using modules).\n","code":""},{"path":"landr-biomass_core-module.html","id":"module-inputs-and-parameters","chapter":"2 LandR Biomass_core Module","heading":"2.1.2 Module inputs and parameters","text":"Biomass_core capable running dummy datasets estimates parameters linked vegetation growth seed germination (maximum biomass per species, per pixel, probability seed germination – .e., species establishment probability due resprouting), also builds initializes forest communities (based biomass, age, species composition, land cover ecological zones like ecodistricts.Ideally, however, user supply realistic versions data essential initialization objects Biomass_core requires run.Table 2.1 shows full list input objects Biomass_core expects. , input must provided (.e., Biomass_core default ) studyArea. input objects parameters internal defaults (see Tables 2.4 2.5.\nTable 2.1: List (ref:Biomass-core) input objects description.\n, draw particular attention following inputs, crucial run Biomass_core realistic setting (see Input objects section manual detail):Spatial layers: ecoregionMap, studyAreaSpatial layers: ecoregionMap, studyAreaTrait parameter tables: ecoregion, minRelativeB, species, speciesEcoregion, sufficientLight, sppEquiv, sppColorVectTrait parameter tables: ecoregion, minRelativeB, species, speciesEcoregion, sufficientLight, sppEquiv, sppColorVectCohort-simulation related: cohortData, pixelGroupMapCohort-simulation related: cohortData, pixelGroupMapFor beginner user, suggest running Biomass_core without supplying inputs inspecting mentioned objects understand structure format. user can later either feed objects via simInit, make module makes provides necessary inputs Biomass_core (see e.g. Biomass_borealDataPrep)Besides mentioned inputs, Biomass_core uses several parameters, can changed user need (Table 2.2). Please see Parameters section manual list useful parameters.\nTable 2.2: List (ref:Biomass-core) parameters description.\n","code":""},{"path":"landr-biomass_core-module.html","id":"events","chapter":"2 LandR Biomass_core Module","heading":"2.1.3 Events","text":"Events scheduled follows:Module initiation (init event)Seed dispersal (every successionTimestep; Dispersal event)Mortality growth (mortalityAndGrowth event)Reclassification age cohorts (every successionTimestep; cohortAgeReclassification event)Summary tables regeneration (summaryRegen event), biomass, age, growth mortality (summaryBGM\\* event)Plots maps (plotMaps event) averages (plotAvgs plotSummaryBySpecies events)Save (save)","code":""},{"path":"landr-biomass_core-module.html","id":"module-outputs","chapter":"2 LandR Biomass_core Module","heading":"2.1.4 Module outputs","text":"module produces following outputs types. – Plotting – live /saved plot objects/images (depending .plots)– Saved biomass, mortality, leading vegetation raster layers – Whatever objects supplied outputs argument simInit, within simList object.simList objects changed Biomass_core (.e., definition module output) listed Table 2.3.\nTable 2.3: List (ref:Biomass-core) output objects description.\n","code":""},{"path":"landr-biomass_core-module.html","id":"links-to-other-modules","chapter":"2 LandR Biomass_core Module","heading":"2.1.5 Links to other modules","text":"Intended used landscape modules, LandMine, fireSense, Biomass_borealDataPrep, Biomass_regeneration possibly many others. can see potential module linkages within LandR ecosystem . Select Biomass_core drop-menu see linkages.","code":""},{"path":"landr-biomass_core-module.html","id":"getting-help","chapter":"2 LandR Biomass_core Module","heading":"2.1.6 Getting help","text":"https://github.com/PredictiveEcology/Biomass_core/issues","code":""},{"path":"landr-biomass_core-module.html","id":"module-manual","chapter":"2 LandR Biomass_core Module","heading":"2.2 Module manual","text":"","code":""},{"path":"landr-biomass_core-module.html","id":"introduction","chapter":"2 LandR Biomass_core Module","heading":"2.2.1 Introduction","text":"LandR Biomass_core (hereafter Biomass_core) forest landscape model based LANDIS-II Biomass Succession Extension v.3.2.1 model [LBSE; Scheller & Miranda (2015b)]. core forest succession model LandR ecosystem SpaDES modules. Similarly LBSE, Biomass_core simulates changes tree cohort aboveground biomass (g/m2.) calculating growth, mortality recruitment functions pixel species characteristics, competition disturbances (Fig. 2.1). Specifically, growth driven invariant (growthcurve) spatially varying species growth traits (maximum biomass, maxB, maximum annual net primary productivity, maxANPP), mortality depends invariant species traits (age, longevity mortalityshape). Disturbances (e.g., fire) can also cause cohort mortality, simulated separate modules (e.g., Biomass_regeneration simulates death cohorts immediately fire). parameters growthcurve mortalityshape directly influence shape species growth curves, determining fast grow soon age mortality starts respect longevity. Cohort recruitment determined available “space” (.e., pixel shade), invariant species traits (regeneration mode, age maturity, shade tolerance) spatially varying traits (species establishment probability, SEP). available “growing space” calculated species maxB minus occupied biomass (summed across cohorts species). “space”, cohort can establish one three recruitment modes: serotiny, resprouting germinating. Serotiny resprouting occur response fire simulated two separate, interchangeable modules, Biomass_regeneration Biomass_regenerationPM. Germination occurs seeds made available local sources (pixel), via seed dispersal. Seed dispersal can three modes: ‘dispersal’, ‘universal dispersal’ (interesting dummy case studies) ‘ward dispersal’ (Scheller & Miranda 2015b). ‘ward dispersal’ algorithm describes flexible kernel calculates probability species colonising neighbour pixel function distance source dispersal-related (invariant) species traits, used default. refer reader Scheller & Miranda (2015b), Scheller & Domingo (2011) Scheller & Domingo (2012) details respect mechanisms implemented module.","code":""},{"path":"landr-biomass_core-module.html","id":"differences-between-biomass_core-and-the-landis-ii-biomass-succession-extension-lbse","chapter":"2 LandR Biomass_core Module","heading":"2.2.2 Differences between Biomass_core and the LANDIS-II Biomass Succession Extension (LBSE)","text":"","code":""},{"path":"landr-biomass_core-module.html","id":"algorithm-changes","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.1 Algorithm changes","text":"Upon porting LBSE R, made six minor modifications original model’s algorithms better reflect ecological processes. result dramatic changes simulation outputs note changes might also implemented recent versions LBSE.First, year community (.e., ‘pixel group’ Biomass_core, see ), LBSE calculates competition index cohort sequentially (.e., one cohort time) updating growth mortality (.e., biomass gain loss, respectively) cohorts, calculation sequence following cohort age descending order, explicit order species. sorting growth mortality calculations oldest youngest cohorts LBSE aimed capturing size-asymmetric competition cohorts, assumption older cohorts priority growing space given greater height (Scheller pers. comm.). felt sequential, within-year growth, death recruitment may ecologically accurate, size-asymmetric competition accounted twice, calculation competition index already considers competitive advantage older cohorts [shown User’s Guide; Scheller & Miranda (2015b)]. Hence, Biomass_core growth, mortality competition index calculated time across cohorts species.Second, unknown species-level sorting mechanism contained within LBSE (changed depending species order input species list file), led different simulation results depending input species list file (e.g., Table 2.7 Fig. 2.3). calculation competition, growth mortality cohorts time also circumvented issue.Third, LBSE calculation total pixel biomass purpose calculating initial biomass new cohort included (previously calculated) biomass new cohorts succession time step = 1, time step > 1. reflect documentation User’s Guide, stated “Bsum [total pixel biomass] current total biomass site (including new cohorts)” (Scheller & Miranda 2015b), succession time step set 1. Additionally, together lack explicit ordering, generated different results terms biomass assigned new cohort (e.g. Table 2.8 Fig. 2.4). Biomass_core initial biomass new cohorts longer calculated sequentially (competition, growth mortality), thus biomass new cohorts never included calculation total pixel biomass.Fourth, LBSE, serotiny resprouting occur pixel following fire, serotiny taking precedence activated. understand provides advantage serotinous species, perhaps disadvantaged respect fast-growing resprouters. However, feel ecologically realistic serotinous resprouter species able regenerate given community following fire allow competition serotinous resprouting species arise species traits. Note change implemented Biomass_regeneration Biomass_regenerationPM modules.Fifth, Biomass_core, species shade tolerance values can decimal values allow finer adjustments -species competition.Sixth, added new parameter called minCohortBiomass, allows user control cohort removal bellow certain threshold biomass. simulation set-ups, noticed Biomass_core (LBSE) able generate many small cohorts understory , due cohort competition, able gain biomass grow. However, competition increase mortality, decreases growth, cohorts survived low biomass levels reached sufficient age suffer age-related mortality. felt unlikely realistic many cases. default, parameter left 0 follow LBSE behaviour (.e., cohorts removal based minimum biomass).","code":""},{"path":"landr-biomass_core-module.html","id":"other-enhancements","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.2 Other enhancements","text":"addition five minor changes growth, mortality regeneration, separated components govern vegetation responses disturbances – fire moment – two independent modules, used interchangeably, implemented hashing, caching testing improve model’s computational efficiency insure performance.","code":""},{"path":"landr-biomass_core-module.html","id":"modularity","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.2.1 Modularity","text":"Unlike LBSE, post-disturbance regeneration part Biomass_core per se, belongs two separate modules, used interchangeably (Biomass_regeneration Biomass_regenerationPM). need loaded added “modules folder” project case user wants simulate forest responses disturbances (fire disturbances moment). , enables higher flexibility swapping different approaches regeneration. instance, default (.e., climate sensitive) growth mortality functions part LandR R package, needs loaded prior running Biomass_core. user wish change growth/mortality algorithms, need provide compatible functions (names) simulation via simInit – user-provided functions replace loaded package . Note LandR package provides supporting functions objects simulation, still needs loaded prior running Biomass_core.","code":""},{"path":"landr-biomass_core-module.html","id":"hashing","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.2.2 Hashing","text":"first strategy improve simulation efficiency Biomass_core use hashing mechanism (Yang et al. 2011). Instead assigning key pixel raster tracking simulation pixel lookup table, indexed pixels using pixelGroup key contained unique combinations ecolocation community, tracked stored simulation data pixelGroup (Fig. 2.5). Ecolocation (called ‘ecoregion’ LBSE model objects) spatial unit similar biophysical characteristics. applications, define ecolocation combination land-cover types Land Cover Map Canada 2005 (v1) ecodistricts National Ecological Framework Canada (). Hence, ecolocations contain relatively fine scale land cover information plus coarse scale regional information. turn, community species composition age structure particular pixel. algorithm able ease computational burden significantly reducing size lookup table speeding-simulation process. recruitment disturbance events, pixels rehashed new pixel groups.","code":""},{"path":"landr-biomass_core-module.html","id":"caching","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.2.3 Caching","text":"second strategy aimed improving model efficacy implementation caching, data-driven parametrisation initialisation. Caching automatically archives outputs given function disk (memory) reads back subsequent calls function given identical inputs. caching operations achieved using reproducible R package (McIntire & Chubaty 2020). current version Biomass_core, spin-phase replaced data-driven landscape initialisation many model parameters derived data, using “data modules” (e.g., Biomass_borealDataPrep). avoid repeat data downloads treatment, statistical estimation parameters landscape initialisation every time simulation re-run conditions (.e., data algorithm changes), many pre-simulation steps automatically cached. means pre-simulation phase significantly faster upon second call inputs changed (e.g., input data parametrisation methods), inputs change directly affected steps re-run (see main text examples). using data modules, Biomass_core still relies caching preparation theoretical inputs.","code":""},{"path":"landr-biomass_core-module.html","id":"testing","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.2.4 Testing","text":"Finally, implemented code testing, facilitate bug detection comparing outputs functions [etc.] expected outputs (Wickham 2011). built integrated code tests Biomass_core across LandR modules LandR R package  form assertions integration tests. Assertions run automatically simulations (can turned ), integration run manually. Tests also implemented R package dependencies Biomass_core, LandR R package  SpaDES, routinely tested using GitHub Actions continuous integration (CI) automated checks CRAN. LandR R package, use GitHub Actions CI automatically test installation execution errors.Finally, Biomass_core (LandR modules) code hosted public GitHub repositories, potentially high number users can identify issues contribute improve module code.","code":""},{"path":"landr-biomass_core-module.html","id":"performance-and-accuracy-of-biomass_core-with-respect-to-lbse","chapter":"2 LandR Biomass_core Module","heading":"2.2.2.3 Performance and accuracy of Biomass_core with respect to LBSE","text":"recoding Biomass_core, ensured similar outputs demographic process (namely, growth, mortality recruitment) outputs counterpart LBSE, using integration tests. , report comparisons overall simulation (.e., including demographic processes) LBSE Biomass_core using three randomly generated initial communities (Tables 2.9-2.11). remaining input parameters taken LANDIS-II training course (Tables 2.12-2.15), contained species attributes information 16 common tree species boreal forests 2 ecolocations. ran simulations 1000 years, succession time step 10 three repetitions, enough account variability produced stochastic processes. Seed dispersal set “ward dispersal”.results suggested Biomass_core good agreement LBSE using three randomly generated initial communities (Fig. 2.6), small deviations LBSE-generated biomasses. Notably, mean differences LBSE Biomass_core 0.03(ref:percent) (range: -0.01(ref:percent) ~ 0.13(ref:percent)), 0.03(ref:percent) (range: -0.01(ref:percent) ~ 0.11(ref:percent)) 0.05(ref:percent) (-0.02(ref:percent) ~ 0.15(ref:percent)) initial community, respectively (right panels Fig. 2.6 appendix).examine running time changed map size, ran simulations using maps increasing number pixels 22,201 638,401. maps initialised single ecolocation 7 different communities. Simulations run 120 years using succession time step 10 replicated three times. eliminate effect hardware running time, used machines purchased time, equal specifications running Windows 7. simulation ran 2 CPU threads total RAM 4000 Mb. LBSE Biomass_core, simulation time increased linearly number pixels, increase rate smaller Biomass_core (Fig. 2.7a). meant models similar simulation efficiencies small maps (< 90,000 pixels), map size increased Biomass_core ~2 times faster LBSE (maps > 100,000 pixels; Fig. 2.7a). Biomass_core also scaled better map size, LBSE speeds fluctuated 19 25 seconds per 1,000 pixels across map sizes, Biomass_core decreased 21 11 seconds per 1,000 pixels smaller larger maps (Fig. 2.7b).","code":""},{"path":"landr-biomass_core-module.html","id":"initialization-inputs-and-parameters","chapter":"2 LandR Biomass_core Module","heading":"2.2.3 Initialization, inputs and parameters","text":"Unlike initialization LBSE, “iterates number time steps equal maximum cohort age site”, beginning t – oldest cohort age adding cohorts appropriate time (Scheller & Miranda 2015b), Biomass_core initializes simulation deriving initial biomasses available data, using data modules. data modules available, Biomass_core initializes theoretical data.initialized, Biomass_core requires following input objects parameters:","code":""},{"path":"landr-biomass_core-module.html","id":"input-objects","chapter":"2 LandR Biomass_core Module","heading":"2.2.3.1 Input objects","text":"Biomass_core’s input objects (theoretical) defaults produced automatically module (running .inputObjects function simInit call, init event spades call – see ?SpaDES.core::events SpaDES.core::simInit). suggest new users run Biomass_core supplying studyArea object. enable become familiar input objects attempting supply , combine Biomass_core data modules.\nTable 2.4: List (ref:Biomass-core) input objects description.\ninputs Table 2.4, following particularly important deserve special attention:Spatial layers\necoregionMap – raster layer ecolocation IDs (note term “ecoregion” inherited LBSE kept consistency original LBSE code). Ecolocations group pixels similar biophysical conditions using two levels grouping. many applications, use Natural Ecoregion classification Canada first grouping level land-cover classification second level. raster layer must defined categorical variable, associated Raster Attribute Table (RAT; see, e.g., raster::ratify). RAT must contain columns: ID (value raster layer), ecoregion (first level ecolocation grouping) ecoregionGroup (full ecolocation “name” written <firstlevel_secondlevel>). Note ecoregionGroup usually originated combining two raster layers , thus, grouping level IDs also integers. instance, Natural Ecoregion 2 land-cover types 1, 2 3, RAT contain ID = {1,2,3}, ecoregion = {2} ecoregionGroup = {2_1, 2_2, 2_3}. ecolocations listed ecoregion data.table.\nrasterToMatch – RasterLayer, given resolution projection determining pixels (.e., non NA values) forest dynamics simulated. Needs match studyArea. supplied, Biomass_core attempts produce , using biomassMap template spatial resolution projection.\nstudyArea – shapefile. SpatialPolygonsDataFrame single polygon determing simulation take place. input object must supplied user.\nSpatial layersecoregionMap – raster layer ecolocation IDs (note term “ecoregion” inherited LBSE kept consistency original LBSE code). Ecolocations group pixels similar biophysical conditions using two levels grouping. many applications, use Natural Ecoregion classification Canada first grouping level land-cover classification second level. raster layer must defined categorical variable, associated Raster Attribute Table (RAT; see, e.g., raster::ratify). RAT must contain columns: ID (value raster layer), ecoregion (first level ecolocation grouping) ecoregionGroup (full ecolocation “name” written <firstlevel_secondlevel>). Note ecoregionGroup usually originated combining two raster layers , thus, grouping level IDs also integers. instance, Natural Ecoregion 2 land-cover types 1, 2 3, RAT contain ID = {1,2,3}, ecoregion = {2} ecoregionGroup = {2_1, 2_2, 2_3}. ecolocations listed ecoregion data.table.ecoregionMap – raster layer ecolocation IDs (note term “ecoregion” inherited LBSE kept consistency original LBSE code). Ecolocations group pixels similar biophysical conditions using two levels grouping. many applications, use Natural Ecoregion classification Canada first grouping level land-cover classification second level. raster layer must defined categorical variable, associated Raster Attribute Table (RAT; see, e.g., raster::ratify). RAT must contain columns: ID (value raster layer), ecoregion (first level ecolocation grouping) ecoregionGroup (full ecolocation “name” written <firstlevel_secondlevel>). Note ecoregionGroup usually originated combining two raster layers , thus, grouping level IDs also integers. instance, Natural Ecoregion 2 land-cover types 1, 2 3, RAT contain ID = {1,2,3}, ecoregion = {2} ecoregionGroup = {2_1, 2_2, 2_3}. ecolocations listed ecoregion data.table.rasterToMatch – RasterLayer, given resolution projection determining pixels (.e., non NA values) forest dynamics simulated. Needs match studyArea. supplied, Biomass_core attempts produce , using biomassMap template spatial resolution projection.rasterToMatch – RasterLayer, given resolution projection determining pixels (.e., non NA values) forest dynamics simulated. Needs match studyArea. supplied, Biomass_core attempts produce , using biomassMap template spatial resolution projection.studyArea – shapefile. SpatialPolygonsDataFrame single polygon determing simulation take place. input object must supplied user.studyArea – shapefile. SpatialPolygonsDataFrame single polygon determing simulation take place. input object must supplied user.Species traits parameter tables\necoregion – data.table listing ecolocation “names” (ecoregionGroup column; see ecoregionMap details) state (active – yes – inactive – )\nminRelativeB – data.table minimum relative biomass values. spatially variant trait used determine shade level pixel (see Scheller & Miranda 2015b), yet applications often keep values constant across ecolocations. table must contain following columns:\necoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .\nX0-X5 – six numeric columns, one per shade class (-shade, 0, maximum shade, 5), 0 1 values determining minimum threshold biomass (relative species/ecolocation maxB) necessary reach given shade-level. means shade-levels determined species species basis (see Scheller & Miranda 2015b)\n\nspecies – data.table invariant species traits. species traits vary spatially, temporally (e.g., longevity). table must contain following trait values (.e., columns) order run Biomass_core (note columns follow data type indicated):\nspeciesCode – character. Species ID.\nlongevity – integer. Maximum age years (see Scheller & Domingo 2011).\nsexualmature – integer. Age sexual maturity years (see Scheller & Domingo 2011).\nshadetolerance – integer numeric. Relative shade tolerance (see Algorithm changes).\nseeddistance_eff – integer. Eeffective seed distance meters. (see Scheller & Domingo 2011)\nseeddistance_max – integer. Maximum seed distance meters. Note pixel size larger maximum seed distance, species able disperse neighbouring pixels (see Scheller & Domingo 2011).\nmortalityshape – integer. Shape growth curve determining quickly mortality begins (see Scheller & Miranda 2015b).\ngrowthcurve – numeric. Shape growth curve determining ANPP reaches maximum (see Scheller & Miranda 2015b).\n\nspeciesEcoregion – data.table spatiotemporally-varying species traits. species traits vary spatially , potentially, temporally. table must contain following columns order run Biomass_core:\necoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .\nspeciesCode – character. Species ID.\nestablishprob – numeric. Species establishment probability (SEP) given species ecolocation , potentially year. SEP influences success incoming seed germination, given pixel biophysical characteristics (note actual success determined SEP light conditions pixel) (see Scheller & Miranda 2015b).\nmaxB – integer. Maximum biomass given species ecolocation units g biomass / m2. Note actual maximum biomass reached species pixel may exceed maxB maxB applied cohort level species may several cohorts given pixel (see Scheller & Miranda 2015b).\nmaxANPP – numeric. Maximum aboveground net primary productivity units g biomass / m2 / year, default calculated 1/30 maxB (see Scheller & Miranda 2015b)\nyear – integer. Used varying SEP, maxB maxANPP values time. Otherwise, use fill lines 0.\n\nsufficientLight – data.table defining probability germination species, given shadetolerance level (see species ) shade level pixel (see minRelativeB ). Must contain columns:\nspeciesshadetolerance – integer. Species shade tolerance levels, 1-5 (levels must present table).\nX0-X5 – six integer columns, one per shade class (-shade, 0, maximum shade, 5), filled 0s 1s values determining probability germination (resprouting) species given shade-level(see Scheller & Miranda 2015b). Unlike LBSE, species shadetolerance values can take decimal values 1-5, case resulting probability germination given pixel interpolated corresponding lower upper shade tolerance values.\n\nsppEquiv – data.table species name equivalencies various conventions. must contain columns LandR (species IDs following LandR format) EN_generic_short (short generic species names English – language; used plotting), Type (type species, Conifer Deciduous, “broadleaf”) Leading (EN_generic_short “leading” appended – e.g., “Poplar leading”) . See ?LandR::sppEquivalencies_CA information.\nsppColorVect – character. named vector colours used plot species dynamics. contain one colour per species species table , potentially colour species mixtures (named “Mixed”). Vector names must follow species$speciesCode.\nSpecies traits parameter tablesecoregion – data.table listing ecolocation “names” (ecoregionGroup column; see ecoregionMap details) state (active – yes – inactive – )ecoregion – data.table listing ecolocation “names” (ecoregionGroup column; see ecoregionMap details) state (active – yes – inactive – )minRelativeB – data.table minimum relative biomass values. spatially variant trait used determine shade level pixel (see Scheller & Miranda 2015b), yet applications often keep values constant across ecolocations. table must contain following columns:\necoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .\nX0-X5 – six numeric columns, one per shade class (-shade, 0, maximum shade, 5), 0 1 values determining minimum threshold biomass (relative species/ecolocation maxB) necessary reach given shade-level. means shade-levels determined species species basis (see Scheller & Miranda 2015b)\nminRelativeB – data.table minimum relative biomass values. spatially variant trait used determine shade level pixel (see Scheller & Miranda 2015b), yet applications often keep values constant across ecolocations. table must contain following columns:ecoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .ecoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .X0-X5 – six numeric columns, one per shade class (-shade, 0, maximum shade, 5), 0 1 values determining minimum threshold biomass (relative species/ecolocation maxB) necessary reach given shade-level. means shade-levels determined species species basis (see Scheller & Miranda 2015b)X0-X5 – six numeric columns, one per shade class (-shade, 0, maximum shade, 5), 0 1 values determining minimum threshold biomass (relative species/ecolocation maxB) necessary reach given shade-level. means shade-levels determined species species basis (see Scheller & Miranda 2015b)species – data.table invariant species traits. species traits vary spatially, temporally (e.g., longevity). table must contain following trait values (.e., columns) order run Biomass_core (note columns follow data type indicated):\nspeciesCode – character. Species ID.\nlongevity – integer. Maximum age years (see Scheller & Domingo 2011).\nsexualmature – integer. Age sexual maturity years (see Scheller & Domingo 2011).\nshadetolerance – integer numeric. Relative shade tolerance (see Algorithm changes).\nseeddistance_eff – integer. Eeffective seed distance meters. (see Scheller & Domingo 2011)\nseeddistance_max – integer. Maximum seed distance meters. Note pixel size larger maximum seed distance, species able disperse neighbouring pixels (see Scheller & Domingo 2011).\nmortalityshape – integer. Shape growth curve determining quickly mortality begins (see Scheller & Miranda 2015b).\ngrowthcurve – numeric. Shape growth curve determining ANPP reaches maximum (see Scheller & Miranda 2015b).\nspecies – data.table invariant species traits. species traits vary spatially, temporally (e.g., longevity). table must contain following trait values (.e., columns) order run Biomass_core (note columns follow data type indicated):speciesCode – character. Species ID.speciesCode – character. Species ID.longevity – integer. Maximum age years (see Scheller & Domingo 2011).longevity – integer. Maximum age years (see Scheller & Domingo 2011).sexualmature – integer. Age sexual maturity years (see Scheller & Domingo 2011).sexualmature – integer. Age sexual maturity years (see Scheller & Domingo 2011).shadetolerance – integer numeric. Relative shade tolerance (see Algorithm changes).shadetolerance – integer numeric. Relative shade tolerance (see Algorithm changes).seeddistance_eff – integer. Eeffective seed distance meters. (see Scheller & Domingo 2011)seeddistance_eff – integer. Eeffective seed distance meters. (see Scheller & Domingo 2011)seeddistance_max – integer. Maximum seed distance meters. Note pixel size larger maximum seed distance, species able disperse neighbouring pixels (see Scheller & Domingo 2011).seeddistance_max – integer. Maximum seed distance meters. Note pixel size larger maximum seed distance, species able disperse neighbouring pixels (see Scheller & Domingo 2011).mortalityshape – integer. Shape growth curve determining quickly mortality begins (see Scheller & Miranda 2015b).mortalityshape – integer. Shape growth curve determining quickly mortality begins (see Scheller & Miranda 2015b).growthcurve – numeric. Shape growth curve determining ANPP reaches maximum (see Scheller & Miranda 2015b).growthcurve – numeric. Shape growth curve determining ANPP reaches maximum (see Scheller & Miranda 2015b).speciesEcoregion – data.table spatiotemporally-varying species traits. species traits vary spatially , potentially, temporally. table must contain following columns order run Biomass_core:\necoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .\nspeciesCode – character. Species ID.\nestablishprob – numeric. Species establishment probability (SEP) given species ecolocation , potentially year. SEP influences success incoming seed germination, given pixel biophysical characteristics (note actual success determined SEP light conditions pixel) (see Scheller & Miranda 2015b).\nmaxB – integer. Maximum biomass given species ecolocation units g biomass / m2. Note actual maximum biomass reached species pixel may exceed maxB maxB applied cohort level species may several cohorts given pixel (see Scheller & Miranda 2015b).\nmaxANPP – numeric. Maximum aboveground net primary productivity units g biomass / m2 / year, default calculated 1/30 maxB (see Scheller & Miranda 2015b)\nyear – integer. Used varying SEP, maxB maxANPP values time. Otherwise, use fill lines 0.\nspeciesEcoregion – data.table spatiotemporally-varying species traits. species traits vary spatially , potentially, temporally. table must contain following columns order run Biomass_core:ecoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .ecoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .speciesCode – character. Species ID.speciesCode – character. Species ID.establishprob – numeric. Species establishment probability (SEP) given species ecolocation , potentially year. SEP influences success incoming seed germination, given pixel biophysical characteristics (note actual success determined SEP light conditions pixel) (see Scheller & Miranda 2015b).establishprob – numeric. Species establishment probability (SEP) given species ecolocation , potentially year. SEP influences success incoming seed germination, given pixel biophysical characteristics (note actual success determined SEP light conditions pixel) (see Scheller & Miranda 2015b).maxB – integer. Maximum biomass given species ecolocation units g biomass / m2. Note actual maximum biomass reached species pixel may exceed maxB maxB applied cohort level species may several cohorts given pixel (see Scheller & Miranda 2015b).maxB – integer. Maximum biomass given species ecolocation units g biomass / m2. Note actual maximum biomass reached species pixel may exceed maxB maxB applied cohort level species may several cohorts given pixel (see Scheller & Miranda 2015b).maxANPP – numeric. Maximum aboveground net primary productivity units g biomass / m2 / year, default calculated 1/30 maxB (see Scheller & Miranda 2015b)maxANPP – numeric. Maximum aboveground net primary productivity units g biomass / m2 / year, default calculated 1/30 maxB (see Scheller & Miranda 2015b)year – integer. Used varying SEP, maxB maxANPP values time. Otherwise, use fill lines 0.year – integer. Used varying SEP, maxB maxANPP values time. Otherwise, use fill lines 0.sufficientLight – data.table defining probability germination species, given shadetolerance level (see species ) shade level pixel (see minRelativeB ). Must contain columns:\nspeciesshadetolerance – integer. Species shade tolerance levels, 1-5 (levels must present table).\nX0-X5 – six integer columns, one per shade class (-shade, 0, maximum shade, 5), filled 0s 1s values determining probability germination (resprouting) species given shade-level(see Scheller & Miranda 2015b). Unlike LBSE, species shadetolerance values can take decimal values 1-5, case resulting probability germination given pixel interpolated corresponding lower upper shade tolerance values.\nsufficientLight – data.table defining probability germination species, given shadetolerance level (see species ) shade level pixel (see minRelativeB ). Must contain columns:speciesshadetolerance – integer. Species shade tolerance levels, 1-5 (levels must present table).speciesshadetolerance – integer. Species shade tolerance levels, 1-5 (levels must present table).X0-X5 – six integer columns, one per shade class (-shade, 0, maximum shade, 5), filled 0s 1s values determining probability germination (resprouting) species given shade-level(see Scheller & Miranda 2015b). Unlike LBSE, species shadetolerance values can take decimal values 1-5, case resulting probability germination given pixel interpolated corresponding lower upper shade tolerance values.X0-X5 – six integer columns, one per shade class (-shade, 0, maximum shade, 5), filled 0s 1s values determining probability germination (resprouting) species given shade-level(see Scheller & Miranda 2015b). Unlike LBSE, species shadetolerance values can take decimal values 1-5, case resulting probability germination given pixel interpolated corresponding lower upper shade tolerance values.sppEquiv – data.table species name equivalencies various conventions. must contain columns LandR (species IDs following LandR format) EN_generic_short (short generic species names English – language; used plotting), Type (type species, Conifer Deciduous, “broadleaf”) Leading (EN_generic_short “leading” appended – e.g., “Poplar leading”) . See ?LandR::sppEquivalencies_CA information.sppEquiv – data.table species name equivalencies various conventions. must contain columns LandR (species IDs following LandR format) EN_generic_short (short generic species names English – language; used plotting), Type (type species, Conifer Deciduous, “broadleaf”) Leading (EN_generic_short “leading” appended – e.g., “Poplar leading”) . See ?LandR::sppEquivalencies_CA information.sppColorVect – character. named vector colours used plot species dynamics. contain one colour per species species table , potentially colour species mixtures (named “Mixed”). Vector names must follow species$speciesCode.sppColorVect – character. named vector colours used plot species dynamics. contain one colour per species species table , potentially colour species mixtures (named “Mixed”). Vector names must follow species$speciesCode.Cohort-simulation-related objects\ncohortData – data.table containing initial cohort information per pixelGroup (see pixelGroupMap ). table updated simulation cohort dynamics simulated. Must contain following columns\npixelGroup – integer. pixelGroup ID. See Hashing.\necoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .\nspeciesCode – character. Species ID.\nage – integer. Cohort age.\nB – integer. cohort biomass g/m2.\nmortality – integer. cohort dead biomass current year g/m2. filled 0s initial conditions.\naNPPAct – integer. Actual aboveground net primary productivity current year g/m2. Hence B result previous year’s B minus mortality plus aNPPAct. See “1.1.3 Cohort growth ageing” section Scheller & Miranda (2015b).\n\npixelGroupMap – raster layer pixelGroup IDs per pixel. Pixels always grouped based identical ecoregionGroup, speciesCode, age B composition, even user supplies initial groupings (e.g., possible Biomass_borealDataPrep data module).\nCohort-simulation-related objectscohortData – data.table containing initial cohort information per pixelGroup (see pixelGroupMap ). table updated simulation cohort dynamics simulated. Must contain following columns\npixelGroup – integer. pixelGroup ID. See Hashing.\necoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .\nspeciesCode – character. Species ID.\nage – integer. Cohort age.\nB – integer. cohort biomass g/m2.\nmortality – integer. cohort dead biomass current year g/m2. filled 0s initial conditions.\naNPPAct – integer. Actual aboveground net primary productivity current year g/m2. Hence B result previous year’s B minus mortality plus aNPPAct. See “1.1.3 Cohort growth ageing” section Scheller & Miranda (2015b).\ncohortData – data.table containing initial cohort information per pixelGroup (see pixelGroupMap ). table updated simulation cohort dynamics simulated. Must contain following columnspixelGroup – integer. pixelGroup ID. See Hashing.pixelGroup – integer. pixelGroup ID. See Hashing.ecoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .ecoregionGroup – character. Ecolocation names. See ecoregionMap ecoregion objects .speciesCode – character. Species ID.speciesCode – character. Species ID.age – integer. Cohort age.age – integer. Cohort age.B – integer. cohort biomass g/m2.B – integer. cohort biomass g/m2.mortality – integer. cohort dead biomass current year g/m2. filled 0s initial conditions.mortality – integer. cohort dead biomass current year g/m2. filled 0s initial conditions.aNPPAct – integer. Actual aboveground net primary productivity current year g/m2. Hence B result previous year’s B minus mortality plus aNPPAct. See “1.1.3 Cohort growth ageing” section Scheller & Miranda (2015b).aNPPAct – integer. Actual aboveground net primary productivity current year g/m2. Hence B result previous year’s B minus mortality plus aNPPAct. See “1.1.3 Cohort growth ageing” section Scheller & Miranda (2015b).pixelGroupMap – raster layer pixelGroup IDs per pixel. Pixels always grouped based identical ecoregionGroup, speciesCode, age B composition, even user supplies initial groupings (e.g., possible Biomass_borealDataPrep data module).pixelGroupMap – raster layer pixelGroup IDs per pixel. Pixels always grouped based identical ecoregionGroup, speciesCode, age B composition, even user supplies initial groupings (e.g., possible Biomass_borealDataPrep data module).","code":""},{"path":"landr-biomass_core-module.html","id":"parameters","chapter":"2 LandR Biomass_core Module","heading":"2.2.3.2 Parameters","text":"Table 2.5 lists parameters used Biomass_core. Note parameters relevant simulating climate effects cohort growth mortality, require also loading LandR.CS R package. Like input objects, default values supplied parameters suggest user becomes familiarized attempting changes. also note \"spin-\" \"biomassMap\" options initialBiomassSource currently deactivated, since Biomass_core longer generates initial cohort biomass conditions using spin-based initial stand age like LANDIS-II (\"spin-\"), attempt fill initial cohort biomasses using biomassMap (\"biomassMap\"). list useful parameters description shown Table 2.6.\nTable 2.5: List (ref:Biomass-core) parameters description.\n: (#tab:tableUsefulParams) Useful Biomass_core parameters.","code":""},{"path":"landr-biomass_core-module.html","id":"simulation-flow","chapter":"2 LandR Biomass_core Module","heading":"2.2.4 Simulation flow","text":"","code":""},{"path":"landr-biomass_core-module.html","id":"no-disturbances","chapter":"2 LandR Biomass_core Module","heading":"2.2.4.1 No disturbances","text":"Biomass_core simulate disturbances, effect vegetation (.e., post-disturbance mortality regeneration). general flow Biomass_core processes :Preparation necessary objects simulation – either accessory data prep. modules, Biomass_core (using LANDIS-II test parameters dummy data stand age, biomass land cover ecological zoning)Seed dispersal – see Scheller & Domingo (2012) detailsSeed dispersal can slow process adapted occur every 10 years. user can set occur often, make much difference model outputs, age classes meant collapsed tens.Growth mortality – based Scheller & Mladenoff (2004a)unlike dispersal, growth mortality occur every yearAgeing – based Scheller & Miranda (2015b)follows frequency dispersal, collapsing ages classes resolution = frequencyPreparation visual/saved outputs … (repeat 2-4) …","code":""},{"path":"landr-biomass_core-module.html","id":"with-disturbances","chapter":"2 LandR Biomass_core Module","heading":"2.2.4.2 With disturbances","text":"Note post-disturbance regeneration module used (e.g., Biomass_regeneration), regeneration occur disturbance, dispersal background vegetation growth mortality. Hence, disturbance take place either beginning end simulation time step. general flow Biomass_core processes disturbances included (linking modules) :Preparation necessary objects simulation – either accessory prep. data modules, Biomass_core (using LANDIS-II test parameters dummy data.)Disturbances – simulated disturbance modulePost-disturbance regeneration – simulated regeneration module (Biomass_regeneration optional download)Seed dispersal – see Scheller & Domingo (2012) detailsGrowth, ageing mortality – based Scheller & Miranda (2015b)Preparation visual/saved outputs … (repeat 2-6) …","code":""},{"path":"landr-biomass_core-module.html","id":"usage-example","chapter":"2 LandR Biomass_core Module","heading":"2.3 Usage example","text":"","code":""},{"path":"landr-biomass_core-module.html","id":"set-up-r-libraries","chapter":"2 LandR Biomass_core Module","heading":"2.3.1 Set up R libraries","text":"","code":"\nif (!require(Require)) {\n  install.packages(\"Require\")\n  library(Require)\n}\n\nRequire(c(\"PredictiveEcology/SpaDES.install\",\n          \"SpaDES\", \"PredictiveEcology/SpaDES.core@development\",\n          \"PredictiveEcology/LandR\"), \n        install_githubArgs = list(dependencies = TRUE))# In general, a module code will be controlled at one level above the source code\n\ntempDir <- tempdir()\npaths <- list(inputPath = normPath(file.path(tempDir, \"inputs\")), \n              cachePath = normPath(file.path(tempDir, \"cache\")), \n              modulePath = normPath(file.path(tempDir, \"modules\")), \n              outputPath = normPath(file.path(tempDir, \"outputs\")))"},{"path":"landr-biomass_core-module.html","id":"get-the-module-and-module-dependencies","chapter":"2 LandR Biomass_core Module","heading":"2.3.2 Get the module and module dependencies","text":"can use SpaDES.install::getModule function download module module folder specified .\nAlternatively, see SpaDES-modules repository see download SpaDES modules, fork/clone GitHub repository directly.downloading module, important make sure module R package dependencies installed correct version. SpaDES.install::makeSureAllPackagesInstalled takes care module paths$modulePath.","code":"\nSpaDES.install::getModule(\"PredictiveEcology/Biomass_core\", \n                          modulePath = paths$modulePath, overwrite = TRUE)\n\n## make sure all necessary packages are installed:\nSpaDES.install::makeSureAllPackagesInstalled(paths$modulePath)"},{"path":"landr-biomass_core-module.html","id":"setup-simulation","chapter":"2 LandR Biomass_core Module","heading":"2.3.3 Setup simulation","text":"","code":"\ntimes <- list(start = 0, end = 30)\n\nstudyArea <- Cache(randomStudyArea, size = 1e7) # cache this so it creates a random one only once on a machine\n\n# Pick the species you want to work with – using the naming convention in \"Boreal\" column of LandR::sppEquivalencies_CA\nspeciesNameConvention <- \"Boreal\"\nspeciesToUse <- c(\"Pice_Gla\", \"Popu_Tre\", \"Pinu_Con\")\n\nsppEquiv <- LandR::sppEquivalencies_CA[get(speciesNameConvention) %in% speciesToUse]\n# Assign a colour convention for graphics for each species\nsppColorVect <- LandR::sppColors(sppEquiv, speciesNameConvention,\n                                 newVals = \"Mixed\", palette = \"Set1\")\n\n## Usage example\nmodules <- as.list(moduleName)\nobjects <- list(studyArea = studyArea, sppEquiv = sppEquiv, sppColorVect = sppColorVect)\n\nsuccessionTimestep <- 10L\n\n## keep default values for most parameters \n## (omitted from this list)\nparameters <- list(\n  Biomass_core = list(\n    \"sppEquivCol\" = speciesNameConvention\n    , \"successionTimestep\" = successionTimestep\n    , \".plots\" = c(\"screen\", \"object\")\n    , \".plotInitialTime\" = times$start\n    , \".plots\" = c(\"screen\", \"png\")\n    , \".saveInitialTime\" = times$start\n    , \".useCache\" = \"init\"\n    , \".useParallel\" = FALSE\n  )\n)\n\noutputs <- data.frame(expand.grid(objectName = \"cohortData\",\n                                  saveTime = unique(seq(times$start, times$end, by = 1)),\n                                  eventPriority = 1,\n                                  stringsAsFactors = FALSE))\n\ngraphics.off()"},{"path":"landr-biomass_core-module.html","id":"run-simulation","chapter":"2 LandR Biomass_core Module","heading":"2.3.4 Run simulation","text":"\nFigure 2.2: (ref:Biomass-core) automatically generates simulation visuals species dynamics across landscape terms total biomass, number presences age productivity (), well yearly plots total biomass, productivity, mortality, reproduction leading species pixel ().\n","code":"\nmySim <- simInitAndSpades(times = times,\n                          params = parameters, \n                          modules = modules, \n                          objects = objects, \n                          paths = paths,\n                          outputs = outputs,\n                          debug = TRUE)"},{"path":"landr-biomass_core-module.html","id":"appendix","chapter":"2 LandR Biomass_core Module","heading":"2.4 Appendix","text":"","code":""},{"path":"landr-biomass_core-module.html","id":"tables","chapter":"2 LandR Biomass_core Module","heading":"2.4.1 Tables","text":"Table 2.7:  Input order processing order (determined LBSE) community used assess impact sequential calculation competition index, combined lack explicit species ordering. input order order species initial communities table input file. processing order order used simulation, obtained Landis-log.txt CalibrateMode set ‘yes’. Species starting ages also shown.Table 2.8:  Input order processing order (determined LBSE) community used assess impact setting succession time step 1, combined lack explicit species ordering. input order order species initial communities table input file. processing order order used simulation, obtained Landis-log.txt CalibrateMode set ‘yes’. Species starting ages also shown.Table 2.9:  Randomly generated community combination . 1 used recruitment comparison runs.Table 2.10:  Randomly generated community combination . 2 used recruitment comparison runs.Table 2.11:  Randomly generated community combination . 3 used recruitment comparison runs.Table 2.12:  Invariant species traits table used comparison runs.Table 2.13:  Minimum relative biomass table used comparison runs. X0-5 represent site shade classes -shade (0) maximum shade (5). ecolocations shared values.Table 2.14:  Probability germination species shade tolerance shade level combinations (called sufficient light table LBSE sufficientLight input data.table LandR Biomass_core) used comparison runs.Table 2.15:  Species ecolocation table used comparison runs. SEP stands species establishment probability, maxB maximum biomass maxANPP maximum aboveground net primary productivity. Values held constant throughout simulation.","code":""},{"path":"landr-biomass_core-module.html","id":"figures","chapter":"2 LandR Biomass_core Module","heading":"2.4.2 Figures","text":"\nFigure 2.3: Differences total landscape aboveground biomass using two different input species orders community. simulations demonstrate sequential calculation competition index, combined lack explicit species ordering affect overall landscape aboveground biomass time using different input species orders (see Table 2.7). order prevent differences introduced cohort recruitment, species’ ages sexual maturity changed species’ longevity values, simulation ran 75 years prevent cohorts reaching sexual maturity. bottom panel shows difference two simulations percentage, calculated \\(\\frac{Biomass_{order2} - Biomass_{order1}}{Biomass_{order2}} * 100\\)\n\nFigure 2.4: Differences biomasses assigned new cohorts, summed species across pixels, using two different input species orders community succession time step 1. simulations demonstrate different summation total cohort biomass succession time step 1 lack explicit species ordering affect simulation results changing species order input file (see Table 2.8). , initial cohort ages also set 1. show initial total biomass attributed species end year 1.\n\nFigure 2.5: Hashing design (ref:Biomass-core). re-coded (ref:Biomass-core), pixel group map hashed based unique combination species composition (.e., community map) ecolocation map, associated lookup table. subfigure right upper corner original design linked map lookup table pixel key.\n\nFigure 2.6: Visual comparison simulation outputs three randomly generated initial communities (left panels) difference outputs (right panels). (ref:percent) difference LBSE (ref:Biomass-core) calculated \\(\\frac{Biomass_{LBSE} - Biomass_{Biomass_core}}{Biomass_{LBSE}} * 100\\)\n\nFigure 2.7: Simulation efficiencies LBSE (ref:Biomass-core) increasing map size, terms ) mean running time across repetitions (left y-axis) ratio LBSE (ref:Biomass-core) running times (right y-axis blue line), b) running time scalability mean running time per 1000 pixels.\n","code":""},{"path":"landr-biomass_core-module.html","id":"references","chapter":"2 LandR Biomass_core Module","heading":"2.5 References","text":"","code":""},{"path":"landr-data-modules.html","id":"landr-data-modules","chapter":"3 LandR Data Modules","heading":"3 LandR Data Modules","text":"LandR ecosystem SpaDES modules variety ‘data modules’ used obtain pre-process input data, well estimate input parameters required core forest landscape simulation module Biomass_core. modules presented next chapters.","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"landr-biomass_speciesdata-module","chapter":"4 LandR Biomass_speciesData Module","heading":"4 LandR Biomass_speciesData Module","text":"\ndocumentation work progress. Potential discrepancies omissions\nmay exist time . find , contact us using link\n^^","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"authors-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.0.0.1 Authors:","text":"Eliot J B McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut, cre], Alex M. Chubaty achubaty@-cast.ca [aut], Ceres Barros cbarros@mail.ubc.ca [aut]\n","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"module-overview-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1 Module Overview","text":"","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"module-summary-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1.1 Module summary","text":"module downloads pre-process species (ref:percent) cover data layers \npassed LandR data modules (e.g., Biomass_borealDataPrep) \nLandR forest simulation module Biomass_core.","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"module-inputs-and-parameters-at-a-glance","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1.2 Module inputs and parameters at a glance","text":"full list input objects (Table\n4.1) parameters (Table\n4.2) Biomass_speciesData expects.\n, input must provided (.e., Biomass_speciesData\ndefault ) studyAreaLarge.Raw data layers downloaded module saved dataPath(sim), can\ncontrolled via options(reproducible.destinationPath = ...).\nTable 4.1: List Biomass_speciesData input objects description.\n\nTable 4.2: List Biomass_speciesData parameters description.\n","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"events-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1.3 Events","text":"Biomass_speciesData runs two events:Module “initiation” (init event), species (ref:percent)\ncover layers downloaded processed.Plotting processed species cover layers (initPlot event).","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"module-outputs-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1.4 Module outputs","text":"module produces following outputs (Table\n4.3):\nTable 4.3: List Biomass_speciesData output objects description.\nautomatically saves processed species cover layers output path\ndefined getPaths(sim)$outputPath.","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"links-to-other-modules-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1.5 Links to other modules","text":"Intended used LandR data modules (e.g.,\nBiomass_borealDataPrep) require species cover data LandR forest\nsimulation Biomass_core module. can see potential module linkages\nwithin LandR ecosystem\n. Select\nBiomass_speciesData drop-menu see linkages.","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"getting-help-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.1.6 Getting help","text":"https://github.com/PredictiveEcology/Biomass_speciesData/issues","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"module-manual-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.2 Module manual","text":"","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"detailed-description","chapter":"4 LandR Biomass_speciesData Module","heading":"4.2.1 Detailed description","text":"module accesses processes species percent cover ((ref:percent) cover)\ndata parametrisation initialization LandR Biomass_core. \nmodule ensures 1) data use geospatial geometries 2) \ncorrectly re-projected studyAreaLarge, 3) attempts sequentially\nfill-replace lowest quality data higher quality data \nseveral data sources used. ’s primary output RasterStack species\n(ref:percent) cover, layer corresponding species.Currently, module can access Canadian Forest Inventory forest attributes\nkNN dataset [default; Beaudoin et al. (2017)], Common Attribute Schema \nForest Resource Inventories [CASFRI; Cosco (2011)] dataset, Ontario Forest\nResource Inventory (ONFRI), dataset specific Alberta compiled Paul\nPickell, Alberta forest inventory datasets. However, NFI\nkNN data freely available – access datasets must granted\nmodule developers data owners, Google account required.\nNevertheless, module flexible enough user can use process\nadditional datasets, provided adequate R function passed \nmodule (see types parameter details Parameters)multiple data sources used, module use replace lower quality\ndata higher quality data following order specified parameter\ntypes (see Parameters).multiple species given data source grouped, (ref:percent)\ncover summed across species group within pixel. Please see\nsppEquiv input Input objects information species groups\ndefined.module can also exclude species (ref:percent) cover layers don’t\nminimum (ref:percent) cover value least one pixel. means \nuser still inspect many pixels species deemed present,\npossible data pixels high (ref:percent)\ncover given species. case, user may choose exclude \nspecies posteriori. summary plot automatically shown \nBiomass_speciesData can help diagnose whether certain species present \npixels (see Fig. 4.1).","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"initialization-inputs-and-parameters-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.2.2 Initialization, inputs and parameters","text":"Biomass_speciesData initializes prepares inputs provided \ninternet access download raw data layers (layers\npreviously downloaded stored folder specified \noptions(\"reproducible.destinationPath\")).module defaults processing cover data fo species listed \nBoreal column default sppEquiv input data.table object, \navailable (ref:percent) cover layers kNN dataset (Table\n4.4; see ?LandR::sppEquivalencies_CA \ninformation):\nTable 4.4: List species cover data downloaded default Biomass_speciesData.\n","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"input-objects-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.2.2.1 Input objects","text":"Biomass_speciesData requires following input data layers\nTable 4.5: List Biomass_speciesData input objects description.\ninputs Table 4.5, \nfollowing particularly important deserve special attention:studyAreaLarge – polygon defining area species cover\ndata area desired. can larger (never smaller) study area\nused simulation forest dynamics (.e., studyArea object \nBiomass_core).studyAreaLarge – polygon defining area species cover\ndata area desired. can larger (never smaller) study area\nused simulation forest dynamics (.e., studyArea object \nBiomass_core).sppEquiv – table correspondences different species naming\nconventions. table used across several LandR modules, including\nBiomass_core. particularly important determine\nwhether species (cover layers) merged, \ndesired user. instance, user wishes simulate generic\nPicea spp. includes, Picea glauca, Picea mariana Picea\nengelmannii, need provide three species names \ndata column (e.g., KNN obtaining forest attribute kNN data layers \nCanadian Forest Inventory), name (e.g., “Pice_Spp”) \ncoumn chosen naming convention used throughout simulation (\nsppEquivCol parameter); see Table\n4.6 example).sppEquiv – table correspondences different species naming\nconventions. table used across several LandR modules, including\nBiomass_core. particularly important determine\nwhether species (cover layers) merged, \ndesired user. instance, user wishes simulate generic\nPicea spp. includes, Picea glauca, Picea mariana Picea\nengelmannii, need provide three species names \ndata column (e.g., KNN obtaining forest attribute kNN data layers \nCanadian Forest Inventory), name (e.g., “Pice_Spp”) \ncoumn chosen naming convention used throughout simulation (\nsppEquivCol parameter); see Table\n4.6 example).\nTable 4.6: Example species merging simulation. user wants model Abies balsamea, . lasiocarpa Pinus contorta separate species, Picea spp. genus-level group. , six species identified 'KNN' column, (ref:percent) cover layers can obtained, 'Boreal' column (defines naming convention used simulation example) Picea spp. name. Biomass_speciesData merge (ref:percent) cover data single layer summing cover per pixel.\n","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"parameters-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.2.2.2 Parameters","text":"Table 4.7 lists parameters used \nBiomass_speciesData detailed information.\nTable 4.7: List Biomass_speciesData parameters description.\nparameters listed Table 4.7,\nfollowing particularly important:coverThresh – integer. Defines minimum (ref:percent) cover value (\n0-100) species must least one pixel considered\npresent study area, otherwise excluded final stack \nspecies layers. Note affect species data \neventual simulation user need adjust simulation parameters\n(e.g., species trait tables need match species cover\nlayers) accordingly.coverThresh – integer. Defines minimum (ref:percent) cover value (\n0-100) species must least one pixel considered\npresent study area, otherwise excluded final stack \nspecies layers. Note affect species data \neventual simulation user need adjust simulation parameters\n(e.g., species trait tables need match species cover\nlayers) accordingly.types – character. (ref:percent) cover data sources used\n(see Detailed description). Several data sources can passed, \ncase module overlay lower quality layers higher quality\nones following order data sources specified types – .e.,\ntypes == c(\"KNN\", \"CASFRI\", \"ForestInventory\"), KNN assumed \nlowest quality data set ForestInventory highest: values \nKNN layers replaced overlapping values CASFRI layers \nvalues KNN CASFRI layers replaced overlapping values\nForestInventory layers.types – character. (ref:percent) cover data sources used\n(see Detailed description). Several data sources can passed, \ncase module overlay lower quality layers higher quality\nones following order data sources specified types – .e.,\ntypes == c(\"KNN\", \"CASFRI\", \"ForestInventory\"), KNN assumed \nlowest quality data set ForestInventory highest: values \nKNN layers replaced overlapping values CASFRI layers \nvalues KNN CASFRI layers replaced overlapping values\nForestInventory layers.","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"simulation-flow-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.2.3 Simulation flow","text":"general flow Biomass_speciesData processes :Download (necessary) spatial processing species cover layers\nfirst data source listed types parameter. Spatial\nprocessing consists sub-setting data area defined \nstudyAreaLarge ensuring spatial projection resolution\nmatch rasterToMatchLarge. spatial processing, species\nlayers pixels values >= coverThresh parameter\nexcluded.Download (necessary) spatial processing species cover layers\nfirst data source listed types parameter. Spatial\nprocessing consists sub-setting data area defined \nstudyAreaLarge ensuring spatial projection resolution\nmatch rasterToMatchLarge. spatial processing, species\nlayers pixels values >= coverThresh parameter\nexcluded.one data source listed types, second set species\ncover layers downloaded processed .one data source listed types, second set species\ncover layers downloaded processed .second set layers assumed highest quality dataset \nused replaced overlapping pixel values first (including \nspecies whose layers may initially excluded applying \ncoverThresh filter).second set layers assumed highest quality dataset \nused replaced overlapping pixel values first (including \nspecies whose layers may initially excluded applying \ncoverThresh filter).Steps 2 3 repeated remaining data sources listed types.Steps 2 3 repeated remaining data sources listed types.Final layers saved disk plotted. summary number pixels\nforest cover calculated (treedand numTreed output objects; see\nModule outputs).Final layers saved disk plotted. summary number pixels\nforest cover calculated (treedand numTreed output objects; see\nModule outputs).","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"usage-example-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.3 Usage example","text":"","code":""},{"path":"landr-biomass_speciesdata-module.html","id":"load-spades-and-other-packages.","chapter":"4 LandR Biomass_speciesData Module","heading":"4.3.1 Load SpaDES and other packages.","text":"","code":"\nif (!require(Require)) {\n  install.packages(\"Require\")\n  library(Require)\n}\n\nRequire(c(\"PredictiveEcology/SpaDES.install\",\n          \"SpaDES\", \"PredictiveEcology/SpaDES.core@development\",\n          \"PredictiveEcology/LandR\"), \n        install_githubArgs = list(dependencies = TRUE))"},{"path":"landr-biomass_speciesdata-module.html","id":"get-module-necessary-packages-and-set-up-folder-directories","chapter":"4 LandR Biomass_speciesData Module","heading":"4.3.2 Get module, necessary packages and set up folder directories","text":"","code":"\ntempDir <- tempdir()\npaths <- list(inputPath = normPath(file.path(tempDir, \"inputs\")), \n              cachePath = normPath(file.path(tempDir, \"cache\")), \n              modulePath = normPath(file.path(tempDir, \"modules\")), \n              outputPath = normPath(file.path(tempDir, \"outputs\")))\n\ngetModule(\"PredictiveEcology/Biomass_speciesData\", \n                       modulePath = paths$modulePath, overwrite = TRUE)\n\n## make sure all necessary packages are installed:\nmakeSureAllPackagesInstalled(paths$modulePath)"},{"path":"landr-biomass_speciesdata-module.html","id":"setup-simulation-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.3.3 Setup simulation","text":"demonstration using default parameter values, except\ncoverThresh , lowered 5(ref:percent). species layers (\nmajor output interest) saved automatically, need tell\nspades save using outputs argument (see\n?SpaDES.core::outputs).pass global parameter .plotInitialTime = 1 simInitAndSpades\nfunction activate plotting.","code":"\n# User may want to set some options -- see ?reproducibleOptions \n#    -- e.g., often the path to the 'inputs' folder will be set outside of project by user:\n# options(reproducible.inputPaths = \"E:/Data/LandR_related/\") # to re-use datasets across projects\nstudyAreaLarge <- Cache(randomStudyArea, size = 1e7,\n                        cacheRepo = paths$cachePath) # cache this so it creates a random one only once on a machine\n\n# Pick the species you want to work with -- here we use the naming convention in \"Boreal\" column of LandR::sppEquivalencies_CA (default)\nspeciesNameConvention <- \"Boreal\"\nspeciesToUse <- c(\"Pice_Gla\", \"Popu_Tre\", \"Pinu_Con\")\n\nsppEquiv <- LandR::sppEquivalencies_CA[get(speciesNameConvention) %in% speciesToUse]\n# Assign a colour convention for graphics for each species\nsppColorVect <- LandR::sppColors(sppEquiv, speciesNameConvention,\n                                 newVals = \"Mixed\", palette = \"Set1\")\n\n## Usage example\nmodules <- list(\"Biomass_speciesData\")\nobjects <- list(\"studyAreaLarge\" = studyAreaLarge,\n                \"sppEquiv\" = sppEquiv,\n                \"sppColorVect\" = sppColorVect)\nparams <- list(\"Biomass_speciesData\" = list(\"coverThresh\" = 5L))"},{"path":"landr-biomass_speciesdata-module.html","id":"run-module","chapter":"4 LandR Biomass_speciesData Module","heading":"4.3.4 Run module","text":"Note data module (.e., attempts prepare data \nsimulation) iterating start end times \nset 1 .outputs Biomass_speciesData (dominant species) \nrandomly generated study area within Canada.\nFigure 4.1: Biomass_speciesData automatically generates plot species dominance number presences study area .plotInitialTime=1 passed argument.\n","code":"\nopts <- options(reproducible.useCache = TRUE,\n                reproducible.inputPaths = paths$inputPath)\n\nmySimOut <- simInitAndSpades(times = list(start = 1, end = 1),\n                             modules = modules, \n                             parameters = params,\n                             objects = objects, \n                             paths = paths,\n                             .plotInitialTime = 1)\noptions(opts)"},{"path":"landr-biomass_speciesdata-module.html","id":"references-1","chapter":"4 LandR Biomass_speciesData Module","heading":"4.4 References","text":"","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"landr-biomass_borealdataprep-module","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5 LandR Biomass_borealDataPrep Module","text":"\ndocumentation work progress. Potential discrepancies omissions\nmay exist time . find , contact us using link\n^^","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"authors-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.0.0.1 Authors:","text":"Yong Luo yong.luo@canada.ca [aut], Eliot J B McIntire eliot.mcintire@canada.ca [aut, cre], Ceres Barros cbarros@mail.ubc.ca [ctb], Alex M. Chubaty achubaty@-cast.ca [ctb]\n","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"module-overview-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1 Module Overview","text":"","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"module-summary-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1.1 Module summary","text":"module converts open datasets available Canada’s\nforests, input requirements Biomass_core. designed\ntested parts Western Boreal Forest.Specifically, takes stand biomass, stand age (defaulting Canadian\nForest Inventory kNN-derived biomass/age maps), land-cover (Land Cover Canada\nmap default) ecological zonation maps Canada (ecodistricts \ndefault), well species specific (ref:percent) cover maps Canada\n(defaulting Canadian Forest Inventory kNN-derived species (ref:percent) cover\nmaps) ) statistically estimate species growth establishment traits\nused Biomass_core, ii) define initial species biomass age per pixel\nused Biomass_core start simulation. also defines ecolocations\n(groups biophysically similar pixels, default combination land-cover\necozonation) used simulation.species traits taken publicly available tables used Dominic\nCyr LANDIS-II simulations, exceptions (see ).Keeping data preparation outside LandR Biomass_core module maintains\nmodularity LandR modules.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"module-inputs-and-parameters-at-a-glance-1","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1.2 Module inputs and parameters at a glance","text":"Biomass_borealDataPrep requires internet access retrieve default data. Raw\ndata layers downloaded module saved dataPath(sim), can \ncontrolled via options(reproducible.destinationPath = ...).advise future users run Biomass_borealDataPrep defaults inspect\nobjects like supplying data, alternative\ndataURLs. Biomass_borealDataPrep meant parametrise Biomass_core \nWestern Canadian boreal forests, provides good foundation develop \nmodules aimed different geographical contexts.full lists input objects (Table\n5.1) parameters (Table\n5.2) Biomass_borealDataPrep\nexpects. inputs must provided (.e.,\nBiomass_borealDataPrep default ) studyArea (study\narea used simulate forest dynamics Biomass_core) studyAreaLarge (\npotentially larger study area used derive parameter values – e.g., species\ntraits). input objects parameters internal defaults (see\nTables 5.5 \n5.6).\nTable 5.1: List Biomass_borealDataPrep input objects description.\n\nTable 5.2: List Biomass_borealDataPrep parameters description.\n","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"events-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1.3 Events","text":"following events take place Biomass_borealDataPrep run. Note \nmodule runs (one “time step”).Module initiation (init event): downloading necessary data\n(.inputObjects event), module prepares necessary\nobjects parameters simulation (see Detailed description).\nDepending objects, parametrised using empirical models,\nothers based literature (e.g., longevity values western boreal\nspecies taken Burton & Cumming 1995), expert knowledge (e.g.,\nsufficientLight values adjusted reflect western boreal forest\nsuccession dynamics) – – see ?LandR::speciesTableUpdate.Plotting event: plots estimated spatially-varying trait values.Saving event: saves objects passed spades(..., outputs)","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"module-outputs-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1.4 Module outputs","text":"module produces following outputs (Table\n5.3):\nTable 5.3: List Biomass_borealDataPrep output objects description.\n","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"links-to-other-modules-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1.5 Links to other modules","text":"Intended used Biomass_core, can also linked data\nmodules prepare inputs (e.g., Biomass_speciesData may used upstream\nBiomass_borealDataPrep prepare species (ref:percent) cover layers\nusing multiple data sources). can see potential module linkages within\nLandR ecosystem\n. Select\nBiomass_borealDataPrep drop-menu see linkages.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"getting-help-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.1.6 Getting help","text":"https://github.com/PredictiveEcology/Biomass_borealDataPrep/issues","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"module-manual-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2 Module manual","text":"","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"detailed-description-1","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.1 Detailed description","text":"Biomass_borealDataPrep prepares inputs necessary run realistic\nsimulation forest dynamics western Canada boreal forests using\nBiomass_core. Part process involves cleaning input data \nimputing missing data cases, presented thoroughly Data\nacquisition treatment.cleaning formatting raw input data, module prepares:invariant species traits – spatio-temporally constant traits \nmostly influence population dynamics (e.g., growth, mortality, dispersal)\nresponses fire, include probabilities germination \ngiven species tolerance site shade combination (suffiencientLight\ntable) link species shade tolerance values (shadetolerance) \nsite shade (determined minRelativeB) simulate germination success \ngiven pixel;invariant species traits – spatio-temporally constant traits \nmostly influence population dynamics (e.g., growth, mortality, dispersal)\nresponses fire, include probabilities germination \ngiven species tolerance site shade combination (suffiencientLight\ntable) link species shade tolerance values (shadetolerance) \nsite shade (determined minRelativeB) simulate germination success \ngiven pixel;spatially-varying species traits – traits vary ecolocation, \nspatial grouping biophysically similar pixels. maximum biomass\n(maxB), maximum -ground net primary productivity (maxANPP) \nspecies establishment probability (SEP);spatially-varying species traits – traits vary ecolocation, \nspatial grouping biophysically similar pixels. maximum biomass\n(maxB), maximum -ground net primary productivity (maxANPP) \nspecies establishment probability (SEP);one ecolocation-specific parameter – shade thresholds result \nsuccessful germination (minimum relative biomass, minRelativeB);one ecolocation-specific parameter – shade thresholds result \nsuccessful germination (minimum relative biomass, minRelativeB);species cohort table (cohortData) corresponding map\n(pixelGroupMap) used initialise track cohorts across landscape.species cohort table (cohortData) corresponding map\n(pixelGroupMap) used initialise track cohorts across landscape.default, ecolocations defined spatial combination ecodistricts\nNational Ecological Framework Canada, broad-scale polygon system\ncaptures sub-regional variation, Land Cover Canada 2010 map, \nraster-based database distinguishes several forest non-forest\nland-cover types. Biomass_core simulates trees,\nBiomass_borealDataPrep prepares inputs estimates parameters pixels\nwithin forested land-cover classes (see Defining simulation pixels \necolocations).Note ecolocations called ecoregionGroup’s across LandR modules.studyAreaLarge supplied, module uses parameter\nestimation account larger spatial variability. begins calculating\nspecies biomass per pixel, multiplying observed species (ref:percent) cover\nobserved stand biomass adjustment factor, can \nstatistically calibrated study area (default value can also used\ninstead P(sim)$fitDeciduousCoverDiscount == FALSE). Given adjusts\nspecies biomass, calibration step contributes calibration \nmaxB maxANPP trait values, whose estimation also based species\nbiomass. Biomass_borealDataPrep estimates maxB, maxANPP SEP\nspecies biomasses per pixel using linear mixed effects models (LMEMs) \ndefault (see Maximum biomass maximum aboveground net primary productivity\nSpecies establishment probability).Invariant species traits, probabilities germination given shade\ntolerance site shade biomass thresholds defining site shade levels\n(minRelativeB) obtained combination published literature (e.g.,\nlongevity values followed Burton & Cumming 1995) values used LANDIS-II applications\nCanada’s boreal forests. Default minRelativeB values kept constant\nacross ecolocations due lack data needed derive\necolocation-specific values (see Minimum relative biomass). also\nadjusted lowering values higher shade classes reflect lower shade\nlevels observed Western Canadian forests respect Eastern\ncounterparts similar density levels (Messier et al. 1998), likely\ndriven higher moisture limitation west (Hogg et al. 2008; Peng et al. 2011).\nadjustment can -passed either supplying minRelativeB table, \nalternative function call P(sim)$minRelativeBFunction (default\nLandR::makeMinRelativeB; see Minimum relative biomass \ndetail).parameter estimation, Biomass_borealDataPrep performs data-based\nlandscape initialisation, creating tree species cohorts forested pixels\nage equal observed stand age previously calculated biomass.next sections, describe greater detail various data processing\nparameter estimation steps carried Biomass_borealDataPrep.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"data-acquisition-and-treatment","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.2 Data acquisition and treatment","text":"two objects user must supply shapefiles define \nstudy area used derive parameters (studyAreaLarge) study area \nsimulation happen (studyArea). two objects can identical \nuser chooses parametrise run simulations area. \nidentical, studyArea must fully within studyAreaLarge. \nstudyAreaLarge studyArea Canada, module able \nautomatically estimate prepare input parameters objects \nBiomass_core, default raw data FAIR data (sensu Wilkinson et al. 2016) national-scale.inputs supplied, Biomass_borealDataPrep create raster\nversions rasterize studyAreaLarge studyArea (rasterToMatchLarge \nrasterToMatch, respectively), using stand biomass map layer\n(rawBiomassMap) template (.e., source information spatial\nresolution)","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"defining-simulation-pixels-and-ecolocations","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.2.1 Defining simulation pixels and ecolocations","text":"Biomass_borealDataPrep uses land-cover data define assign parameter\nvalues pixels forest dynamics simulated (forested pixels).default uses land-cover classes Land Cover Map Canada 2010 v1\nproduct. Pixels classes 1 6 included forested pixels. \npossible supply land-cover products include transient\ncover types (e.g., recent burns) user may pass vector transient class\nIDs (via LCCClassesToReplaceNN) reclassified “stable”\nforested class. reclassification done searching focal\nneighbourhood replacement forested cover class (radius 1250m\nfocal cell). forested class found within perimeter, \npixel used simulate forest dynamics. Reclassified pixels omitted\nfitting statistical models used parameter estimation, \nassigned predicted values models.Sub-regional spatial variation maxBiomass, maxANPP, SEP species\ntraits accounted ecolocation. Ecolocations used proxies \nbiophysical variation across landscape estimating model parameters \nvary spatially. default, defined combination \n“ecodistricts” National Ecological Framework Canada \nland cover, user can change supplying different ecozonation \nland-cover layers.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"species-cover","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.2.2 Species cover","text":"Species percent cover ((ref:percent) cover) can automatically obtained \npre-processed Biomass_borealDataPrep. module ensures : 1. data\nuse geospatial geometries; 2. layers correctly\nre-projected studyAreaLarge rasterToMatchLarge; 3. species \ncover values 10(ref:percent) excluded.default uses species (ref:percent) cover rasters derived MODIS\nsatellite imagery 2001, obtained Canadian National Forest\nInventory (Beaudoin et al. 2017) – hereafter ‘kNN species data’.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"initial-species-age-and-biomass-per-pixel","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.2.3 Initial species age and biomass per pixel","text":"Stand age stand aboveground biomass (hereafter ‘stand biomass’) used \nderive parameters define initial species age biomass across \nlandscape. also derived MODIS satellite imagery 2001 prepared\nNFI (Beaudoin et al. 2017), default. Biomass_borealDataPrep downloads\ndata performs number data harmonization operations deal \ndata inconsistencies.first searches mismatches stand age (standAge), stand biomass\n(standB) total stand cover (standCover), assuming cover \naccurate three, biomass least, following order:Pixels standCover < 5% removed;Pixels standCover < 5% removed;Pixels standAge == 0, assigned standB == 0;Pixels standAge == 0, assigned standB == 0;Pixels standB == 0, assigned standAge == 0.Pixels standB == 0, assigned standAge == 0., species assigned one cohort per pixel according corrected stand\nage, stand biomass (ref:percent) cover values. Cohort age assumed \nstand age biomass product stand biomass species\n(ref:percent) cover. , stand cover rescaled vary 0\n100(ref:percent).next set data inconsistencies cohort age (age), biomass (B) \ncover (cover) looked solved following order:cover > 0 age == 0, B set 0 (stand biomass\nrecalculated);cover > 0 age == 0, B set 0 (stand biomass\nrecalculated);cover == 0 age > 0, age == NA, age empirically\nestimated using remainder data fit model supplied \nP(sim)$imputeBadAgeModel, defaults :cover == 0 age > 0, age == NA, age empirically\nestimated using remainder data fit model supplied \nP(sim)$imputeBadAgeModel, defaults :Cohort biomass adjusted reflect different cover biomass\nrelationship conifer broadleaf species (see Adjustment species\nbiomass).","code":"## [[1]]\n## lme4::lmer(age ~ log(totalBiomass) * cover * speciesCode + (log(totalBiomass) | \n##     initialEcoregionCode))"},{"path":"landr-biomass_borealdataprep-module.html","id":"replacing-initial-biomass-and-age-within-known-fire-perimeters","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.2.4 Replacing initial biomass and age within known fire perimeters","text":"Taking two independent datasets stand age stand biomass can causes\ndiscrepancies, e.g. stand age = 5 aboveground biomass = 10000 m2/ha. \nmay due errors coming ) stand replacing disturbance reset age\nzero years , biomass layer zeroed, b) \ndisturbance stand-replacing (leaving biomass), age still zeroed.\nmeans either, aboveground biomass wrong age .Options address include 1) get better data two variables \ncontradict one another (currently available us) 2) estimate one\n. obvious way decide one incorrect, unless\nindependent data source.current Biomass_borealDataPrep module, chose correct . \nP(sim)$fireURL provided P(sim)$overrideBiomassInFires TRUE,fire\nperimeters used source information age, Biomass_core \ngenerates biomass based estimated growth parameters known species\npresence/absence (species cover layers).assumes 1) recorded fires stand-replacing, time since fire\nnew stand age 2) first year simulation later \nfirst fire year fire perimeter data. biomass spin-\nBiomass_core run pixels, new stand age\n(.e., time since last fire). spin-started age = 0 \nbiomass = 0 species present pixels, grow time\nsince last fire achieved. resulting species biomass used \ninitial biomass values species cohort actual simulation.user want assume 1) doesn’t wand perform \nimputation, step can bypassed setting parameter\nP(sim)$overrideBiomassInFires FALSE P(sim)$fireURL NULL \nNA.Note pixels data imputation can removed simulation\nsetting P(sim)$rmImputedPix == TRUE.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"invariant-species-traits","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.2.5 Invariant species traits","text":"species traits vary spatio-temporally obtained \navailable species trait tables used LANDIS-II applications Canada’s boreal\nforests (available Dominic Cyr’s GitHub\nrepository). \nadapted minor adjustments match Western Canadian boreal forests\nusing published literature. Others (key growth mortality traits) \nestimated using statistical models.LANDIS-II species trait table contains species trait values \nCanadian Ecozone (NRCan 2013), default filtered Boreal\nShield West (BSW), Boreal Plains (BP) Montane Cordillera Canadian Ecozones\n(via P(sim)$speciesTableAreas). trait values vary across \necozones, , took minimum value used.function LandR::speciesTableUpdate used default \nadjustments trait values table (intended, custom\nfunction call NULL can passed P(sim)$speciesUpdateFunction): -\nLongevity values adjusted match values Burton & Cumming (1995), match\nBSP, BP MC ecozones. adjustments result higher longevity \nspecies; - Shade tolerance values lowered Abies balsamifera, Abies\nlasiocarpa, Picea engelmanii, Picea glauca, Picea mariana, Tsuga\nheterophylla Tsuga mertensiana better relative shade tolerance\nlevels Western Canada. relative shade tolerances, user\nalways check values respect study areas \nspecies pool.user can also pass one function call \nP(sim)$speciesUpdateFunction want make adjustments \naddition listed (see ?LandR::updateSpeciesTable).Finally, probabilities germination (suffiencientLight table) \ntaken default LANDIS-II test\ntable.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"parameter-estimationcalibration","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.3 Parameter estimation/calibration","text":"","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"adjustment-of-species-biomass","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.3.1 Adjustment of species biomass","text":"Biomass_core requires initial values species-specific aboveground biomass\n(B) every pixel tracked. Biomass_borealDataPrep estimates \nbased stand biomass (standB) individual species (ref:percent) cover.\nInitial B estimated species pixel multiplying standB\nspecies (ref:percent) cover. default cover layers \nsatellite-derived, relationship relative cover relative biomass\nbroadleaf conifer species needs adjusted reflect different\ncanopy architectures (using P(sim)$deciduousCoverDiscount).default, Biomass_borealDataPrep uses previously estimated\nP(sim)$deciduousCoverDiscount based Northwest Territories data.\nHowever, user can chose re-estimate setting\nP(sim)$fitDeciduousCoverDiscount == TRUE. case, default\nBiomass_borealDataPrep fit following model:relates estimated biomass (B) interaction term \nlog-age (logAge), standB (‘totalBiomass’ ), speciesCode (.e. species\nID) land cover (‘lcc’ ). model fitted standB \nspecies cover studyAreaLarge, using optimization routine searches\nbest conversion factor broadleaf species cover B \nminimizing AIC.","code":"## [[1]]\n## glm(I(log(B/100)) ~ logAge * I(log(totalBiomass/100)) * speciesCode * \n##     lcc)"},{"path":"landr-biomass_borealdataprep-module.html","id":"maximum-biomass-and-maximum-aboveground-net-primary-productivity","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.3.2 Maximum biomass and maximum aboveground net primary productivity","text":"Biomass_borealDataPrep statistically estimates maximum biomass (maxB),\nmaximum aboveground net primary productivity (maxANPP) using processed\nspecies ages biomass.maxB estimated modelling response species-specific biomass (B)\nspecies age cover, accounting variation among ecolocations\n(ecoregionGroup ):coefficients estimated maximum likelihood model fit calculated\nproportion explained variance explained fixed effects \n(marginal r2) entire model (conditional r2) – \nprinted messages.model can take fit, possible sample pixels\nwithin species ecolocation combination via \nP(sim)$subsetDataBiomassModel parameter. module also attempts refit \nstatistical model re-sampling data, re-fitting lmer bobyqa\noptimizer, re-scaling continuous predictors (cover logAge) \nconvergence issues P(sim)$fixModelBiomass == TRUE. steps\ntried additively convergence issue resolved. module \nstill unable solve converge issue message printed module\nuses last model refit. Note convergence issues usually\nproblematic parameter estimation - estimation parameter standard\nerrors. However, user always inspect final model (especially \nconverged) make sure problems significant – \nalternative model call can supplied via P(sim)$biomassModel\nparameter. Note supplying model call use lme4::lmer\nrefitting process likely fail may turned (via \nP(sim)$fixModelBiomass parameter).Another consideration add, respect estimation maxB, \nchoosing linear model relate B ~ log(age) + cover. \nideal ecological point view, biomass unlikely vary linearly\nage cover, likely saturate beyond certain high value \ncover follow hump-shaped curve age (.e., reaching maximum values \ngiven age, starting decrease trees approach longevity). Also,\nfitting linear model can lead negative B values young ages low\ncover. Despite fitting non-linear curves appropriate, \ntests revealed linear mixed effects model producing abnormal\nestimates B maximum values age cover (maxB estimates), \nleveraging powerful statistical machinery lme4.Finally, highlight modelling log(B) appropriate solution,\nwrongly assume exponential relationship \nB ~ log(age) + cover, leading serious overestimation maxB(Fig.\n5.1) steep increases species biomasses\nfirst years simulation (Fig. 5.2).\nFigure 5.1: Modelling biomass linear vs. exponential relationship. ) modelBiomass B ~ logAge * speciesCode + cover * speciesCode + (logAge + cover | ecoregionGroup). b) modelBiomass logB ~ logAge * speciesCode + cover * speciesCode + (logAge + cover | ecoregionGroup). Blue dots marginal mean B values (back-transformed b) cross ages confidence intervals bars.\n\nFigure 5.2: Thirty years simulation maxB values estimated logB ~ ... biomassModel (see Fig. 5.1). steep increase little time abnormal.\nmaxB predicted species ecolocation combination, setting\nspecies cover 100(ref:percent) species log-age log species\nlongevity. using Biomass_speciesParameters, maxB calibrated \nspecies can achieve maximum observed biomass simulation.maxANPP calculated maxB * mANPPproportion/100, mANPPproportion\ndefaults 3.33, unless calibrated Biomass_speciesParameters. default\nvalue, 3.33, comes inversion rationale used calculate maxB\nScheller & Mladenoff (2004b). , authors estimated maxANPP using model PnET-II\n(adjusted values manually) estimates calculated\nmaxB multiplying estimated maxANPP 30.","code":"## [[1]]\n## lme4::lmer(B ~ logAge * speciesCode + cover * speciesCode + (logAge + \n##     cover | ecoregionGroup))"},{"path":"landr-biomass_borealdataprep-module.html","id":"minimum-relative-biomass","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.3.3 Minimum relative biomass","text":"Minimum relative biomass (minRelativeB) spatially-varying parameter used\ndetermine shade level pixel.Since found data base parametrisation trait, default values\nbased publicly available values used LANDIS-II applications \nCanada’s boreal forests (available Dominic Cyr’s GitHub\nrepository), \necolocations shared values.Initial runs revealed excessive recruitment moderately shade intolerant\nspecies even stand biomass increased, values shade levels X4 X5\nadjusted downwards (X4: 0.8 0.75; X5: 0.90 0.85) reflect higher\ncompetition resources (e.g. higher water limitation) Western Canadian\nforests regards Eastern Canadian forests (Messier et al. 1998).minimum biomass threshold shade level X0 0 standB.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"species-establishment-probability","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.3.4 Species establishment probability","text":"Species establishment probability (SEP) estimated modelling \nprobability observing given species ecolocation. ,\nBiomass_borealDataPrep models relationship probability \noccurrence species (\\(\\pi\\)) using following model default:whereby probability occurrence species (\\(\\pi\\)) – calculated \nnumber pixels (ref:percent) cover > 0 divided total number \npixels, species within ecolocation – modelled per species \necolocation (ecoregionGroup ) following binomial distribution (\nlogit link). data sub-sampling done fitting SEP\nstatistical model, model fits quite fast even large sample sizes\n(e.g., > 20 million points).SEP predicted species ecolocation combination, setting\nspecies cover 100(ref:percent), integrating predicted values \nlength succession time step (P(sim)$successionTimestep) :important, since seed establishment occurs every\nP(sim)$successionTimestep, thus probabilities seed establishment\nneed temporally integrated reflect probability seed\nestablishing period time. Finally, since observed species cover\nused fit coverModel result seed establishment \nresprouting/clonal growth, final species-specific establishment\nprobabilities calculated function temporally integrated presence\nprobabilities species’ probabilities resprouting (resproutprob, \nspecies table) (bounded 0 1):\\(SEP > 1\\), thenif \\(SEP < 0\\), ","code":"## [[1]]\n## glm(cbind(coverPres, coverNum - coverPres) ~ speciesCode * ecoregionGroup, \n##     family = binomial)"},{"path":"landr-biomass_borealdataprep-module.html","id":"calibrating-species-growthmortality-traits-using-biomass_speciesparameters","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.3.5 Calibrating species growth/mortality traits using Biomass_speciesParameters","text":"using Biomass_borealDataPrep Biomass_speciesParameters, later\nmodule calibrates several species traits first prepared \nBiomass_borealDataPrep: - growthcurve, mortalityshape – initially\ncome publicly available LANDIS-II tables - maxBiomass, maxANPP – \nestimated statistically (see Maximum biomass maximum aboveground net\nprimary productivity)Briefly, Biomass_speciesParameters:Uses ~41,000,000 hypothetical species’ growth curves (generated \nBiomass_core), cover fully factorial combination longevity,\nratio maxANPP maxBiomass, growthcurve, mortalityshape;Uses ~41,000,000 hypothetical species’ growth curves (generated \nBiomass_core), cover fully factorial combination longevity,\nratio maxANPP maxBiomass, growthcurve, mortalityshape;Takes permanent temporary sample plot (PSP) data near study\narea target species, finds hypothetical species’ growth\ncurve closely matches growth curve observed PSP data – \nspecies--species base. gives us species’ growthcurve,\nmortalityshape, mANPPproportion, ratio maximum aboveground net\nprimary productivity (maxANPP) maximum biomass (maxBiomass, \nconfounded maxB) study area.Takes permanent temporary sample plot (PSP) data near study\narea target species, finds hypothetical species’ growth\ncurve closely matches growth curve observed PSP data – \nspecies--species base. gives us species’ growthcurve,\nmortalityshape, mANPPproportion, ratio maximum aboveground net\nprimary productivity (maxANPP) maximum biomass (maxBiomass, \nconfounded maxB) study area.Introduces new parameter, inflationFactor, re-calibrates maxB. \nrecognize maxB, obtained empirically Biomass_borealDataPrep,\neasily reached simulations reasonable values \ngrowthcurve, mortalityshape longevity prevent equation \nreaching maxB (acts asymptote never approached). \ninflationFactor calculated ratio maxBiomass (parameter\nused generate theoretical growth curves step 1) maximum biomass\nactually achieved theoretical growth curves (step 1). maxB \nrecalibrated multiplying inflationFactor. ,\nresulting non-linear growth curves generated Biomass_core simulation\nable achieve empirically estimated maxB.Introduces new parameter, inflationFactor, re-calibrates maxB. \nrecognize maxB, obtained empirically Biomass_borealDataPrep,\neasily reached simulations reasonable values \ngrowthcurve, mortalityshape longevity prevent equation \nreaching maxB (acts asymptote never approached). \ninflationFactor calculated ratio maxBiomass (parameter\nused generate theoretical growth curves step 1) maximum biomass\nactually achieved theoretical growth curves (step 1). maxB \nrecalibrated multiplying inflationFactor. ,\nresulting non-linear growth curves generated Biomass_core simulation\nable achieve empirically estimated maxB.Estimates species-specific maxANPP multiplying final maxB \nmANPPproportion (estimated step 2).Estimates species-specific maxANPP multiplying final maxB \nmANPPproportion (estimated step 2).cases sufficient PSP data perform steps,\nmaxB maxANPP left estimated Biomass_borealDataPrep (see\nMaximum biomass maximum aboveground net primary productivity).","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"agregating-species","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.4 Agregating species","text":"Biomass_borealDataPrep use input table sppEquiv parameter\nP(sim)$sppEquivCol know species identities used \nsimulation (see Input objects Parameters details). user can use\ntable parameter define grouping “merge” species \ninvariant trait values (see Invariant species traits) (e.g. genus-level\ngroup functional group). , user must repeat name \ngroup sppEquivCol column sppEquiv table many times \nspecies grouped:\nTable 5.4: Example species merging simulation. user wants model Abies balsamea, . lasiocarpa Pinus contorta separate species, Picea spp. genus-level group. , six species identified 'KNN' column, (ref:percent) cover layers can obtained, ‘Boreal’ column (defines naming convention used simulation example) Picea spp. name. Biomass_borealDataPrep merge (ref:percent) cover data single layer summing cover per pixel.\ngroups contain species different (invariant) trait values, minimum\nvalue across species used. default species (ref:percent) cover\nlayers, Biomass_borealDataPrep proceeds way \nBiomass_speciesData sums cover across species group per pixel.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"initialization-inputs-and-parameters-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.5 Initialization, inputs and parameters","text":"Biomass_borealDataPrep initializes prepares inputs provided \ninternet access retrieve raw datasets used parametrisation \npreparing input objects Biomass_core. Future users run\nBiomass_borealDataPrep defaults inspect objects like\nsupplying data, alternative data URLs. Alternatively, user\nmay develop module using Biomass_borealDataPrep template.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"input-objects-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.5.1 Input objects","text":"Table 5.5 shows full list \ninput objects used module.\nTable 5.5: List Biomass_borealDataPrep input objects description.\ninputs, following particularly important deserve special\nattention:Spatial layers\necoregionLayer ecoregionRst – shapefile map containing\necological zones.\nrawBiomassMap – map observed stand biomass (\\(g/m^2\\)).\nrstLCC – land-cover raster.\nspeciesLayers – layers species (ref:percent) cover data. \nspecies must match available default (provided) species\ntraits tables (species speciesEcoregion tables).\nstandAgeMap – map observed stand ages (years).\nstudyArea – shapefile. SpatialPolygonsDataFrame single\npolygon determining simulation take place. input\nobject must supplied user.\nstudyAreaLarge – shapefile. SpatialPolygonsDataFrame \nsingle polygon determining statistical models \nparameter estimation fitted. must contain studyArea\nfully, identical. object must supplied \nuser.\nSpatial layersecoregionLayer ecoregionRst – shapefile map containing\necological zones.ecoregionLayer ecoregionRst – shapefile map containing\necological zones.rawBiomassMap – map observed stand biomass (\\(g/m^2\\)).rawBiomassMap – map observed stand biomass (\\(g/m^2\\)).rstLCC – land-cover raster.rstLCC – land-cover raster.speciesLayers – layers species (ref:percent) cover data. \nspecies must match available default (provided) species\ntraits tables (species speciesEcoregion tables).speciesLayers – layers species (ref:percent) cover data. \nspecies must match available default (provided) species\ntraits tables (species speciesEcoregion tables).standAgeMap – map observed stand ages (years).standAgeMap – map observed stand ages (years).studyArea – shapefile. SpatialPolygonsDataFrame single\npolygon determining simulation take place. input\nobject must supplied user.studyArea – shapefile. SpatialPolygonsDataFrame single\npolygon determining simulation take place. input\nobject must supplied user.studyAreaLarge – shapefile. SpatialPolygonsDataFrame \nsingle polygon determining statistical models \nparameter estimation fitted. must contain studyArea\nfully, identical. object must supplied \nuser.studyAreaLarge – shapefile. SpatialPolygonsDataFrame \nsingle polygon determining statistical models \nparameter estimation fitted. must contain studyArea\nfully, identical. object must supplied \nuser.Tables\nspeciesTable – table invariant species traits must \nfollowing columns (even necessary simulation):\n“species”, “Area”, “longevity”, “sexualmature”, “shadetolerance”,\n“firetolerance”, “seeddistance_eff”, “seeddistance_max”, “resproutprob”,\n“resproutage_min”, “resproutage_max”, “postfireregen”, “leaflongevity”,\n“wooddecayrate”, “mortalityshape”, “growthcurve”, “leafLignin”,\n“hardsoft”. columns names can different order. See\nScheller & Miranda (2015a) details columns.\nTablesspeciesTable – table invariant species traits must \nfollowing columns (even necessary simulation):\n“species”, “Area”, “longevity”, “sexualmature”, “shadetolerance”,\n“firetolerance”, “seeddistance_eff”, “seeddistance_max”, “resproutprob”,\n“resproutage_min”, “resproutage_max”, “postfireregen”, “leaflongevity”,\n“wooddecayrate”, “mortalityshape”, “growthcurve”, “leafLignin”,\n“hardsoft”. columns names can different order. See\nScheller & Miranda (2015a) details columns.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"parameters-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.5.2 Parameters","text":"Table 5.6 lists parameters used\nBiomass_borealDataPrep detailed information.\nTable 5.6: List Biomass_borealDataPrep parameters description.\nparameters, following particularly important:Estimation simulation parameters\nbiomassModel – statistical model (function call) used \nestimate maxB maxANPP.\ncoverModel – statistical model (function call) used \nestimate SEP.\nfixModelBiomass – determines whether biomassModel re-fit \nconvergence issues arise.\nimputeBadAgeModel – model used impute ages missing,\nmatch input cover biomass data. confounded\ncorrecting ages fire data\nsubsetDataAgeModel subsetDataBiomassModel – control data\nsub-sampling fitting imputeBadAgeModel biomassModel,\nrespectively\nexportModels – controls whether biomassModel coverModel (\n) exported simulation simList, can \nuseful inspect fitted models report statistical fit.\nsppEquivCol – character. column name speciesEquivalency\ndata.table defines naming convention use throughout \nsimulation.\nEstimation simulation parametersbiomassModel – statistical model (function call) used \nestimate maxB maxANPP.biomassModel – statistical model (function call) used \nestimate maxB maxANPP.coverModel – statistical model (function call) used \nestimate SEP.coverModel – statistical model (function call) used \nestimate SEP.fixModelBiomass – determines whether biomassModel re-fit \nconvergence issues arise.fixModelBiomass – determines whether biomassModel re-fit \nconvergence issues arise.imputeBadAgeModel – model used impute ages missing,\nmatch input cover biomass data. confounded\ncorrecting ages fire dataimputeBadAgeModel – model used impute ages missing,\nmatch input cover biomass data. confounded\ncorrecting ages fire datasubsetDataAgeModel subsetDataBiomassModel – control data\nsub-sampling fitting imputeBadAgeModel biomassModel,\nrespectivelysubsetDataAgeModel subsetDataBiomassModel – control data\nsub-sampling fitting imputeBadAgeModel biomassModel,\nrespectivelyexportModels – controls whether biomassModel coverModel (\n) exported simulation simList, can \nuseful inspect fitted models report statistical fit.exportModels – controls whether biomassModel coverModel (\n) exported simulation simList, can \nuseful inspect fitted models report statistical fit.sppEquivCol – character. column name speciesEquivalency\ndata.table defines naming convention use throughout \nsimulation.sppEquivCol – character. column name speciesEquivalency\ndata.table defines naming convention use throughout \nsimulation.Data processing\nforestedLCCClasses LCCClassesToReplaceNN – define \nland-cover classes rstLCC forested \nreclassified forested classes, respectively.\ndeciduousCoverDiscount, coverPctToBiomassPctModel \nfitDeciduousCoverDiscount – first adjustment factor \nbroadleaf species cover biomass relationships; second third\nmodel used refit deciduousCoverDiscount supplied\nstudyAreaLarge whether refitting attempted\n(respectively).\nData processingforestedLCCClasses LCCClassesToReplaceNN – define \nland-cover classes rstLCC forested \nreclassified forested classes, respectively.forestedLCCClasses LCCClassesToReplaceNN – define \nland-cover classes rstLCC forested \nreclassified forested classes, respectively.deciduousCoverDiscount, coverPctToBiomassPctModel \nfitDeciduousCoverDiscount – first adjustment factor \nbroadleaf species cover biomass relationships; second third\nmodel used refit deciduousCoverDiscount supplied\nstudyAreaLarge whether refitting attempted\n(respectively).deciduousCoverDiscount, coverPctToBiomassPctModel \nfitDeciduousCoverDiscount – first adjustment factor \nbroadleaf species cover biomass relationships; second third\nmodel used refit deciduousCoverDiscount supplied\nstudyAreaLarge whether refitting attempted\n(respectively).","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"outputs","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.5.3 Outputs","text":"Tables\ncohortData – initial community table, containing corrected biomass\n(g/m2), age species cover data, well ecolocation \npixelGroup information. table defines initial community\ncomposition structure used Biomass_core.\nspecies – table invariant species traits. contain \ntraits speciesTable , adjusted necessary.\nspeciesEcoregion – table spatially-varying species traits (maxB,\nmaxANPP, SEP).\nminRelativeB – minimum relative biomass thresholds determine \nshade level pixel. X0-5 represent site shade classes \n-shade (0) maximum shade (5).\nsufficientLight – probability germination species shade\ntolerance (species) shade level(defined byminRelativeB`)\nTablescohortData – initial community table, containing corrected biomass\n(g/m2), age species cover data, well ecolocation \npixelGroup information. table defines initial community\ncomposition structure used Biomass_core.cohortData – initial community table, containing corrected biomass\n(g/m2), age species cover data, well ecolocation \npixelGroup information. table defines initial community\ncomposition structure used Biomass_core.species – table invariant species traits. contain \ntraits speciesTable , adjusted necessary.species – table invariant species traits. contain \ntraits speciesTable , adjusted necessary.speciesEcoregion – table spatially-varying species traits (maxB,\nmaxANPP, SEP).speciesEcoregion – table spatially-varying species traits (maxB,\nmaxANPP, SEP).minRelativeB – minimum relative biomass thresholds determine \nshade level pixel. X0-5 represent site shade classes \n-shade (0) maximum shade (5).minRelativeB – minimum relative biomass thresholds determine \nshade level pixel. X0-5 represent site shade classes \n-shade (0) maximum shade (5).sufficientLight – probability germination species shade\ntolerance (species) shade level(defined byminRelativeB`)sufficientLight – probability germination species shade\ntolerance (species) shade level(defined byminRelativeB`)Spatial layers\nbiomassMap – map initial stand biomass values adjustments\ndata mismatches.\npixelGroupMap – map containing pixelGroup IDs per pixel. \ndefines initial map used hashing within Biomass_core, \nconjunction cohortData.\necoregionMap – map ecolocations.\nSpatial layersbiomassMap – map initial stand biomass values adjustments\ndata mismatches.biomassMap – map initial stand biomass values adjustments\ndata mismatches.pixelGroupMap – map containing pixelGroup IDs per pixel. \ndefines initial map used hashing within Biomass_core, \nconjunction cohortData.pixelGroupMap – map containing pixelGroup IDs per pixel. \ndefines initial map used hashing within Biomass_core, \nconjunction cohortData.ecoregionMap – map ecolocations.ecoregionMap – map ecolocations.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"simulation-flow-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.2.6 Simulation flow","text":"general flow Biomass_borealDataPrep processes :Preparation necessary data input objects require\nparameter fitting (e.g., invariant species traits table, creating\necolocations);Preparation necessary data input objects require\nparameter fitting (e.g., invariant species traits table, creating\necolocations);Fixing mismatched raw cover, biomass age data;Fixing mismatched raw cover, biomass age data;Imputing age values pixels mismatches exist age data missing;Imputing age values pixels mismatches exist age data missing;Construction initial data.table cohort biomass age per pixel\n(ecolocation information);Construction initial data.table cohort biomass age per pixel\n(ecolocation information);Sub-setting pixels forested land-cover classes (optional) converting\ntransient land-cover classes forested classes;Sub-setting pixels forested land-cover classes (optional) converting\ntransient land-cover classes forested classes;Fitting coverModel;Fitting coverModel;Fitting biomassModel (re-fitting necessary – optional);Fitting biomassModel (re-fitting necessary – optional);Estimating maxB, maxANPP SEP per species ecolocation.Estimating maxB, maxANPP SEP per species ecolocation.(Optional) Correcting ages pixels inside fire perimeters reassigning\nbiomass.(Optional) Correcting ages pixels inside fire perimeters reassigning\nbiomass.(Optional) Plots maxB, maxANPP SEP maps.(Optional) Plots maxB, maxANPP SEP maps.","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"usage-example-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.3 Usage example","text":"module can run stand-alone, won’t much prepare\ninputs Biomass_core. Hence, provide usage example module \nothers \nrepository \nBarros et al. (n.d.).","code":""},{"path":"landr-biomass_borealdataprep-module.html","id":"references-2","chapter":"5 LandR Biomass_borealDataPrep Module","heading":"5.4 References","text":"","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"landr-biomass_speciesparameters-module","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6 LandR Biomass_speciesParameters Module","text":"\ndocumentation work progress. Potential discrepancies omissions\nmay exist time . find , contact us using link\n^^","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"authors-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.0.0.1 Authors:","text":"Ian Eddy ian.eddy@nrcan-rncan.gc.ca [aut, cre], Eliot McIntire eliot.mcintire@nrcan-rncan.gc.ca [aut]\n","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"module-overview-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1 Module Overview","text":"","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"module-summary-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1.1 Module summary","text":"module attempts calibrate species growth mortality trait values used\nBiomass_core, matching theoretical species’ growth curves obtained \ndifferent trait values (generated LandR Biomass_speciesFactorial; see\nSimulated species data) observed growth curves derived Permanent\nSample Plots (PSP data) across Canada (see Permanent sample plot data), \nfind combination traits allows better match observed\ncurves. particular, calibrates growthcurve, mortalityshape,\nmaxANPP maxB traits (see Parameter estimation/calibration).module prepare traits parameters used \nBiomass_core meant used conjunction another data\nmodule (e.g. Biomass_borealDataPrep). However, may used\nstand-alone initial phase easier inspection statistical\ncalibration procedure.Note Google Account necessary access data.2022-03-29, PSP data needed module freely\navailable, data sharing agreements must obtained governments \nSK, AB, BC.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"module-inputs-and-parameters-at-a-glance-2","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1.2 Module inputs and parameters at a glance","text":"Biomass_speciesParameters requires internet connection authorized\naccess default data used calibration (e.g., theoretical species\ngrowth curves PSD data).advise future users run Biomass_speciesParameters defaults \ninspect objects like supplying data trying \nrun Biomass_speciesFactorial generate theoretical curves.full lists input objects (Table\n6.1) parameters (Table\n6.2) \nBiomass_speciesParameters expects. inputs must provided\n(.e., Biomass_speciesParameters default ) \nstudyAreaANPP (study area used extract PSP data ). input\nobjects parameters internal defaults, user may need request\naccess online files (see Tables\n6.4 \n6.5).\nTable 6.1: List Biomass_speciesParameters input objects description.\n\nTable 6.2: List Biomass_speciesParameters parameters description.\n","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"events-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1.3 Events","text":"following events take place Biomass_speciesParameters run. Note\nmodule runs (one “time step”) executes one event\n(init).Module initiation (init event): downloading necessary data\n(.inputObjects event), module prepares necessary\nobjects parameters simulation performs calibration (see\nDetailed description).See Simulation flow detail.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"module-outputs-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1.4 Module outputs","text":"module produces following outputs (Table\n6.3):\nTable 6.3: List Biomass_speciesParameters output objects description.\n","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"links-to-other-modules-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1.5 Links to other modules","text":"Intended used another data module, like Biomass_borealDataPrep,\nprepare traits parameters Biomass_core. can\nsee potential module linkages within LandR ecosystem\n. Select\nBiomass_speciesParameters drop-menu see linkages.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"getting-help-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.1.6 Getting help","text":"https://github.com/PredictiveEcology/Biomass_speciesParameters/issues","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"module-manual-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2 Module manual","text":"","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"detailed-description-2","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.1 Detailed description","text":"Tree cohort growth mortality Biomass_core essentially determined \nfive parameters: growthcurve, mortalityshape, maximum biomass (maxB),\nmaximum aboveground net primary productivity (maxANPP) longevity.growthcurve mortalityshape parameters (called ‘growth curve’ \n‘mortality shape’ LANDIS-II Biomass Succession Extension v3.2, base model\nBiomass_core) strongly modulate shape species growth curves \nimportant calibrated study area question.Also, growth mortality equations used Biomass_core non-linear\nresulting actual biomass accumulation curve emergent phenomenon\ndue competition effects. means ideal trait/parameter values\nestimated single species basis, resulting dynamics \ndifferent multi-species context.Biomass_speciesParameters module attempts address issues (\nleast partially) using “curve-matching” approach. compares GAMM\n fitted permanent\nsample plot (PSP) data large collection theoretical species curves, \nrepresenting different set growth mortality parameters (growthcurve\nmortalityshape, respectively).module generally follows data modules, like Biomass_boreaDataPrep,\nalso attempts calibrate previously estimated spatially varying species\ntraits (maxB maxANPP).","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"permanent-sample-plot-data","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.1.1 Permanent sample plot data","text":"Biomass_speciesParameters can use PSP data available (note may\nspan several thousands kilometres), select data based shapefile\n(studyAreaANPP; see Input objects).default, PSP data obtained National Forest Inventory (NFI),\nAlberta Ministry Agriculture, Saskatchewan Ministry \nEnvironment, British Columbian Ministry Forests, Lands, Natural\nResource Operations, Rural Development. data previously treated\nerrors standardized single dataset exact location \nidentifying attributes anonymized.data include individual species diameter breast height (DBH)\nmeasurements tree plot, well stand age. part \nstandardization process, dead trees removed dataset. Tree biomass\nderived DBH using model Lambert et al. (2005) summed \nplot. Lastly, proportional biomass species calculated every\nindividual measurement plot.Note model used calculate biomass can changed Ung et al. (2008) via\nP(sim)$biomassModel module parameter.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"simulated-species-data","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.1.2 Simulated species data","text":"default dataset theoretical species curves (biomass accumulation curves,\nprecise) generated running simplified Biomass_core\nsimulation reproduction, competition, disturbance, dispersal effects, \nsingle cohort single pixel. simulation varied combination \nspecies trait values influence growth mortality dynamics, namely:\ngrowthcurve, mortalityshape, longevity mANPPproportion, ratio \nmaximum aboveground net primary productivity (maxANPP) maximum biomass\n(maxBiomass). growthcurve values varied 0 1, increments 0.1;\nmortalityshape varied 5 25, increments 1; longevity varied\n150 700 increments 25; mANPPproportion varied 0.25 10 \nincrements 0.25; maxBiomass kept constant 5000.resulted 200,000 combinations parameter values.Results simulations compiled table accessed \nBiomass_speciesParameters, module can run without needing \nre-simulate theoretical curves.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"parameter-estimationcalibration-1","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.1.3 Parameter estimation/calibration","text":"Biomass_speciesParameters calibrates growthcurve, mortalityshape, maxB\nmaxANPP matching theoretical species curves observed\nspecies growth curves permanent sample plot (PSP) data. attempt\ncalibrate longevity, feel parameter obtained \npublished sources. maxB maxANPP calibrated using parameter\nmANPPproportion, reflects relationship .calculating observed species growth curves, module subsets \nPSP data stand ages 95th percent quantile species (can\nchanged via P(sim)$quantileAgeSubset module parameter), records \nlarger age classes limited constituted statistical outliers. \nspecies, changing quantile value may improve results, however. Two examples\nPinus banksiana Populus sp, using 99th percent\nquantile improved models, short-lived species \ndata advanced ages scarce.module attempts use “pure” stands estimate parameters, balancing\nsample size (see biomass weighting ). Hence, given species, \nincludes plots species’ relative biomass least 50% (e.g. \nPopulus tremuloides, plots included 50% stand biomass \ncomposed P. tremuloides).addition, 50 points added origin (age = 0 biomass = 0) \nforce intercept essentially 0 age 0 biomass.Observed growth curves species modelled using generalized\nadditive mixed models (GAMMs) relate species biomass (\\(B\\)) stand age\n(\\(standAge\\)), accounting random effects measurement year\n(\\(measureYear\\)) plot (\\(plotID\\)) intercept:\\(f_{1}\\) denotes smoother function. avoid overfitting, module\nconstrains smoother stand age maximum smoothing degree 3 (.e. 3\nknots polynomial degree 2) point constraint 0 attempts \nforce intercept 0, default. smoother degree constraint, however,\ncan changed via P(sim)$GAMMknots module parameter.addition, \\(B\\) weighted respect species dominance. consisted\n1) calculating average biomass dominant species (.e. relative\nbiomass plot > 0.5; \\(domSpeciesB_{1}\\)), plot measurement year,\n2) dividing species average biomass average biomass across \nn dominant species (\\(allDomSpeciesB\\)):added 0 age 0 biomass data module uses weights equal 1.possible selected species enough data allow \nmodel convergence. case, Biomass_speciesParameters skips parameter\ncalibration, parameter values remain unchanged.species GAMM calculated, Biomass_speciesParameters compares \ntheoretical curves, picks best one based maximum likelihood.\nbest theoretical curve associated given combination \ngrowthcurve, mortalityshape maxANPPproportion values, \nused directly calibrated values, case growthcurve \nmortalityshape, calibrate maxANPP case maxANPPproportion\n(see ).user option constrain values growthcurve \nmortalityshape parameters. default, growthcurve forced 0.5,\nmortalityshape allowed vary 15 25, mANPPproportion\n2.0 5.0 (see module parameters P(sim)$constrainGrowthCurve,\nP(sim)constrainMortalityShape P(sim)constrainMaxANPP). boundary\nvalues based preliminary runs analyses using default data \nmay apply datasets, different spatial subsets default\ndata.boundary values used, Biomass_speciesParameters subsets theoretical\nspecies growth curves trait values within selected boundaries.\nSimilarly, module selects theoretical curves longevity values\nmatching used supplied traits table (species input object; see\nInput objects)Since simulated growth curves never achieve maximum biomass parameter (\nmaxBiomass parameter set 5000 simulations theoretical species\ncurves, maxB parameter Biomass_core simulations), acts \nasymptotic limit reflects potential maximum biomass species \necolocation (ecological zone land cover combination),\nBiomass_speciesParameters uses uses relationship achieved\nmaximum biomass potential maximum biomass (maxBiomass), rescale \nmaxB values estimated data using upstream module (e.g.\nBiomass_borealDataPrep). way, species dynamics simulated \nBiomass_core able achieve maximum observed biomasses (used \ninitially estimate maxB).Finally, module calibrates maxANPP using mANPPproportion value \nbest matching theoretical growth curve :maxB already calibrated version. cases \nsufficient PSP data fit GAMMs perform calibration,\nmANPPproportion defaults 3.33, corresponds value used \nLANDIS-II applications Canada’s boreal forests. already stated , \nfinal maxANPP value constrained 2.0 5.0 default.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"initialization-inputs-and-parameters-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.2 Initialization, inputs and parameters","text":"Biomass_speciesParameters initializes prepares inputs provided\nactive internet connection user access data (\nGoogle Account )","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"input-objects-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.2.1 Input objects","text":"Table 6.4 shows full list \ninput objects used module.\nTable 6.4: List Biomass_speciesParameters input objects description.\ninputs, following particularly important deserve special\nattention:Spatial layers\nstudyAreaANPP – shapefile. SpatialPolygonsDataFrame single\npolygon determining PSP subset simulation\ntake place. input object must supplied user.\nSpatial layersstudyAreaANPP – shapefile. SpatialPolygonsDataFrame single\npolygon determining PSP subset simulation\ntake place. input object must supplied user.Tables\nspeciesTableFactorial cohortDataFactorial – tables \nspecies trait combinations theoretical species grwoth curve data\n(respectively)\nPSPmeasure_sppParams, PSPplot_sppParams PSPgis_sppParams – tree measurement, biomass growth\ngeographical data PSP datasets used buildi observed\nspecies growth curves.\nspecies – table invariant species traits may \nproduced another module. must contain columns ‘species’,\n‘growthcurve’ ‘mortality shape’, whose values calibrated.\nspeciesEcoregion – table spatially-varying species traits may\nproduced another module. must contain columns\n‘speciesCode’, ‘maxB’ ‘maxANPP’ ‘ecoregionGroup’ (\necolocation ID). ‘maxB’ ‘maxANPP’ values calibrated \nspecies.\nTablesspeciesTableFactorial cohortDataFactorial – tables \nspecies trait combinations theoretical species grwoth curve data\n(respectively)PSPmeasure_sppParams, PSPplot_sppParams PSPgis_sppParams – tree measurement, biomass growth\ngeographical data PSP datasets used buildi observed\nspecies growth curves.species – table invariant species traits may \nproduced another module. must contain columns ‘species’,\n‘growthcurve’ ‘mortality shape’, whose values calibrated.speciesEcoregion – table spatially-varying species traits may\nproduced another module. must contain columns\n‘speciesCode’, ‘maxB’ ‘maxANPP’ ‘ecoregionGroup’ (\necolocation ID). ‘maxB’ ‘maxANPP’ values calibrated \nspecies.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"parameters-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.2.2 Parameters","text":"Table 6.5 lists parameters\nused Biomass_speciesParameters detailed information.\nTable 6.5: List Biomass_speciesParameters parameters description.\nparameters, following particularly important:Calibration parameters\nGAMMiterations GAMMknots – control number iterattions\nsmoother degree used fit GAMMs, respectively.\nconstrainGrowthCurve, constrainMortalityShape constrainMaxANPP\n– determine upper lower boundaries calibrated values \ngrowthcurve, mortalityshape maxANPP, respectively.\nCalibration parametersGAMMiterations GAMMknots – control number iterattions\nsmoother degree used fit GAMMs, respectively.GAMMiterations GAMMknots – control number iterattions\nsmoother degree used fit GAMMs, respectively.constrainGrowthCurve, constrainMortalityShape constrainMaxANPP\n– determine upper lower boundaries calibrated values \ngrowthcurve, mortalityshape maxANPP, respectively.constrainGrowthCurve, constrainMortalityShape constrainMaxANPP\n– determine upper lower boundaries calibrated values \ngrowthcurve, mortalityshape maxANPP, respectively.Data processing\nminimumPlotsPerGamm – define minimum number PSP plots needed \nfit GAMMs.\nPSPperiod – PSP data period use.\nquantileAgeSubset – upper quantile age value used subset PSP data.\nData processingminimumPlotsPerGamm – define minimum number PSP plots needed \nfit GAMMs.minimumPlotsPerGamm – define minimum number PSP plots needed \nfit GAMMs.PSPperiod – PSP data period use.PSPperiod – PSP data period use.quantileAgeSubset – upper quantile age value used subset PSP data.quantileAgeSubset – upper quantile age value used subset PSP data.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"outputs-1","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.2.3 Outputs","text":"Tables\nspecies speciesEcoregion – tables calibrated trait values.\nspeciesGAMMs – fitted GAMM model objects species.\nTablesspecies speciesEcoregion – tables calibrated trait values.species speciesEcoregion – tables calibrated trait values.speciesGAMMs – fitted GAMM model objects species.speciesGAMMs – fitted GAMM model objects species.","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"simulation-flow-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.2.3 Simulation flow","text":"general flow Biomass_speciesParameters processes :Preparation necessary data input objects require\nparameter fitting (e.g., theoretical species growth curve data);Preparation necessary data input objects require\nparameter fitting (e.g., theoretical species growth curve data);Sub-setting PSP data calculating observed species growth curves\nusing GAMMs;Sub-setting PSP data calculating observed species growth curves\nusing GAMMs;Finding theoretical species growth curve best matches observed\ncurve, species, within curves produced similar longevity\nvalues species traits table (species) \ngrowthcurve mortalityshape values within chosen boundaries\n(P(sim)$constrainGrowthCurve, P(sim)$constrainMortalityShape);Finding theoretical species growth curve best matches observed\ncurve, species, within curves produced similar longevity\nvalues species traits table (species) \ngrowthcurve mortalityshape values within chosen boundaries\n(P(sim)$constrainGrowthCurve, P(sim)$constrainMortalityShape);Calibrating maxB maxANPPCalibrating maxB maxANPPAdjusting maxANPP match chosen boundaries\n(P(sim)$constrainMaxANPP)Adjusting maxANPP match chosen boundaries\n(P(sim)$constrainMaxANPP)","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"usage-example-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.3 Usage example","text":"module can run stand-alone, won’t much calibrate\nspecies trait values based dummy input trait values. provide example \n, since may value run module become\nacquainted calibration process explore fitted GAMMs. However,\nremind run example need Google Account, \ngranted access data.realistic usage example module others can found \nrepository \nBarros et al. (n.d.b).","code":""},{"path":"landr-biomass_speciesparameters-module.html","id":"load-spades-and-other-packages.-1","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.3.1 Load SpaDES and other packages.","text":"","code":"\nif (!require(Require)) {\n  install.packages(\"Require\")\n  library(Require)\n}\n\nRequire(c(\"PredictiveEcology/SpaDES.install\",\n          \"SpaDES\", \"PredictiveEcology/SpaDES.core@development\"), \n        install_githubArgs = list(dependencies = TRUE))"},{"path":"landr-biomass_speciesparameters-module.html","id":"get-module-necessary-packages-and-set-up-folder-directories-1","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.3.2 Get module, necessary packages and set up folder directories","text":"","code":"\ntempDir <- tempdir()\n\npaths <- list(inputPath = normPath(file.path(tempDir, \"inputs\")), \n              cachePath = normPath(file.path(tempDir, \"cache\")), \n              modulePath = normPath(file.path(tempDir, \"modules\")), \n              outputPath = normPath(file.path(tempDir, \"outputs\")))\n\ngetModule(\"PredictiveEcology/Biomass_speciesParameters@79896a4e3b785e34e5f509798ab6c2204bb334d7\", modulePath = paths$modulePath, overwrite = TRUE)\n\n## make sure all necessary packages are installed:\nmakeSureAllPackagesInstalled(paths$modulePath)"},{"path":"landr-biomass_speciesparameters-module.html","id":"setup-simulation-2","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.3.3 Setup simulation","text":"","code":"\nlibrary(SpaDES)\n\ntimes <- list(start = 0, end = 1)\n\nmodules <- list(\"Biomass_speciesParameters\")\n\n#the purpose of this table is experiment with modify longevity - longevity is not estimated by the module\n#but it is used in trait estimation. \ninputSpecies <- data.table(species = c(\"Abie_bal\", 'Abie_las', 'Betu_pap', 'Lari_lar',\n                                        'Pice_eng', 'Pice_gla', 'Pice_mar', 'Pinu_ban',\n                                       'Pinu_con', 'Pseu_men', \"Popu_tre\"),\n                           longevity = c(300, 300, 170, 170, 330, 250, 250, 175, 300, 600, 200),\n                           mortalityshape = 15, growthcurve = 0)\nobjects <- list(species = inputSpecies)\n\ninputs <- list()\noutputs <- list()\n\nparameters <- list(Biomass_speciesParameters = \n                     list(GAMMiterations = 2, \n                          GAMMknots = list(\n                            \"Abie_bal\" = 3,\n                            \"Abie_las\" = 3,\n                            \"Betu_pap\" = 3,\n                            \"Lari_lar\" = 4,\n                            \"Pice_eng\" = 4,\n                            \"Pice_gla\" = 3,\n                            \"Pice_mar\" = 4,\n                            \"Pinu_ban\" = 3,\n                            \"Pinu_con\" = 4, \n                            \"Popu_tre\" = 4,\n                            \"Pseu_men\" = 3),\n                          minimumPlotsPerGamm = 40,\n                          constrainMortalityShape = list(\n                            \"Abie_bal\" = c(15,25),\n                            \"Abie_las\" = c(15,25),\n                            \"Betu_pap\" = c(15,20),\n                            \"Lari_lar\" = c(20,25),\n                            \"Pice_eng\" = c(20,25),\n                            \"Pice_gla\" = c(20,25),\n                            \"Pice_mar\" = c(15,25),\n                            \"Pinu_ban\" = c(15,25),\n                            \"Pinu_con\" = c(15,25), \n                            \"Popu_tre\" = c(20,25),\n                            \"Pseu_men\" = c(20,25)\n                          ),\n                          constrainGrowthCurve = list(\n                            \"Abie_bal\" = c(0, 1),\n                            \"Abie_las\" = c(0, 1),\n                            \"Betu_pap\" = c(0, 1),\n                            \"Lari_lar\" = c(0, 1),\n                            \"Pice_eng\" = c(0, 1),\n                            \"Pice_gla\" = c(0, 1),\n                            \"Pice_mar\" = c(0, 1),\n                            \"Pinu_ban\" = c(0, 1),\n                            \"Pinu_con\" = c(0, 1), \n                            \"Popu_tre\" = c(0, 1),\n                            \"Pseu_men\" = c(0, 1)\n                          ),\n                          quantileAgeSubset = list(\n                            \"Abie_bal\" = 95, \n                            \"Abie_las\" = 95,\n                            \"Betu_pap\" = 95,\n                            \"Lari_lar\" = 95,\n                            \"Pice_eng\" = 95,\n                            \"Pice_gla\" = 95,\n                            \"Pice_mar\" = 95,\n                            \"Pinu_ban\" = 95,\n                            \"Pinu_con\" = 99, \n                            \"Popu_tre\" = 99,\n                            \"Pseu_men\" = 99\n                          )\n                     ))\n\n\nmySim <- simInitAndSpades(times = times, \n                          params = parameters, \n                          modules = modules, \n                          paths = paths, \n                          objects = objects)\n\n## to inspect the fitted GAMM models:\nmySim$speciesGAMMs$Pice_mar"},{"path":"landr-biomass_speciesparameters-module.html","id":"references-3","chapter":"6 LandR Biomass_speciesParameters Module","heading":"6.4 References","text":"","code":""},{"path":"landr-validation-modules.html","id":"landr-validation-modules","chapter":"7 LandR Validation Modules","heading":"7 LandR Validation Modules","text":"LandR ‘validation modules’ differ ‘data modules’ objective obtain input data estimate parameters run simulation, rather confront simulation outputs observed data – even modules can potentially obtain pre-process validation data.\nmoment, one validation module available Biomass_validationKNN, expect increment number validation modules LandR usage expands.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"landr-biomass_validationknn-module","chapter":"8 LandR Biomass_validationKNN Module","heading":"8 LandR Biomass_validationKNN Module","text":"\ndocumentation work progress. Potential discrepancies omissions\nmay exist time . find , contact us using link\n^^","code":""},{"path":"landr-biomass_validationknn-module.html","id":"authors-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.0.0.1 Authors:","text":"Ceres Barros cbarros@mail.ubc.ca [aut, cre]\n","code":""},{"path":"landr-biomass_validationknn-module.html","id":"module-overview-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1 Module Overview","text":"","code":""},{"path":"landr-biomass_validationknn-module.html","id":"module-summary-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1.1 Module summary","text":"approach validating outputs LandR Biomass - notably \nBiomass_core vegetation simulation module - using publicly available data \nCanadian forests. module produces visual statistical validation \nBiomass_core outputs related species abundance \npresence/absence landscape. , downloads prepares \nnecessary data (observed simulated), calculates validation statistics \nproduces/saves validation plots.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"module-inputs-and-parameters-at-a-glance-3","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1.2 Module inputs and parameters at a glance","text":"Biomass_validationKNN requires access outputs simulations \nBiomass_core, internet access retrieve observed kNN datasets used\nvalidation. Raw data layers downloaded module saved \ndataPath(sim), can controlled via\noptions(reproducible.destinationPath = ...).advise future users run Biomass_validationKNN defaults inspect\nobjects like supplying data, alternative data\nURLs. expect number validation modules increase validation\napproaches developed based project needs.module able compile simulation output data provided user\nsupplies object names file paths via simulationOutputs input\nobject. Alternatively, user may pass pre-compiled outputs (namely \ncohortData pixelGroupMap objects) via allCohortData \npixelGroupMapStk input objects. See Input objects detail.Key parameters defining simulation years replicates,\n(validationYears, validationReps) plot control (.plots). ’s \nfull list parameters:full lists input objects (Table\n8.1) parameters (Table\n8.2) Biomass_validationKNN\nexpects. input must provided (.e., Biomass_validationKNN\ndefault ) studyArea. input objects \nparameters internal defaults (see Tables\n8.4 \n8.5). Objects suffixed *Start\ncorrespond objects simulation without suffix (e.g.\nrawBiomassMapStart rawBiomassMap simulation), whereas \nobjects like studyArea rasterToMatch names \nsimulation exactly object.\nTable 8.1: List Biomass_validationKNN input objects description.\n\nTable 8.2: List Biomass_validationKNN parameters description.\n","code":""},{"path":"landr-biomass_validationknn-module.html","id":"events-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1.3 Events","text":"following events take place Biomass_validationKNN run. Note \nmodule runs (one “time step”).Module initiation (init event) - prepares observed simulated\ndata comparedModule initiation (init event) - prepares observed simulated\ndata comparedCalculation summary variables validation (calculateValidVars event)Calculation summary variables validation (calculateValidVars event)Calculation validation statistics (validationStats event)Calculation validation statistics (validationStats event)Optional diagnostic plots biomass age changes (\\(\\Delta\\)B,\n\\(\\Delta\\)Age) observed data (obsDeltaMaps event).Optional diagnostic plots biomass age changes (\\(\\Delta\\)B,\n\\(\\Delta\\)Age) observed data (obsDeltaMaps event).Plotting events:\nPlots landscape-wide (landscapeWidePlots event), pixel-level\n(pixelLevelPlots events) comparisons summary variables\nPlots biomass age changes (\\(\\Delta\\)B, \\(\\Delta\\)Age) observed\nsimulated data, respect first year. (deltaBComparisons\nevent)\nPlotting events:Plots landscape-wide (landscapeWidePlots event), pixel-level\n(pixelLevelPlots events) comparisons summary variablesPlots landscape-wide (landscapeWidePlots event), pixel-level\n(pixelLevelPlots events) comparisons summary variablesPlots biomass age changes (\\(\\Delta\\)B, \\(\\Delta\\)Age) observed\nsimulated data, respect first year. (deltaBComparisons\nevent)Plots biomass age changes (\\(\\Delta\\)B, \\(\\Delta\\)Age) observed\nsimulated data, respect first year. (deltaBComparisons\nevent)","code":""},{"path":"landr-biomass_validationknn-module.html","id":"module-outputs-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1.4 Module outputs","text":"module produces following outputs (Table\n8.3):\nTable 8.3: List Biomass_validationKNN output objects description.\nsaves validation figures output path defined \ngetPaths(sim)$outputPath (defined paths$outputPath). Tables \nsaved unless specified via spades(outputs = data.frame(...), ...). \nsaving objects disk (tables), can looked using, e.g.,\nmySimValidation$logLikelihood.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"links-to-other-modules-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1.5 Links to other modules","text":"Intended used Biomass_core modules link \naffect cohort biomass (e.g., via cohortData table). can see \npotential module linkages within LandR ecosystem\n. Select\nBiomass_validationKNN drop-menu see linkages.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"getting-help-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.1.6 Getting help","text":"https://github.com/PredictiveEcology/Biomass_validationKNN/issues","code":""},{"path":"landr-biomass_validationknn-module.html","id":"module-manual-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2 Module manual","text":"","code":""},{"path":"landr-biomass_validationknn-module.html","id":"detailed-description-3","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.1 Detailed description","text":"module compares simulated outputs two years (across replicates), \ncorresponding years observed data. designed compare observed\ndata years 2001 (start point simulation) 2011 (.e., 10\nyears simulation) kNN forest layers Canadian National Forest\nInventory – currently available FAIR datasets (sensu Stall et al. 2019)) stand biomass species (ref:percent) cover changes across\nCanada. However, user can supply sources observed data, long \nidentical format.validation done visually (using barplots boxplots) using two\nstatistics: mean absolute deviation simulated biomass (per species) \nsum negative log-likelihoods (SNLL) predictions respect observed\ndata species biomass, species presences/absences changes biomass\n(\\(\\Delta\\)B) - later still development.module assumes simulation data preparation carried \nBiomass_borealDataPrep, , ensure comparison \nsimulated datasets built assumptions, data treatment steps\nBiomass_borealDataPrep repeated . module may also excludes\ndisturbed pixels coded rstLCCChange fire perimeter data\n(firePerimeters). intended, pass rstLCCChange NA’s\n/empty firePerimeters sf object. Biomass_validationKNN \ncompares simulated species biomass, presences, dominance, changes biomass\nobserved data available starting conditions (2011 default)\nsecond time point (e.g. 2011, 10 years simulation). ,\nyear replicate, simulated observed data, \nmodule calculates:species relative abundances pixel- landscape-level (across \npixels)species relative abundances pixel- landscape-level (across \npixels)species presences dominance landscape levelspecies presences dominance landscape levelchanges species biomass (\\(\\Delta\\)B) pixel- landscape-level \nsimulated observed data. Biomass units respect used \nBiomass_core (\\(g/m^2\\)).changes species biomass (\\(\\Delta\\)B) pixel- landscape-level \nsimulated observed data. Biomass units respect used \nBiomass_core (\\(g/m^2\\)).Pixel-level relative abundances calculated species biomass (summed\nacross cohorts) divided total pixel biomass (summed across cohorts \nspecies), landscape-wide relative abundances calculated sum \nspecies biomass across pixels divided sum total biomass across\npixels. Species presences calculated number pixels \ngiven species present, species dominance calculated number \npixels species highest relative biomass given pixel. Pixels\ntwo species share highest biomass value classified \n‘mixed forest’, pixels without biomass classified ‘veg.’.\nFinally, (\\(\\Delta\\)B) calculated per species final biomass (e.g., year\n2011) minus initial biomass (e.g., year 2001), either pixel- \nlandscape-level. calculations done per replicate.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"validation-approaches","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.2 Validation approaches","text":"","code":""},{"path":"landr-biomass_validationknn-module.html","id":"visual-validation","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.2.1 Visual validation","text":"module plots metrics barplots showing landscape-level values\n(averaged across replicates simulated data) boxplots showing\npixel-level values. Plotting can live /form exported images\n(turned completely).","code":""},{"path":"landr-biomass_validationknn-module.html","id":"mean-absolute-deviation","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.2.2 Mean absolute deviation","text":"Mean absolute deviance (MAD) values calculated landscape- pixel-level\nspecies relative abundances \\(\\Delta\\)B, landscape-level species presences\ndominance, per replicate year (except \\(\\Delta\\)B, integrated\nacross years). Output tables MAD values exported landscapeMAD \npixelMAD, module also produces visual inspection values \ndot--whisker plots.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"sum-of-negative-log-likelihood-snll","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.2.3 Sum of negative log-likelihood (SNLL)","text":"provide measure overall goodness fit simulation model, given \ngiven set starting conditions simulation mechanisms (.e., \ncombination inputs Biomass_core also modules may \nassociated affecting vegetation dynamics), Biomass_validationKNN estimates\nsum negative log-likelihoods (SNLL) simulated species biomasses, \\(\\Delta\\)B\n(landscape pixel-level), species presences (\nlandscape-level), respect observed counterparts. precisely,\nlet \\(\\ell\\) log-likelihood function denoting probability observing\n\\(x\\) \\(X\\) (random variable following continuous probability distribution\n\\(f(x)\\)), given parameter \\(\\theta\\):case, \\(\\theta\\) equivalent model’s starting conditions \nstructure, \\(X\\) observed data \\(x\\) simulated values, \n\\(f(x)\\) continuous probability distribution \\(X\\). variable \nwanted evaluate simulation replicate, Equation (8.1)\napplied calculate SNLL estimated value \\(x\\) pixel \nlandscape-level, \\(\\):\\(N\\) equal total number pixels. landscape scale \\(N = 1\\).species biomass species presences, draw probability observing\n\\(x_{}\\) (vector species biomasses/presences pixel/landscape \\(\\)) \nmultinomial density distribution\n(\\(f(x_{}) = {\\sf Multi}(n_{}, \\mathrm{p}_{})\\)), \n\\(n_{} = \\sum_{j = 1}^{K} X_{,j}\\) (\\(X\\) observed values biomass \n\\(j = 1, ..., K\\) species pixel/landscape \\(\\)) \\(\\mathrm{p_{}}\\) \nvector simulated values \\(x_{,j}\\).computation SNLL \\(\\Delta\\)B still development. \nimplemented following, approach: \\(\\Delta\\)B, draw probability \nobserving \\(x_{,j}\\) (simulated \\(\\Delta\\)B \\(j = 1, ..., K\\) species \npixel/landscape \\(\\)) multivariate Gaussian distribution,\n\\(f(x_{}) = \\mathcal {N}(\\mu_{}, \\mathrm{M}_{})\\), \\(\\mu_{}\\) \nvector observed mean \\(\\Delta\\)B species \\(j = 1, ..., K\\), \n\\(\\mathrm{M}\\) observed \\(K * K\\) variance-covariance matrix species\n\\(\\Delta\\)B. Unfortunately presenting problems, due \\(\\mathrm{M}\\) \nstrictly positive definite.calculating SNLL across pixels (landscape), values averaged\nacross replicates overall model estimate exported \nlogLikelihood table.refer Wikipedia pages multinomial\ndistribution \nmultivariate Gaussian\ndistribution\ngood summary two distributions use SNLL estimation.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"initialization-inputs-and-parameters-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.3 Initialization, inputs and parameters","text":"Biomass_validationKNN initializes prepares inputs provided \naccess outputs simulations Biomass_core, internet access\nretrieve observed kNN datasets used validation. Future users \nrun Biomass_validationKNN defaults inspect objects like\nsupplying data, alternative data URLs. Alternatively, users\nmay develop validation modules using Biomass_validationKNN \ntemplate.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"input-objects-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.3.1 Input objects","text":"Biomass_validationKNN requires following input data layers: land-cover\nchange (change type year), fire perimeters, (ref:percent) species cover,\nstand age stand biomass. default, module take \nNational Forest Inventory kNN layers years 2001 2011. recommend \nuser supplies layers used initialise simulation starting input\nlayers (2001 starting point) guarantee match. Table\n8.4 shows full list input\nobjects used module.\nTable 8.4: List Biomass_validationKNN input objects description.\ninputs Table 8.4, \nfollowing particularly important deserve special attention:Spatial layers\nbiomassMap – map simulated stand biomass (\\(g/m^2\\) ) filtered\npixels cohort dynamics simulated. corresponds \nsim$biomassMap object produced Biomass_borealDataPrep \nsim$simulatedBiomassMap produced Biomass_core.\nfirePerimeters – fire perimeters polygon map used \nexclude recently burned pixels analysis. desired\nuser needs provide empty sf object (e.g.,\nsf::st_polygon()) .\nrawBiomassMapStart – raw biomass data used initialize \nparametrize Biomass_core. default, module uses stand\nbiomass map KNN year 2001. user must make sure \nappropriate use case, else supply correct raster layer.\nrawBiomassMapEnd – raw biomass data used validate model \nseveral simualtion years. default, module uses stand biomass\nmap KNN year 2011, compared 10th year \nsimulation initialised using KNN 2001 data. user must make\nsure appropriate use case, else supply correct\nraster layer.\nrstLCChange – binary raster layer disturbed pixels \nremoved analyses. Can combined rstLCChangeYr \nfilter pixels disturbed given time period defined \nP(sim)$LCChangeYr. Defaults Canada’s forest change national map\n1985-2011\n(CFS).\nrstLCChangeYr – raster layer year disturbance. \noptional layer can combined rstLCChange \nP(sim)$LCChangeYr filter disturbed pixels year disturbance.\nused default. Defaults Canada’s forest change year national\nmap 1985-2011\n(CFS).\nspeciesLayersStart – rawBiomassMapStart, respect\nspecies (ref:percent) cover data.\nspeciesLayersEnd – rawBiomassMapEnd, respect \nspecies (ref:percent) cover data.\nstudyArea – shapefile. SpatialPolygonsDataFrame single\npolygon determining simulation take place. \ninput object must supplied user.\nSpatial layersbiomassMap – map simulated stand biomass (\\(g/m^2\\) ) filtered\npixels cohort dynamics simulated. corresponds \nsim$biomassMap object produced Biomass_borealDataPrep \nsim$simulatedBiomassMap produced Biomass_core.biomassMap – map simulated stand biomass (\\(g/m^2\\) ) filtered\npixels cohort dynamics simulated. corresponds \nsim$biomassMap object produced Biomass_borealDataPrep \nsim$simulatedBiomassMap produced Biomass_core.firePerimeters – fire perimeters polygon map used \nexclude recently burned pixels analysis. desired\nuser needs provide empty sf object (e.g.,\nsf::st_polygon()) .firePerimeters – fire perimeters polygon map used \nexclude recently burned pixels analysis. desired\nuser needs provide empty sf object (e.g.,\nsf::st_polygon()) .rawBiomassMapStart – raw biomass data used initialize \nparametrize Biomass_core. default, module uses stand\nbiomass map KNN year 2001. user must make sure \nappropriate use case, else supply correct raster layer.rawBiomassMapStart – raw biomass data used initialize \nparametrize Biomass_core. default, module uses stand\nbiomass map KNN year 2001. user must make sure \nappropriate use case, else supply correct raster layer.rawBiomassMapEnd – raw biomass data used validate model \nseveral simualtion years. default, module uses stand biomass\nmap KNN year 2011, compared 10th year \nsimulation initialised using KNN 2001 data. user must make\nsure appropriate use case, else supply correct\nraster layer.rawBiomassMapEnd – raw biomass data used validate model \nseveral simualtion years. default, module uses stand biomass\nmap KNN year 2011, compared 10th year \nsimulation initialised using KNN 2001 data. user must make\nsure appropriate use case, else supply correct\nraster layer.rstLCChange – binary raster layer disturbed pixels \nremoved analyses. Can combined rstLCChangeYr \nfilter pixels disturbed given time period defined \nP(sim)$LCChangeYr. Defaults Canada’s forest change national map\n1985-2011\n(CFS).rstLCChange – binary raster layer disturbed pixels \nremoved analyses. Can combined rstLCChangeYr \nfilter pixels disturbed given time period defined \nP(sim)$LCChangeYr. Defaults Canada’s forest change national map\n1985-2011\n(CFS).rstLCChangeYr – raster layer year disturbance. \noptional layer can combined rstLCChange \nP(sim)$LCChangeYr filter disturbed pixels year disturbance.\nused default. Defaults Canada’s forest change year national\nmap 1985-2011\n(CFS).rstLCChangeYr – raster layer year disturbance. \noptional layer can combined rstLCChange \nP(sim)$LCChangeYr filter disturbed pixels year disturbance.\nused default. Defaults Canada’s forest change year national\nmap 1985-2011\n(CFS).speciesLayersStart – rawBiomassMapStart, respect\nspecies (ref:percent) cover data.speciesLayersStart – rawBiomassMapStart, respect\nspecies (ref:percent) cover data.speciesLayersEnd – rawBiomassMapEnd, respect \nspecies (ref:percent) cover data.speciesLayersEnd – rawBiomassMapEnd, respect \nspecies (ref:percent) cover data.studyArea – shapefile. SpatialPolygonsDataFrame single\npolygon determining simulation take place. \ninput object must supplied user.studyArea – shapefile. SpatialPolygonsDataFrame single\npolygon determining simulation take place. \ninput object must supplied user.Simulation-related objects\nallCohortData – OPTIONAL. data.table containing cohortData\nobjects relevant validation (e.g., many cohortData objects\nsimulation replicates times 2, beginning end year). \nsupplied, Biomass_validationKNN attempts produce object\nusing cohortData object file listed simulationOutputs .\nHence, user must either supply allCohortData \npixelGroupMapStk simulationOutputs.\npixelGroupMapStk – OPTIONAL. allCohortData respect \npixelGroupMap objects.\nsimulationOutputs – OPTIONAL. data.frame \nstructure data.frame’s specifying outputs saved \nspades(…, outputs = data.frame(…)). advise passing \ndata.frame supplied spades simulation call,\nfiltered relevant cohortData pixelGroupMap objects\n, potentially, file paths corrected match current working\ndirectory (see Usage example). used allCohortData \npixelGroupMapStk supplied.\npixelGroupMap – raster layer pixelGroup IDs per pixel.\nPixels always grouped based identical ecoregionGroup,\nspeciesCode, age B composition, even user supplies\ninitial groupings (e.g., possible \nBiomass_borealDataPrep data module).\nSimulation-related objectsallCohortData – OPTIONAL. data.table containing cohortData\nobjects relevant validation (e.g., many cohortData objects\nsimulation replicates times 2, beginning end year). \nsupplied, Biomass_validationKNN attempts produce object\nusing cohortData object file listed simulationOutputs .\nHence, user must either supply allCohortData \npixelGroupMapStk simulationOutputs.allCohortData – OPTIONAL. data.table containing cohortData\nobjects relevant validation (e.g., many cohortData objects\nsimulation replicates times 2, beginning end year). \nsupplied, Biomass_validationKNN attempts produce object\nusing cohortData object file listed simulationOutputs .\nHence, user must either supply allCohortData \npixelGroupMapStk simulationOutputs.pixelGroupMapStk – OPTIONAL. allCohortData respect \npixelGroupMap objects.pixelGroupMapStk – OPTIONAL. allCohortData respect \npixelGroupMap objects.simulationOutputs – OPTIONAL. data.frame \nstructure data.frame’s specifying outputs saved \nspades(…, outputs = data.frame(…)). advise passing \ndata.frame supplied spades simulation call,\nfiltered relevant cohortData pixelGroupMap objects\n, potentially, file paths corrected match current working\ndirectory (see Usage example). used allCohortData \npixelGroupMapStk supplied.simulationOutputs – OPTIONAL. data.frame \nstructure data.frame’s specifying outputs saved \nspades(…, outputs = data.frame(…)). advise passing \ndata.frame supplied spades simulation call,\nfiltered relevant cohortData pixelGroupMap objects\n, potentially, file paths corrected match current working\ndirectory (see Usage example). used allCohortData \npixelGroupMapStk supplied.pixelGroupMap – raster layer pixelGroup IDs per pixel.\nPixels always grouped based identical ecoregionGroup,\nspeciesCode, age B composition, even user supplies\ninitial groupings (e.g., possible \nBiomass_borealDataPrep data module).pixelGroupMap – raster layer pixelGroup IDs per pixel.\nPixels always grouped based identical ecoregionGroup,\nspeciesCode, age B composition, even user supplies\ninitial groupings (e.g., possible \nBiomass_borealDataPrep data module).","code":""},{"path":"landr-biomass_validationknn-module.html","id":"parameters-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.3.2 Parameters","text":"Table 8.5 lists parameters used\nBiomass_validationKNN detailed information.\nTable 8.5: List Biomass_validationKNN parameters description.\nparameters listed Table\n8.5, following particularly\nimportant:LCChangeYr – integer. Optional parameter defining years \ndisturbance filtered analysis using \nrstLCChangeYr layer. parameter set NULL default, meaning\nrstLCChangeYr used.LCChangeYr – integer. Optional parameter defining years \ndisturbance filtered analysis using \nrstLCChangeYr layer. parameter set NULL default, meaning\nrstLCChangeYr used.sppEquivCol – character. column name speciesEquivalency\ndata.table defines naming convention use throughout \nsimulation.sppEquivCol – character. column name speciesEquivalency\ndata.table defines naming convention use throughout \nsimulation.validationReps – integer. simulation replicates used \nvalidation.validationReps – integer. simulation replicates used \nvalidation.validationYears – integer. simulation years used \nvalidation - year number needs match observed data year. \ninstance, first observed data year 2001, must first\nsimulation year.validationYears – integer. simulation years used \nvalidation - year number needs match observed data year. \ninstance, first observed data year 2001, must first\nsimulation year.","code":""},{"path":"landr-biomass_validationknn-module.html","id":"simulation-flow-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.2.4 Simulation flow","text":"general flow Biomass_validationKNN processes :Preparation necessary objects, namely obtaining observed data\nlayers online repositories (available stored local copies) \ncompiling simulated data user done previously (see\nInput objects).Preparation necessary objects, namely obtaining observed data\nlayers online repositories (available stored local copies) \ncompiling simulated data user done previously (see\nInput objects).Calculation summary variables validation, namely:\nrelative biomass per species per pixel across landscape (per\nyear per replicate)\nchanges species biomass per pixel across landscape (per\nreplicate), respect first year.\nspecies dominance across landscape\nspecies presences across landscape\nCalculation summary variables validation, namely:relative biomass per species per pixel across landscape (per\nyear per replicate)relative biomass per species per pixel across landscape (per\nyear per replicate)changes species biomass per pixel across landscape (per\nreplicate), respect first year.changes species biomass per pixel across landscape (per\nreplicate), respect first year.species dominance across landscapespecies dominance across landscapespecies presences across landscapespecies presences across landscapeCalculation validation statistics, namely mean absolute deviations (MAD)\nsum negative log-likelihoods (SNLL).Calculation validation statistics, namely mean absolute deviations (MAD)\nsum negative log-likelihoods (SNLL).Assessment relationship observed \\(\\Delta\\)B observed\n\\(\\Delta\\)Age – optional visual diagnostic observed data\nproduces scatterplots \\(\\Delta\\)B ~ \\(\\Delta\\)Age three types:\nraw observed values \\(\\Delta\\)B \\(\\Delta\\)Age\n\\(\\Delta\\)B \\(\\Delta\\)Age calculated observed data \npre-processing (.e., data clean-steps done \nBiomass_borealDataPrep, also done observed data\nvalidation)\ndata shown 2) , filtered pixels \nstand age increment corresponding number years \ntwo validation time points. necessarily \ncorrect filter, stands may suffered age reduction due \nloss old cohorts background mortality (.e., coming \ndisturbances. However, using default input datasets, \nunlikely widespread phenomenon 10 years. \nremind user disturbed pixels removed \nanalyses validating succession dynamics absence \ndisturbance - default option.\nAssessment relationship observed \\(\\Delta\\)B observed\n\\(\\Delta\\)Age – optional visual diagnostic observed data\nproduces scatterplots \\(\\Delta\\)B ~ \\(\\Delta\\)Age three types:raw observed values \\(\\Delta\\)B \\(\\Delta\\)AgeWith raw observed values \\(\\Delta\\)B \\(\\Delta\\)AgeWith \\(\\Delta\\)B \\(\\Delta\\)Age calculated observed data \npre-processing (.e., data clean-steps done \nBiomass_borealDataPrep, also done observed data\nvalidation)\\(\\Delta\\)B \\(\\Delta\\)Age calculated observed data \npre-processing (.e., data clean-steps done \nBiomass_borealDataPrep, also done observed data\nvalidation)data shown 2) , filtered pixels \nstand age increment corresponding number years \ntwo validation time points. necessarily \ncorrect filter, stands may suffered age reduction due \nloss old cohorts background mortality (.e., coming \ndisturbances. However, using default input datasets, \nunlikely widespread phenomenon 10 years. \nremind user disturbed pixels removed \nanalyses validating succession dynamics absence \ndisturbance - default option.data shown 2) , filtered pixels \nstand age increment corresponding number years \ntwo validation time points. necessarily \ncorrect filter, stands may suffered age reduction due \nloss old cohorts background mortality (.e., coming \ndisturbances. However, using default input datasets, \nunlikely widespread phenomenon 10 years. \nremind user disturbed pixels removed \nanalyses validating succession dynamics absence \ndisturbance - default option.Plots:\nBarplots landscape-wide pixel-level comparisons observed\nsimulated data, respect relative biomass, dominance \npresences.\nBoxplots biomass changes (\\(\\Delta\\)B) observed simulated data,\nrespect first year.\nMaps biomass age changes (\\(\\Delta\\)B, \\(\\Delta\\)Age) respect \nfirst year, observed simulated data.\nPlots:Barplots landscape-wide pixel-level comparisons observed\nsimulated data, respect relative biomass, dominance \npresences.Barplots landscape-wide pixel-level comparisons observed\nsimulated data, respect relative biomass, dominance \npresences.Boxplots biomass changes (\\(\\Delta\\)B) observed simulated data,\nrespect first year.Boxplots biomass changes (\\(\\Delta\\)B) observed simulated data,\nrespect first year.Maps biomass age changes (\\(\\Delta\\)B, \\(\\Delta\\)Age) respect \nfirst year, observed simulated data.Maps biomass age changes (\\(\\Delta\\)B, \\(\\Delta\\)Age) respect \nfirst year, observed simulated data.module default outputs form plots, user can chose \nsave objects (see Table 8.3).","code":""},{"path":"landr-biomass_validationknn-module.html","id":"usage-example-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.3 Usage example","text":"","code":""},{"path":"landr-biomass_validationknn-module.html","id":"load-spades-and-other-packages.-2","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.3.1 Load SpaDES and other packages.","text":"","code":"\nlibrary(SpaDES)\nlibrary(SpaDES.install)\nlibrary(SpaDES.experiment)\nlibrary(future)"},{"path":"landr-biomass_validationknn-module.html","id":"get-the-modules","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.3.2 Get the modules","text":"Biomass_validationKNN meant validate simulation outputs \nobserved data, need first run simulation forest dynamics \nBiomass_core. get modules’ code PredictiveEcology\nGitHub repository. Notice placing module code, inputs \noutputs temporary directories.","code":"\ntempDir <- tempdir()\npaths <- list(inputPath = file.path(tempDir, \"inputs\"), \n                 cachePath = file.path(tempDir, \"cache\"), \n                 modulePath = file.path(tempDir, \"modules\"), \n                 outputPath = file.path(tempDir, \"outputs\"))\n\ngetModule(\"PredictiveEcology/Biomass_core\", modulePath = paths$modulePath, overwrite = TRUE)\ngetModule(\"PredictiveEcology/Biomass_validationKNN\", modulePath = paths$modulePath, overwrite = TRUE)\n\n## by default the repository branch name is appended to the module folder name.\n## so we change the folder name to remove the \"-master\" suffix.\nfile.rename(c(file.path(paths$modulePath, \"Biomass_core-master\"),\n              file.path(paths$modulePath, \"Biomass_validationKNN-master\")),\n            c(file.path(paths$modulePath, \"Biomass_core\"),\n              file.path(paths$modulePath, \"Biomass_validationKNN\")))"},{"path":"landr-biomass_validationknn-module.html","id":"setup-simulation-3","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.3.3 Setup simulation","text":"","code":"\ntimes <- list(start = 2001, end = 2011)\n\nstudyArea <- Cache(randomStudyArea, size = 1e7) # cache this so it creates a random one only once on a machine\n\n# Pick the species you want to work with -- using the naming convention in \"Boreal\" column of LandR::sppEquivalencies_CA\nspeciesNameConvention <- \"Boreal\"\nspeciesToUse <- c(\"Pice_Gla\", \"Popu_Tre\", \"Pinu_Con\")\n\nsppEquiv <- LandR::sppEquivalencies_CA[get(speciesNameConvention) %in% speciesToUse]\n# Assign a colour convention for graphics for each species\nsppColorVect <- LandR::sppColors(sppEquiv, speciesNameConvention,\n                                 newVals = \"Mixed\", palette = \"Set1\")\n\n## Usage example\nmodules <- as.list(\"Biomass_core\")\nobjects <- list(studyArea = studyArea, sppEquiv = sppEquiv, sppColorVect = sppColorVect)\n\nsuccessionTimestep <- 20L\n\n## keep default values for most parameters \n## (ommitted from this list)\nparameters <- list(\n  Biomass_core = list(\n    \"sppEquivCol\" = speciesNameConvention\n    , \"successionTimestep\" = successionTimestep\n    , \".plotInitialTime\" = times$start\n    , \".plotInterval\" = 1L\n    , \".plots\" = \"png\"\n    , \".saveInitialTime\" = times$start\n    , \".useCache\" = \"init\"\n    , \".useParallel\" = FALSE\n  )\n)\n\noutputs <- data.frame(expand.grid(objectName = \"cohortData\",\n                                  saveTime = unique(seq(times$start, times$end, by = 1)),\n                                  eventPriority = 1,\n                                  stringsAsFactors = FALSE))\noutputs <- rbind(outputs, data.frame(objectName = \"pixelGroupMap\",\n                                     saveTime = unique(seq(times$start, times$end, by = 1)),\n                                     eventPriority = 1))"},{"path":"landr-biomass_validationknn-module.html","id":"run-simulation-1","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.3.4 Run simulation","text":"run simulation three replicates using experiment2 function\nSpaDES.experiment R package (McIntire & Chubaty 2021), builds \nfolder structure simulation outputs conveniently organised.","code":"\ngraphics.off()\nmySimInit <- simInit(times = times,\n                     params = parameters, \n                     modules = modules, \n                     objects = objects, \n                     paths = paths,\n                     outputs = outputs)\n\nplan(sequential)\nmySimExperiment <- experiment2(\n  sim1 = mySimInit,\n  clearSimEnv = FALSE,\n  replicates = 3)"},{"path":"landr-biomass_validationknn-module.html","id":"validate-simulation-outputs-with-biomass_validationknn","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.3.5 Validate simulation outputs with Biomass_validationKNN","text":"Note ran Biomass_core using theoretical input data,\ncan expect validation reveal module didn’t great job \nreproducing observed patterns.output figures automatically produced \nBiomass_validationKNN\nFigure 8.1: Biomass_validationKNN automatically generates plots showing visual comparison simulated observed species presences (right) across landscape, relative species biomass per pixel (left).\n\nFigure 8.2: plot landscape-wide mean absolute deviations (MAD) (top bottom) observed mean relative abundance, . presences, . pixels species dominant \\(\\Delta\\)B.\n\nFigure 8.3: Diagnostic plot observed changes biomass age \\(\\Delta\\)B \\(\\Delta\\)Age, respectively).\n","code":"\nsimulationOutputs <- lapply(mySimExperiment, FUN = function(x, localSimPaths) {\n  oldPath <- dirname(outputPath(x)) ## exclude sim*_rep* folder\n  DT <- as.data.table(outputs(x))\n  DT[, file := sub(oldPath, localSimPaths$outputPath, file)]\n  DT\n}, localSimPaths = as.list(normPath(paths)))\nsimulationOutputs <- rbindlist(simulationOutputs)\n\nvalidationPaths <- as.list(normPath(paths))\nvalidationPaths$outputPath <- file.path(validationPaths$outputPath, \"validation\")\n\nvalidationTimes <- list(start = 1, end = 1)\nvalidationParams <- list(\n  Biomass_validationKNN = list(\n    \"sppEquivCol\" = params(mySimInit)$Biomass_core$sppEquivCol\n    , \"validationReps\" = as.integer(1:3)  ## or length of simLists\n    , \"validationYears\" = as.integer(c(2001, 2011))\n    , \".plots\" = c(\"png\")\n  )\n)\n\n## make an empty fire polygon object to bypass removing fire-disturbed pixels\nnoFires <- sf::st_polygon()\nvalidationObjects <- list(\n  \"biomassMap\" = mySimExperiment$sim1_rep1$biomassMap\n  , \"firePerimeters\" = noFires\n  , \"rasterToMatch\" = mySimExperiment$sim1_rep1$rasterToMatch\n  , \"rawBiomassMapStart\" = mySimExperiment$sim1_rep1$biomassMap\n  , \"simulationOutputs\" = simulationOutputs\n  , \"speciesLayersStart\" = mySimExperiment$sim1_rep1$speciesLayers\n  , \"sppColorVect\" = mySimExperiment$sim1_rep1$sppColorVect\n  , \"sppEquiv\" = mySimExperiment$sim1_rep1$sppEquiv\n  , \"studyArea\" = mySimExperiment$sim1_rep1$studyArea\n)\n\nmySimValidation <- simInitAndSpades(times = validationTimes\n                                    , params = validationParams\n                                    , modules = \"Biomass_validationKNN\"\n                                    , objects = validationObjects\n                                    , paths = validationPaths\n                                    , .studyAreaName = SAname)"},{"path":"landr-biomass_validationknn-module.html","id":"references-4","chapter":"8 LandR Biomass_validationKNN Module","heading":"8.4 References","text":"","code":""}]
